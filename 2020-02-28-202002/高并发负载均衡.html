<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="悟空的技术博客"><title>高并发负载均衡 | 悟空</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">高并发负载均衡</h1><a id="logo" href="/.">悟空</a><p class="description">悟空的技术博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">高并发负载均衡</h1><div class="post-meta">Feb 28, 2020<span> | </span><span class="category"><a href="/categories/LVS/">LVS</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-网络分层模型-OSI"><span class="toc-text">1. 网络分层模型-OSI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-为什么要分层？"><span class="toc-text">1.1 为什么要分层？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-OSI-7-层参考模型"><span class="toc-text">1.2 OSI 7 层参考模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-TCP-IP-协议"><span class="toc-text">2. TCP/IP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-应用层："><span class="toc-text">2.1 应用层：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-传输控制层"><span class="toc-text">2.2 传输控制层</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-三次握手"><span class="toc-text">2.2.1 三次握手</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-四次分手"><span class="toc-text">2.2.2 四次分手</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-验证三次握手和四次分手"><span class="toc-text">2.2.3 验证三次握手和四次分手</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-追踪-TCP-通讯的详细过程"><span class="toc-text">2.2.4 追踪 TCP 通讯的详细过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-网络层"><span class="toc-text">2.3 网络层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-链路层"><span class="toc-text">2.4 链路层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-高并发"><span class="toc-text">3. 高并发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-高并发的引入"><span class="toc-text">3.1 高并发的引入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-如何解决高并发？"><span class="toc-text">3.2 如何解决高并发？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-LVS"><span class="toc-text">4. LVS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-NAT-路由器"><span class="toc-text">4.1 NAT-路由器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-LVS-NAT-模式"><span class="toc-text">4.2 LVS-NAT 模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-LVS-DR-模式"><span class="toc-text">4.3 LVS-DR 模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-LVS-TUN-模式"><span class="toc-text">4.4 LVS-TUN 模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-隐藏-VIP"><span class="toc-text">4.5 隐藏 VIP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-LVS-DR-模型搭建"><span class="toc-text">5. LVS-DR 模型搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-配置-VIP"><span class="toc-text">5.1 配置 VIP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-安装-RS-中服务"><span class="toc-text">5.2 安装 RS 中服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-安装配置-LVS-工具"><span class="toc-text">5.3 安装配置 LVS 工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-LVS-DR-keepalived-模型搭建"><span class="toc-text">6. LVS-DR-keepalived 模型搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-问题引入和解决思路"><span class="toc-text">6.1 问题引入和解决思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-模型搭建"><span class="toc-text">6.2 模型搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-keepalived-本身挂了如何处理？"><span class="toc-text">6.3 keepalived 本身挂了如何处理？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文章"><span class="toc-text">参考文章</span></a></li></ol></div></div><div class="post-content"><p>简要分析网络协议原理；LVS 三种模型原理；LVS-DR 模型搭建。</p>
<a id="more"></a>
<h2 id="1-网络分层模型-OSI"><a href="#1-网络分层模型-OSI" class="headerlink" title="1. 网络分层模型-OSI"></a>1. 网络分层模型-OSI</h2><h3 id="1-1-为什么要分层？"><a href="#1-1-为什么要分层？" class="headerlink" title="1.1 为什么要分层？"></a>1.1 为什么要分层？</h3><ol>
<li>计算机是软件工程学，软件工程学强调<strong>分层解耦</strong>，以后可以针对不同的层进行修改和优化。</li>
<li>有利于网络设备厂商生产出标准的网络设备。</li>
</ol>
<h3 id="1-2-OSI-7-层参考模型"><a href="#1-2-OSI-7-层参考模型" class="headerlink" title="1.2 OSI 7 层参考模型"></a>1.2 OSI 7 层参考模型</h3><p><img src="../../images/hclb/OSI七层模型.png" alt=""></p>
<h2 id="2-TCP-IP-协议"><a href="#2-TCP-IP-协议" class="headerlink" title="2. TCP/IP 协议"></a>2. TCP/IP 协议</h2><p>TCP/IP 协议，相对于参考模型是一个具体的方案。一共四层：应用层、传输控制层、网络层、链路层。</p>
<p><img src="../../images/hclb/TCPIP协议.png" alt=""></p>
<h3 id="2-1-应用层："><a href="#2-1-应用层：" class="headerlink" title="2.1 应用层："></a>2.1 应用层：</h3><p>包含的协议有：http 协议、ssh 协议、smtp 协议（发邮件）</p>
<p>什么协议？协议就是指规范和标准</p>
<p>通过访问百度主页演示应用层协议：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 0:输入 1:输出 2:报错</div><div class="line"><span class="built_in">cd</span> /proc/$$/fd</div><div class="line"><span class="built_in">exec</span> 8&lt;&gt; /dev/tcp/www.baidu.com/80</div><div class="line">// 发现了一个 socket，socket 就代表通讯</div><div class="line">// 表示已经和百度建立了链接</div><div class="line">ll</div><div class="line">// 根据应用层协议进行通讯</div><div class="line">// 命令重定向，&gt; 表示命令重定向输出</div><div class="line">// 重定向后面加 &amp; 表示后面不是文件，而是文件描述符</div><div class="line">// -e 选项使得 \n 变为换行符</div><div class="line">// GET / HTTP/1.0\n 就是 http 协议规定的 request 请求格式</div><div class="line"><span class="built_in">echo</span> -e <span class="string">'GET / HTTP/1.0\n'</span> &gt;&amp; 8</div><div class="line">// cat 读文件。从 8 重定向到 0，0 是标准输出</div><div class="line">cat 0&lt;&amp; 8</div><div class="line">// 关掉 8</div><div class="line"><span class="built_in">exec</span> 8&lt;&amp; -</div></pre></td></tr></table></figure>
<p>上面过程其实就是模拟了浏览器帮我们做的事情。在浏览器我们只需要输入地址回车，他会自动帮我门封装协议。具体可从开发者工具 NetWork 查看。</p>
<p>应用层之下的层次，都有计算机内核实现，内核提供了一套完整的通讯方法，浏览器或者 Tomcat 容器直接调用即可。</p>
<h3 id="2-2-传输控制层"><a href="#2-2-传输控制层" class="headerlink" title="2.2 传输控制层"></a>2.2 传输控制层</h3><p>包含的协议有：TCP 协议（面向连接的可靠的协议），UDP 协议（和 TCP 协议相反）。</p>
<h4 id="2-2-1-三次握手"><a href="#2-2-1-三次握手" class="headerlink" title="2.2.1 三次握手"></a>2.2.1 三次握手</h4><p><img src="../../images/hclb/TCP连接三次握手.png" alt=""></p>
<p>第一次握手：客户端发送 SYN 包到服务器，并进入 SYN_SENT 状态，等待服务器确认。</p>
<p>第二次握手：服务器收到 SYN 包，必须确认客户的 SYN，同时自己也发送一个 SYN 包，即SYN+ACK包，此时服务器进入 SYN_RECV 状态；</p>
<p>第三次握手：客户端收到 SYN+ACK 包，向服务器发送确认包 ACK，此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，双方开辟相关资源，完成三次握手。</p>
<p>三次数据包走完之后，双方才会在内存开辟线程建立对象和文件描述符等资源。三次握手只是在建立连接，没有应用层数据的事情。</p>
<h4 id="2-2-2-四次分手"><a href="#2-2-2-四次分手" class="headerlink" title="2.2.2 四次分手"></a>2.2.2 四次分手</h4><p><img src="../../images/hclb/TCP连接四次分手.png" alt=""></p>
<p>1）客户端进程发出连接释放报文（FIN），并且停止发送数据，此时，客户端进入 FIN-WAIT-1状态。<br>2）服务器收到连接释放报文，发出确认（ACK）报文，服务端就进入了 CLOSE-WAIT 状态。TCP服务器通知高层的应用进程，客户端向服务器方向的连接就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个 CLOSE-WAIT 状态持续的时间。<br>3）客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2 状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。<br>4）服务器将最后的数据发送完毕后，就向客户端发送连接释放报文（FIN），由于在半关闭状态，服务器很可能又发送了一些数据，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。<br>5）客户端收到服务器的连接释放报文后，必须发出确认（ACK），此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时 TCP 连接还没有释放，必须经过 2∗∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的 TCB 后，才进入 CLOSED 状态。<br>6）服务器只要收到了客户端发出的确认，立即进入 CLOSED 状态。同样，撤销 TCB 后，就结束了这次的 TCP连接。可以看到，服务器结束 TCP 连接的时间要比客户端早一些。</p>
<p><strong>三次握手 -&gt; 传输数据 -&gt; 四次分手</strong>，这个一个传输的最小粒度。比如服务端负载均衡有多台服务器在处理客户端请求，在三次握手的过程中，客户端不能向服务端 A 发送连接请求，然后给服务 B 回复收到了。</p>
<p>传输的过程和握手的过程是可以连连的。即第三次握手时，客户端把数据一起发过去，减少包数量以提高效率。</p>
<h4 id="2-2-3-验证三次握手和四次分手"><a href="#2-2-3-验证三次握手和四次分手" class="headerlink" title="2.2.3 验证三次握手和四次分手"></a>2.2.3 验证三次握手和四次分手</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// 查看端口监听情况</div><div class="line">// a：显示所有</div><div class="line">// n：ip 形式显示</div><div class="line">// u：udp t：tcp</div><div class="line">// p：pid</div><div class="line">netstat -anutp | grep 80</div><div class="line">// 安装抓包程序</div><div class="line">yum install tcpdump</div><div class="line">// 抓取 eth0 网卡，主机不包含（100.100.30.25）并且端口为80 的信息</div><div class="line">tcpdump -nn -i eth0 host ! 100.100.30.25 and port 80</div><div class="line">// 对百度建立三次握手连接，发送协议，返回数据，然后关闭连接</div><div class="line">curl www.baidu.com</div></pre></td></tr></table></figure>
<p>抓包结果：</p>
<p><img src="../../images/hclb/传输过程抓包.png" alt=""></p>
<p>[P.] 中的 P 表示数据已经传输完成，不用缓冲 了，拿到数据赶紧去处理。可以理解为传输完成，立即处理的意思。</p>
<p>从三次握手到传输数据到四次分手应该是一个粒度，不应被以后的技术给分开，比如负载均衡，你不能三次握手在 A 主机，然后去 B 主机传输数据。</p>
<h4 id="2-2-4-追踪-TCP-通讯的详细过程"><a href="#2-2-4-追踪-TCP-通讯的详细过程" class="headerlink" title="2.2.4 追踪 TCP 通讯的详细过程"></a>2.2.4 追踪 TCP 通讯的详细过程</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 一个模拟客户端服务端程序 netcat</div><div class="line">yum install nc</div><div class="line">// 模拟服务端，占用 8080 端口</div><div class="line">nc -l 8080</div><div class="line">// 发现这时候 fd 目录下已经有一个 socket 了。这是服务端监听的 socket</div><div class="line">ps -ef|grep nc</div><div class="line">// 0：标准输入 1：标准输出 2：报错输出</div><div class="line"><span class="built_in">cd</span> /proc/pid/fd</div><div class="line">// 连接服务端</div><div class="line">nc localhost 8080</div><div class="line">// 客户端连接后，服务端进程下会增加一个 socket 连接，表示和客户端的连接</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// 追踪程序的系统调用</div><div class="line">yum install strace</div><div class="line">mkdir ooxx</div><div class="line"><span class="built_in">cd</span> ooxx</div><div class="line">// 追踪 nc -l 8080 对系统的调用</div><div class="line">strace -ff -o out nc -l 8080</div><div class="line">// 发现目录下有一个 out.15824 文件，这个就是追踪的输出文件</div><div class="line">// 如何学习系统调用</div><div class="line">yum install man man-pages</div><div class="line">man 2 socket</div><div class="line">// 实时监控文件</div><div class="line">tail -f out.15824</div><div class="line">// 然后客户端连接，查看 out.15824 的变化</div></pre></td></tr></table></figure>
<p>传输控制层以下，每层都有协议，每层都有表格，怎么看？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// n:IP地址不显示逻辑名称</div><div class="line">// a:显示所有</div><div class="line">// t:TCP</div><div class="line">// p:显示 pid</div><div class="line">netstat -natp</div></pre></td></tr></table></figure>
<h3 id="2-3-网络层"><a href="#2-3-网络层" class="headerlink" title="2.3 网络层"></a>2.3 网络层</h3><p>包含的协议：IP 协议，ARP 协议</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 查看网络信息</div><div class="line">cat /etc/sysconfig/network-scripts/ifcfg-eth0</div><div class="line">// 路由表</div><div class="line">route -n</div><div class="line">ping www.baidu.com</div></pre></td></tr></table></figure>
<p><strong>下一跳机制</strong>，每个互联网设备不需要存全网的数据，只需要存他下一个节点的数据。</p>
<p>ping 命令是怎么把数据包发到百度的？或者说怎么找到百度的？</p>
<p>将百度的 ip 和路由表 Genmask <strong>按位与</strong>之后，看结果是否和 Destination 是否匹配，匹配到的条目的 Gateway 就是下一跳的地址。</p>
<p><strong>Gateway</strong> 0.0.0.0 表示目标设备和请求的路由已经在一个局域网中了，不需要下一跳了，直接通过<strong>交换机</strong>转发数据包，直接通讯即可。只要网与网之间才需要路由器，才需要下一跳。</p>
<h3 id="2-4-链路层"><a href="#2-4-链路层" class="headerlink" title="2.4 链路层"></a>2.4 链路层</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 查看网关和 MAC 地址的映射</div><div class="line">arp -a</div></pre></td></tr></table></figure>
<p>DNS 会解析域名和 IP 地址的映射，ARP 会解释 IP 地址和网卡硬件地址的映射。</p>
<p>DNS 是全网的逻辑名称到 IP 地址，ARP 是同一局域网内的。</p>
<p>链路层会包装三个地址，最外层是目标路由的 mac 地址，里边是目标地址，再里边是端口号。</p>
<p>结论：TCP/IP 协议基于下一跳机制，IP 是端点间，MAC 地址是节点间。</p>
<h2 id="3-高并发"><a href="#3-高并发" class="headerlink" title="3. 高并发"></a>3. 高并发</h2><h3 id="3-1-高并发的引入"><a href="#3-1-高并发的引入" class="headerlink" title="3.1 高并发的引入"></a>3.1 高并发的引入</h3><p>中国入网用户 2.4 亿，除了一些做定向人群服务的公司，绝大多数公司的产品都是希望用户越多越好，赚钱的多少和用户数有极大的关系，所以公司会花费大量的精力和金钱来做<strong>营销</strong>，所以绝大多数公司的产品都会或多或少的面临高并发的问题。</p>
<h3 id="3-2-如何解决高并发？"><a href="#3-2-如何解决高并发？" class="headerlink" title="3.2 如何解决高并发？"></a>3.2 如何解决高并发？</h3><p>问题：Tomcat 为什么慢？</p>
<p>答案：1. 通讯层面，Tomcat 是七层的；2. Tomcat 是 Java 开发，基于 JVM，用户态内存态切换消耗性能。</p>
<p>提供一个<strong>四层的负载均衡服务器</strong>，因为到四层才知道端口号，数据包级别转发，不会和客户端握手，所以速度更快。后端服务是镜像的。</p>
<p>问题：后端服务是镜像的如何处理？</p>
<h2 id="4-LVS"><a href="#4-LVS" class="headerlink" title="4. LVS"></a>4. LVS</h2><h3 id="4-1-NAT-路由器"><a href="#4-1-NAT-路由器" class="headerlink" title="4.1 NAT-路由器"></a>4.1 NAT-路由器</h3><p>路由器中使用了 NAT 模式，路由器会有两个 IP，一个私有 IP，一个公网 IP，公网 IP 就是运营商分的那个 IP，私网 IP 是不会出现在互联网上的。通过路由器上网时，公网 IP、私网 IP 会互相转换。</p>
<p><img src="../../images/hclb/NAT-路由器.png" alt=""></p>
<h3 id="4-2-LVS-NAT-模式"><a href="#4-2-LVS-NAT-模式" class="headerlink" title="4.2 LVS-NAT 模式"></a>4.2 LVS-NAT 模式</h3><p><img src="../../images/hclb/LVS-NAT.png" alt=""></p>
<p>流程：</p>
<ol>
<li>客户端请求负载均衡器（CIP-&gt;VIP）</li>
<li>负载均衡器通过 D-NAT 替换请求目标地址（CIP-&gt;RIP）</li>
<li>服务端请求负载均衡器（RIP-&gt;CIP）。为什么不是 RIP-&gt;VIP？因为 RS 实际上还是和 Client 建立的连接，源 IP 地址还是 CIP，负载均衡服务器相当于路由器。</li>
<li>负载均衡器通过 D-NAT 替换请求源地址（VIP-&gt;CIP）</li>
</ol>
<p>缺点：</p>
<ol>
<li>请求是非对称的，请求的数据可能较小，但是返回的数据量较大，全部都要经过 LVS，LVS 的带宽成为瓶颈。</li>
<li>消耗算力</li>
</ol>
<h3 id="4-3-LVS-DR-模式"><a href="#4-3-LVS-DR-模式" class="headerlink" title="4.3 LVS-DR 模式"></a>4.3 LVS-DR 模式</h3><p><img src="../../images/hclb/LVS-DR.png" alt=""></p>
<p>流程：</p>
<ol>
<li>客户端请求负载均衡器（CIP-&gt;VIP）</li>
<li>负载均衡器修改 MAC 地址，让数据包可以跳转到下一跳，这里注意 RS 服务器需要做特殊的修改，让该 RS 服务器隐藏 VIP，对外隐藏对内可见，所以负载均衡器修改 MAC 地址后，跳转到该 RS，RS 发现 MAC 是自己的，目标 IP 也对的上（都是 VIP），所以数据包就合法接收了。</li>
<li>服务端直接返回响应数据到客户端（VIP-&gt;CIP）</li>
</ol>
<p>缺点：</p>
<ol>
<li>要求负载均衡器和 RS 需要在同一局域网内，因为是基于 2 层的 MAC 修改，如果没在同一局域网内，即只用一跳跳不过去，那这个修改后的数据包肯定发不出去 了，因为下一条中根本没有该 MAC 服务器。</li>
</ol>
<p>优点：速度快、成本低</p>
<h3 id="4-4-LVS-TUN-模式"><a href="#4-4-LVS-TUN-模式" class="headerlink" title="4.4 LVS-TUN 模式"></a>4.4 LVS-TUN 模式</h3><p><img src="../../images/hclb/LVS-TUN.png" alt=""></p>
<p>流程：</p>
<ol>
<li>客户端请求负载均衡器（CIP-&gt;VIP）</li>
<li>负载均衡器请求 RIP（DIP-&gt;RIP），但是数据包中数据是包裹的 CIP-&gt;VIP</li>
<li>服务端直接返回响应数据到客户端（VIP-&gt;CIP）</li>
</ol>
<p>优点：负载均衡服务器和 RealServer 没有位置约束。</p>
<h3 id="4-5-隐藏-VIP"><a href="#4-5-隐藏-VIP" class="headerlink" title="4.5 隐藏 VIP"></a>4.5 隐藏 VIP</h3><p>LVS 的 DR 模式和 TUN 模式都需要隐藏 VIP，让 VIP 在 RS 中对内可见对外不可见。</p>
<ol>
<li>修改 arp_ignore：定义接收到 ARP 请求时的响应级别<ol>
<li>0：只要本地配置的有相应地址，就给予响应</li>
<li>1：仅在请求目标（MAC）地址时才给予响应</li>
</ol>
</li>
<li>arp_announce：定义将自己地址向外通告时的通告级别<ol>
<li>0：将本地任何接口上的任何地址向外通告</li>
<li>1：试图仅向目标网络通告与其网络匹配的地址</li>
<li>2：仅向与本地接口上地址匹配的网络进行通告</li>
</ol>
</li>
</ol>
<p>一个网卡可以配置多个 IP，所以可以把 VIP 配置在内部虚拟网卡 lo 上。</p>
<h2 id="5-LVS-DR-模型搭建"><a href="#5-LVS-DR-模型搭建" class="headerlink" title="5. LVS-DR 模型搭建"></a>5. LVS-DR 模型搭建</h2><p>问题：负载均衡服务器如何知道每个 RS 有多少连接？</p>
<p>答案：偷窥握手和分手的数据包</p>
<p><img src="../../images/hclb/LVS-实践.png" alt=""></p>
<h3 id="5-1-配置-VIP"><a href="#5-1-配置-VIP" class="headerlink" title="5.1 配置 VIP"></a>5.1 配置 VIP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// node01</div><div class="line">ifconfig eth0:2 192.168.238.100/24</div><div class="line">-- 撤销</div><div class="line">ifconfig eth0:2 down</div><div class="line"></div><div class="line">// node02/node03</div><div class="line">-- 修改内核配置 arp</div><div class="line"><span class="built_in">cd</span> /proc/sys/net/ipv4/conf/</div><div class="line"><span class="built_in">cd</span> eth0</div><div class="line">-- 重定向赋值</div><div class="line"><span class="built_in">echo</span> 1 &gt; arp_ignore</div><div class="line"><span class="built_in">echo</span> 2 &gt; arp_announce</div><div class="line"><span class="built_in">cd</span> ../all</div><div class="line"><span class="built_in">echo</span> 1 &gt; arp_ignore</div><div class="line"><span class="built_in">echo</span> 2 &gt; arp_announce</div><div class="line">-- 配置隐藏的 VIP</div><div class="line">ifconfig lo:2 192.168.238.100 netmask 255.255.255.255</div></pre></td></tr></table></figure>
<h3 id="5-2-安装-RS-中服务"><a href="#5-2-安装-RS-中服务" class="headerlink" title="5.2 安装 RS 中服务"></a>5.2 安装 RS 中服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// node02/node03</div><div class="line">yum install httpd -y</div><div class="line">service httpd start</div><div class="line">-- 创建主页</div><div class="line">vi /var/www/html/index.html</div><div class="line">	from 192.168.238.68/70</div><div class="line">-- 关闭防火墙</div><div class="line">service iptables status</div><div class="line">service iptables stop</div><div class="line">-- 浏览器访问验证服务是否正常</div><div class="line">http://192.168.238.68/</div><div class="line">http://192.168.238.70/</div></pre></td></tr></table></figure>
<h3 id="5-3-安装配置-LVS-工具"><a href="#5-3-安装配置-LVS-工具" class="headerlink" title="5.3 安装配置 LVS 工具"></a>5.3 安装配置 LVS 工具</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">-- node01</div><div class="line">yum install ipvsadm -y</div><div class="line">-- 进包规则(轮询调度)</div><div class="line">ipvsadm -A -t 192.168.238.100:80 -s rr</div><div class="line">-- 查看规则</div><div class="line">ipvsadm -ln </div><div class="line">-- 负载规则</div><div class="line">ipvsadm -a -t 192.168.238.100:80 -r 192.168.238.68 -g -w 1</div><div class="line">ipvsadm -a -t 192.168.238.100:80 -r 192.168.238.70 -g -w 1</div><div class="line">-- 浏览器访问验证</div><div class="line">http://192.168.238.100</div><div class="line">-- 看不到 80 端口的 socket 连接。说明 LVS 服务器不会和客户端握手</div><div class="line">netstat -natp </div><div class="line">-- 查看偷窥记录表</div><div class="line">ipvsadm -lnc</div><div class="line">	FIN_WAIT：连接过，偷窥了所有包，正常</div><div class="line">	SYN_RECE：基本上 lvs 都记录了，证明 lvs 没事，是后边网络层出问题了</div><div class="line"></div><div class="line">-- node02，删除 VIP，则在握手时就卡住了</div><div class="line">ifconfig lo:2 down</div><div class="line">-- 记录的是 SYN_RECE</div><div class="line">ipvsadm -lnc </div><div class="line">-- 重新加上，正常了</div><div class="line">ifconfig lo:2 192.168.238.100 netmask 255.255.255.255</div><div class="line"></div><div class="line">-- node02/03；可以看到很多 socket 连接</div><div class="line">netstat -natp</div></pre></td></tr></table></figure>
<h2 id="6-LVS-DR-keepalived-模型搭建"><a href="#6-LVS-DR-keepalived-模型搭建" class="headerlink" title="6. LVS-DR-keepalived 模型搭建"></a>6. LVS-DR-keepalived 模型搭建</h2><h3 id="6-1-问题引入和解决思路"><a href="#6-1-问题引入和解决思路" class="headerlink" title="6.1 问题引入和解决思路"></a>6.1 问题引入和解决思路</h3><p>前边搭建的服务的问题：</p>
<ol>
<li>如果 LVS 服务器挂了，虽然后边的 RS 都正常，整个系统也访问不了，业务下线，<strong>单点故障</strong>。</li>
<li>如果一台 RS 挂了，会导致负载到该台 RS 的用户访问失败，其他用户访问成功。</li>
</ol>
<p>解决：</p>
<ol>
<li>LVS <strong>单点故障</strong>问题：一变多（主备形式、主主形式），由于 VIP 原因，这里用主备形式来解决。<ol>
<li>备机如何知道主机挂了？（<strong>方向性</strong>）<ol>
<li>备机轮询访问主机，这样主机压力较大</li>
<li>主机定时广播自己状态</li>
</ol>
</li>
<li>主机挂了后，哪个备机升级为主机？（<strong>效率性</strong>）<ol>
<li>每个备机设置权重值，权重高的升级</li>
</ol>
</li>
</ol>
</li>
<li>RS 挂了的问题<ol>
<li>如何确定 RS 挂了？<ol>
<li>ping 是不对的，ping 是作用于网络层，只能确定网络是否正常，TCP 握手是否正常都无法确定。</li>
<li>验证应用层 http 协议，即发请求，判断返回是否是 200</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>keepalived：一个通用的应用层程序，代替人自动运维，解决单点故障，实现HA。</p>
<ol>
<li>监控自己的 LVS 服务</li>
<li>Master 通告自己还活着，Backup 监听 Master 状态，Master 挂了，一堆备机推选出一个新的 Master。</li>
<li>配置 VIP，添加 ipvs 模块配置，写入 keepalived 配置文件，启动自动配置</li>
<li>对 RS 做健康检查</li>
</ol>
<p>nginx 可以作为公司的负载均衡来用，nginx 本身成为了单点故障，也可以用 keepalived 来解决。</p>
<h3 id="6-2-模型搭建"><a href="#6-2-模型搭建" class="headerlink" title="6.2 模型搭建"></a>6.2 模型搭建</h3><p><img src="../../images/hclb/LVS-HA实践.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">-- 清除 node01 lvs 配置</div><div class="line">ipvsadm -C</div><div class="line">ipvsadm -ln</div><div class="line">-- 卸载 vip</div><div class="line">ifconfig eth0:2 down</div><div class="line">-- node01 node4</div><div class="line">-- 安装 keepalived</div><div class="line">yum install keepalived ipvsadm -y</div><div class="line">-- 配置 keeplived</div><div class="line"><span class="built_in">cd</span> /etc/keepalived</div><div class="line">cp keepalived.conf keepalived.conf.bak</div><div class="line">vi keepalived.conf</div><div class="line">-- 配置 node04</div><div class="line">scp ./keepalived.conf  root@192.168.238.72:`<span class="built_in">pwd</span>`</div><div class="line">-- 启动 node01 keepalived</div><div class="line">service keepalived start</div><div class="line">ifconfig/ipvsadm -ln 查看发现配置均自动完成</div><div class="line"></div><div class="line">-- 启动 node04 keepalived</div><div class="line">service keepalived start</div><div class="line">ifconfig/ipvsadm -ln 查看发现 IP 没有配置，但是 lvs 已经配置</div><div class="line"></div><div class="line">-- 验证 LVS HA</div><div class="line">-- 将 node01 物理网卡 down 掉</div><div class="line">ifconfig eth0 down</div><div class="line">-- node04 发现 ip 配置好了</div><div class="line">ifconfig</div><div class="line">-- 将 node01 物理网卡修复</div><div class="line">ifconfig eth0 up</div><div class="line">-- node04 发现 ip 卸载了</div><div class="line">ifconfig</div><div class="line"></div><div class="line">-- 验证 RS HA</div><div class="line">-- 关闭 node02 服务</div><div class="line">service httpd stop</div><div class="line">-- 只有 node03 的负载</div><div class="line">ipvsadm -ln </div><div class="line"></div><div class="line">-- 安装帮助文档	</div><div class="line">yum install man	</div><div class="line">man 5 keepalived.conf</div></pre></td></tr></table></figure>
<p>keepliaved 配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">! Configuration File <span class="keyword">for</span> keepalived</div><div class="line"><span class="comment"># 全局配置</span></div><div class="line">global_defs &#123;</div><div class="line">   <span class="comment"># 邮件提醒</span></div><div class="line">   notification_email &#123;</div><div class="line">     acassen@firewall.loc</div><div class="line">     failover@firewall.loc</div><div class="line">     sysadmin@firewall.loc</div><div class="line">   &#125;</div><div class="line">   notification_email_from Alexandre.Cassen@firewall.loc</div><div class="line">   smtp_server 192.168.200.1</div><div class="line">   smtp_connect_timeout 30</div><div class="line">   router_id LVS_DEVEL</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># vrrp：虚拟路由冗余协议</span></div><div class="line">vrrp_instance VI_1 &#123;</div><div class="line">	<span class="comment"># 主</span></div><div class="line">    state MASTER <span class="comment"># 备机修改为 BADKUP</span></div><div class="line">    <span class="comment"># 网卡，因为一台服务器可能有多个网卡，用于不同的网络服务</span></div><div class="line">    interface eth0</div><div class="line">    virtual_router_id 51</div><div class="line">    <span class="comment"># 权重</span></div><div class="line">    priority 100 <span class="comment"># 备机权重改小</span></div><div class="line">    advert_int 1</div><div class="line">    authentication &#123;</div><div class="line">        auth_type PASS</div><div class="line">        auth_pass 1111</div><div class="line">    &#125;</div><div class="line">    <span class="comment"># 相当于配置 VIP</span></div><div class="line">    virtual_ipaddress &#123;</div><div class="line">        192.168.238.100/24 dev eth0 label eth0:2</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># 相当于配置 A</span></div><div class="line">virtual_server 192.168.238.100 80 &#123;</div><div class="line">    delay_loop 6</div><div class="line">    lb_algo rr</div><div class="line">    lb_kind DR</div><div class="line">    nat_mask 255.255.255.0</div><div class="line">    <span class="comment"># 持久化超时时间，在超时时间内，同一用户访问相同资源，负载到同一台 RS，提升效率</span></div><div class="line">    persistence_timeout 0</div><div class="line">    protocol TCP</div><div class="line"></div><div class="line">	<span class="comment"># 相当于配置 a</span></div><div class="line">    real_server 192.168.238.68 80 &#123;</div><div class="line">        weight 1</div><div class="line">        <span class="comment"># 配置 RS 健康检查</span></div><div class="line">        HTTP_GET &#123;</div><div class="line">            url &#123;</div><div class="line">              path /</div><div class="line">              status_code 200</div><div class="line">            &#125;</div><div class="line">            connect_timeout 3</div><div class="line">            nb_get_retry 3</div><div class="line">            delay_before_retry 3</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    real_server 192.168.238.70 80 &#123;</div><div class="line">        weight 1</div><div class="line">        HTTP_GET &#123;</div><div class="line">            url &#123;</div><div class="line">              path /</div><div class="line">              status_code 200</div><div class="line">            &#125;</div><div class="line">            connect_timeout 3</div><div class="line">            nb_get_retry 3</div><div class="line">            delay_before_retry 3</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="6-3-keepalived-本身挂了如何处理？"><a href="#6-3-keepalived-本身挂了如何处理？" class="headerlink" title="6.3 keepalived 本身挂了如何处理？"></a>6.3 keepalived 本身挂了如何处理？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ps -ef | grep keep</div><div class="line">-- 强制杀死 keepalived 的三个进程，还没来得及回收资源</div><div class="line"><span class="built_in">kill</span> -9 xxxx/xxxx/xxxx</div><div class="line">ifconfig/ipvsadm 配置都没有删除</div><div class="line">-- node04：收不到 node01 的健康广播，认为 node01 挂了，自己变为 Master</div></pre></td></tr></table></figure>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol>
<li><a href="https://www.cnblogs.com/onepixel/p/7092302.html" target="_blank" rel="external">TCP/IP 协议</a></li>
<li><a href="https://blog.csdn.net/qq_38950316/article/details/81087809" target="_blank" rel="external">三次握手四次分手</a></li>
</ol>
</div><div class="tags"><a href="/tags/LVS/">LVS</a><a href="/tags/网络/">网络</a></div><div class="post-nav"><a class="pre" href="/2020-02-28-202002/Linux 系统安装简要步骤.html">Linux 系统安装简要步骤</a><a class="next" href="/2020-02-22-202002/NIO原理.html">NIO 原理</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Srping-Boot/">Srping Boot</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ZooKeeper/">ZooKeeper</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/加解密技术/">加解密技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/吉他/">吉他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/多线程/">多线程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列/">消息队列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/疯狂-Java-讲义/">疯狂 Java 讲义</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计划/">计划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/tags/计划/" style="font-size: 15px;">计划</a> <a href="/tags/PGP/" style="font-size: 15px;">PGP</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Samba/" style="font-size: 15px;">Samba</a> <a href="/tags/SFTP/" style="font-size: 15px;">SFTP</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/MQTT/" style="font-size: 15px;">MQTT</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/心情/" style="font-size: 15px;">心情</a> <a href="/tags/LVS/" style="font-size: 15px;">LVS</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/Eureka/" style="font-size: 15px;">Eureka</a> <a href="/tags/Srping-Boot/" style="font-size: 15px;">Srping Boot</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/吉他/" style="font-size: 15px;">吉他</a> <a href="/tags/疯狂-Java-讲义/" style="font-size: 15px;">疯狂 Java 讲义</a> <a href="/tags/ZooKeeper/" style="font-size: 15px;">ZooKeeper</a> <a href="/tags/Observer/" style="font-size: 15px;">Observer</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Singleton/" style="font-size: 15px;">Singleton</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.jamespan.me/" title="小鶸の道场" target="_blank">小鶸の道场</a><ul></ul><a href="https://www.haomwei.com/" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://www.ruanyifeng.com/home.html" title="阮一峰" target="_blank">阮一峰</a><ul></ul><a href="https://www.cnblogs.com/jingmoxukong/" title="静默虚空" target="_blank">静默虚空</a><ul></ul><a href="https://blog.hushhw.cn/" title="hushhw" target="_blank">hushhw</a><ul></ul><a href="https://hasaik.com/" title="hasaik" target="_blank">hasaik</a><ul></ul><a href="https://www.imalan.cn/" title="三无计划" target="_blank">三无计划</a><ul></ul><a href="https://i-meto.com/" title="meto" target="_blank">meto</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">悟空.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>