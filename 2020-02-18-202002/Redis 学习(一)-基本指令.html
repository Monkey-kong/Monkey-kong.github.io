<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="悟空的技术博客"><title>Redis 学习(一)-概述、安装、类型、指令 | 悟空</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Redis 学习(一)-概述、安装、类型、指令</h1><a id="logo" href="/.">悟空</a><p class="description">悟空的技术博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Redis 学习(一)-概述、安装、类型、指令</h1><div class="post-meta">Feb 18, 2020<span> | </span><span class="category"><a href="/categories/数据库/">数据库</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Redis-前世今生"><span class="toc-text">1. Redis 前世今生</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-0-一点常识"><span class="toc-text">1.0 一点常识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-最初数据是存在文件中"><span class="toc-text">1.1 最初数据是存在文件中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-关系型数据库"><span class="toc-text">1.2 关系型数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-关系型内存数据库缺点"><span class="toc-text">1.3 关系型内存数据库缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-key-value-型内存数据库-Redis"><span class="toc-text">1.4 key-value 型内存数据库 Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-Redis-和-memcached-对比"><span class="toc-text">1.5 Redis 和 memcached 对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-对比各类数据库"><span class="toc-text">1.4 对比各类数据库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-卸载-安装-Redis"><span class="toc-text">2. 卸载/安装 Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-安装-Redis"><span class="toc-text">2.1 安装 Redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-卸载-Redis"><span class="toc-text">2.2 卸载 Redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Redis-单线程理解"><span class="toc-text">3. Redis 单线程理解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Redis-五种-value-类型"><span class="toc-text">4. Redis 五种 value 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-string"><span class="toc-text">4.1 string</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-string-类型应用"><span class="toc-text">4.1.1 string 类型应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-数值类型应用"><span class="toc-text">4.1.2 数值类型应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-bitmap-类应用"><span class="toc-text">4.1.3 bitmap 类应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-4-bitfield-命令理解"><span class="toc-text">4.1.4 bitfield 命令理解</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-list"><span class="toc-text">4.2 list</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-list-应用场景"><span class="toc-text">4.2.1 list 应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-hash"><span class="toc-text">4.3 hash</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-hash-引用场景"><span class="toc-text">4.3.1 hash 引用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-set"><span class="toc-text">4.4 set</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-set-应用场景"><span class="toc-text">4.4.1 set 应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-sorted-set"><span class="toc-text">4.5 sorted_set</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-1-sorted-set-使用场景"><span class="toc-text">4.5.1 sorted set 使用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-2-字典规则-lexicographical"><span class="toc-text">4.5.2 字典规则  lexicographical</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-3-跳跃表"><span class="toc-text">4.5.3 跳跃表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Redis-通用指令"><span class="toc-text">5. Redis 通用指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-scan-命令理解"><span class="toc-text">5.1 scan 命令理解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-学习地址记录"><span class="toc-text">6. 学习地址记录</span></a></li></ol></div></div><div class="post-content"><p>Redis 来由、安装、集中基本类型和指令学习笔记。<br><a id="more"></a></p>
<h2 id="1-Redis-前世今生"><a href="#1-Redis-前世今生" class="headerlink" title="1. Redis 前世今生"></a>1. Redis 前世今生</h2><h3 id="1-0-一点常识"><a href="#1-0-一点常识" class="headerlink" title="1.0 一点常识"></a>1.0 一点常识</h3><ul>
<li>磁盘寻址速度 ms 级别，带宽 G 或 M 级别</li>
<li>内存寻址速度 ns 级别，比磁盘寻址快了 10 万倍，带宽极大</li>
<li>磁盘有磁道和扇区，一扇区默认 512 Byte。</li>
</ul>
<h3 id="1-1-最初数据是存在文件中"><a href="#1-1-最初数据是存在文件中" class="headerlink" title="1.1 最初数据是存在文件中"></a>1.1 最初数据是存在文件中</h3><p>比如 linux 使用 grep、awk 来检索数据，随着文件的变大，速度会变慢。因为是<strong>全量检索</strong>，会遇到磁盘寻址和吞吐的瓶颈。数据库使用<strong>分治</strong>来解决，Redis 作为缓存，存的不是全量数据，而是热数据。</p>
<h3 id="1-2-关系型数据库"><a href="#1-2-关系型数据库" class="headerlink" title="1.2 关系型数据库"></a>1.2 关系型数据库</h3><p>数据库使用多个 datapage 存储表的数据，每个 datapage 4k （可以调整）大小，把<strong>数据分开存储</strong>，然后可以有索引来检索这些数据，索引也是存储在 datapage 中。索引使用内存里的 B+ 树来管理，B+ 树树干是在内存中，索引放在 B+ 树的叶子上，sql 语句中 where 条件只要命中索引， B+ 树就沿着树干找到索引的叶子，然后把叶子 datapage 读到内存解析，然后知道解析（放到内存中）哪些数据 datapage。</p>
<p>结构图如下：</p>
<p><img src="../../images/redis1/关系型数据库结构.png" alt=""></p>
<p><strong>问题：</strong>关系型数据库建表时为什么必须给出 schema ? </p>
<p><strong>答案：</strong>因为存储数据时，倾向于行级存储。就是说即使这个表有十个字段，有一行数据只有一个字段有值，存储时也会开辟十个字段的 datapage。这样的好处是<strong>后边增删改这行数据就不用做偏移了，直接重写</strong>就行。</p>
<p><strong>问题：</strong>数据库表很大，会导致性能下降？</p>
<p><strong>答案：</strong>如果表有索引，增删改需要维护索引，性能会变慢。查询则分两种情况：1. 一个或少量查询依然会很快。 2. 并发大的时候会受到<strong>磁盘带宽</strong>的影响导致速度变慢</p>
<p>问题：什么是 4k 对齐？</p>
<p>答案：正常来说，磁盘一个扇区 512 Byte。所谓 4k 对齐就是指按照 4k 来划分小格子，索引的体量大小变小了，操作系统读取的时候，不论读取多大的数据都是按照 4k 读取。注意磁盘格子的大小不一定是 4k，这取决于上层应用。比如上层应用主要用于存储视频，音频等，4k 可能太小了，浪费了磁盘寻址时间，反而得不偿失。</p>
<p><strong>缺点：</strong></p>
<ul>
<li>数据是存在磁盘的文件里。随着文件变大，速度会变慢，因为硬盘 I/O 成为瓶颈。</li>
<li>磁盘寻址慢</li>
<li>随着数据量增大，索引成本变大</li>
</ul>
<h3 id="1-3-关系型内存数据库缺点"><a href="#1-3-关系型内存数据库缺点" class="headerlink" title="1.3 关系型内存数据库缺点"></a>1.3 关系型内存数据库缺点</h3><p>如果直接使用关系型内存数据库，速度确实快，比如 SAP 公司的 HANA 数据库就是关系型内存数据库，但是价格太贵，一般买不起。但是磁盘数据库又太慢了。</p>
<p>所以出现了折中方案：key-value 型内存数据库： <strong>memcached、Redis</strong></p>
<h3 id="1-4-key-value-型内存数据库-Redis"><a href="#1-4-key-value-型内存数据库-Redis" class="headerlink" title="1.4 key-value 型内存数据库 Redis"></a>1.4 key-value 型内存数据库 Redis</h3><p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作<strong>数据库、缓存和消息中间件</strong>。 </p>
<p>Redis 支持多种类型的数据结构，如字符串、散列、列表、集合、有序集合与范围查询，bitmaps、hyperloglogs 和地理空间索引半径查询。</p>
<p>Redis 内置了复制，LUA 脚本，LRU 驱动事件，事务和不同级别的磁盘持久化，并通过 Redis 哨兵和自动分区提供高可用性。</p>
<h3 id="1-5-Redis-和-memcached-对比"><a href="#1-5-Redis-和-memcached-对比" class="headerlink" title="1.5 Redis 和 memcached 对比"></a>1.5 Redis 和 memcached 对比</h3><p>在 Redis 之前，有memcached，也是 key-value 型数据库，但是它的 value 没有类型的概念，所以更多人选择使用 Redis。</p>
<p><strong>问题：</strong> memcached 的 value 也可以用 json 来存储复杂的数据结构，为啥会选择 Redis？</p>
<p><strong>答案：</strong>因为获取数据成本不同，比如从一个 list 类型的 value 中取一个元素：</p>
<ul>
<li>memcached 需要返回 value 所有的数据到客户端，就是整个 list json 数据。会导致两个问题：1. server 端网卡 IO 限制。2. 客户端需要自己实现代码去解码 json。</li>
<li>Redis 其实类型不是很重要，<strong>它本身是二进制安全的</strong>，重要的是 Redis 中对每种类型都有自己的方法。比如根据 index、lpop 等。避免的上面的两个问题（返回需要的数据，降低 I/O 消耗；计算向数据移动，计算主要在 Redis server 端完成）。</li>
</ul>
<p><strong>问题：</strong>Redis 为什么不用 sql 查询，而是 key-value？</p>
<p><strong>答案：</strong>因为 Redis 设计的初衷不是存储全量数据，而是存储部分数据。部分数据无法维护类似关系型数据库中的<strong>约束、范式</strong>，所以还不如面向数据本身，把场景简单化。</p>
<h3 id="1-4-对比各类数据库"><a href="#1-4-对比各类数据库" class="headerlink" title="1.4 对比各类数据库"></a>1.4 对比各类数据库</h3><p>可以参考： <a href="https://db-engines.com/en/" target="_blank" rel="external">https://db-engines.com/en/</a> </p>
<h2 id="2-卸载-安装-Redis"><a href="#2-卸载-安装-Redis" class="headerlink" title="2. 卸载/安装 Redis"></a>2. 卸载/安装 Redis</h2><h3 id="2-1-安装-Redis"><a href="#2-1-安装-Redis" class="headerlink" title="2.1 安装 Redis"></a>2.1 安装 Redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">// 1. 检查是否已经安装 wget</div><div class="line">rpm -qa|grep wget</div><div class="line">// 2. 如果没有安装则安装 wget</div><div class="line">yum install wget</div><div class="line">// 3. 下载 redis 源码到家目录</div><div class="line"><span class="built_in">cd</span> ~</div><div class="line">mkdir soft</div><div class="line"><span class="built_in">cd</span> soft</div><div class="line">wget http://download.redis.io/releases/redis-5.0.5.tar.gz</div><div class="line">// 4. 解压源码</div><div class="line">tar xf redis-5.0.5.tar.gz</div><div class="line">// 5. 阅读 README.md 文件</div><div class="line"><span class="built_in">cd</span> redis--5.0.5</div><div class="line">vi README.md</div><div class="line">// 6. 编译源码</div><div class="line">make</div><div class="line">// 7. 如果提示 cc:<span class="built_in">command</span> not found；否则跳过</div><div class="line">yum install gcc</div><div class="line">make distclean</div><div class="line">make</div><div class="line">// 8. 发现源码 src 目录已经生成了可执行文件</div><div class="line">// 9. 安装 redis 到指定目录</div><div class="line">make install PREFIX=/opt/alvin/redis5</div><div class="line">// 10. 添加 path 环境变量</div><div class="line">vi /etc/profile</div><div class="line">  <span class="built_in">export</span> REDIS_HOME=/opt/alvin/redis5</div><div class="line">  <span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$REDIS_HOME</span>/bin</div><div class="line">// 11. 刷新环境变量</div><div class="line"><span class="built_in">source</span> /etc/profile</div><div class="line">// 12. 将 redis 安装为服务</div><div class="line"><span class="built_in">cd</span> utils</div><div class="line">// 可执行一次或者多次</div><div class="line">// a) 一个物理机中可以有多个 redis 实例（进程），通过端口号区分</div><div class="line">// b) 可执行程序就一份在目录，但是内存中未来的多个实例需要各自的配置文件，持久化目录等</div><div class="line">// c) redis 服务已经自动启动</div><div class="line">../../install_server.sh</div><div class="line">// 13. 查看服务状态</div><div class="line">service redis_6379 status</div><div class="line">// 14. 查看 redis 服务进程</div><div class="line">ps -ef|grep redis</div></pre></td></tr></table></figure>
<p><img src="../../images/redis1/安装redis1.png" alt=""></p>
<h3 id="2-2-卸载-Redis"><a href="#2-2-卸载-Redis" class="headerlink" title="2.2 卸载 Redis"></a>2.2 卸载 Redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 1. 检查是否已经安装 redis</div><div class="line">whereis redis-server</div><div class="line">// 2. 如果安装了，停止 redis 服务</div><div class="line">service redis_6379 stop</div><div class="line">// 3. 删除 redis 服务</div><div class="line">// 不删除也无影响</div><div class="line">// 4. 删除安装文件</div><div class="line">rm -rf redis5</div><div class="line">// 5. 删除源码</div><div class="line">rm -rf redis-5.0.5</div><div class="line">rm -rf redis-5.0.5.tar.gz</div></pre></td></tr></table></figure>
<p><img src="../../images/redis1/卸载redis.png" alt=""></p>
<h2 id="3-Redis-单线程理解"><a href="#3-Redis-单线程理解" class="headerlink" title="3. Redis 单线程理解"></a>3. Redis 单线程理解</h2><p>一台物理机上可以安装多个 Redis 实例，Redis 服务端处理是单进程、单线程、单实例的。当并发很多的请求的时候，它是如何变得很快的？</p>
<p>I/O 多路复用模型。</p>
<h2 id="4-Redis-五种-value-类型"><a href="#4-Redis-五种-value-类型" class="headerlink" title="4. Redis 五种 value 类型"></a>4. Redis 五种 value 类型</h2><h3 id="4-1-string"><a href="#4-1-string" class="headerlink" title="4.1 string"></a>4.1 string</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line">// =================通用类开始====================</div><div class="line">// 查看帮助</div><div class="line">redis-cli -<span class="built_in">help</span></div><div class="line">// 客服端连接 -n 表示连那个库，一共有16个库</div><div class="line">redis-cli -p 6379 -n 0</div><div class="line">// 不带raw：redis 只会识别 ascii 码，超出 ascii 直接显示 16 进制</div><div class="line">// 带了raw：会触发编码集的格式化。发现了当前的十六进制符合当前编码字符集的规则，就会转换</div><div class="line">redis-cli --raw</div><div class="line">// 切换库</div><div class="line">select 8</div><div class="line">// 如何学习命令</div><div class="line"><span class="built_in">help</span></div><div class="line">// 查看 value 类型</div><div class="line"><span class="built_in">type</span> k1</div><div class="line">// <span class="built_in">type</span> 还是 string，因为 <span class="built_in">set</span> 命令是 string 组的</div><div class="line"><span class="built_in">set</span> k1 99</div><div class="line">object <span class="built_in">help</span></div><div class="line">// 查看 value 编码 int</div><div class="line">object encoding k1</div><div class="line">// =================通用类结束====================</div><div class="line">// =================字符串类开始===================</div><div class="line">// nx（只能新增）：k1 不存在的时候才操作</div><div class="line"><span class="built_in">set</span> k1 ooxx nx</div><div class="line">// xx（只能更新）：k2 存在的时候才操作</div><div class="line"><span class="built_in">set</span> k2 hello xx</div><div class="line">setex k1 5 aaa</div><div class="line">psetex k1 5000 aaa</div><div class="line">// mset、mget 设置、获取多条</div><div class="line">mset k3 a k4 b</div><div class="line">mget k3 k4</div><div class="line">// msetnx(只能新增)</div><div class="line">msetnx k1 a k2 b</div><div class="line">msetnx k2 c k3 d</div><div class="line">// 只找到 k1、k2 说明 msetnx 是原子性的</div><div class="line">mget k1 k2 k3</div><div class="line">// append 追加</div><div class="line">append k1 <span class="string">" world"</span></div><div class="line">// getrange 获取索引范围内字节</div><div class="line">getrange k1 6 10</div><div class="line">// 有正向索引和反向索引</div><div class="line">getrange k1 6 -1</div><div class="line">getrange k1 0 -1</div><div class="line">// 覆盖指定位置开始的字符串，能覆盖多少就覆盖多少</div><div class="line">setrange k1 6 mashibing</div><div class="line">// 字符串长度</div><div class="line">strlen k1</div><div class="line">// =================字符串类结束===================</div><div class="line">// =================数值类开始=====================</div><div class="line">// 加1</div><div class="line">incr k1</div><div class="line">// 加22</div><div class="line">incrby k1 22</div><div class="line">// 减1</div><div class="line">decr k1</div><div class="line">// 减22</div><div class="line">decrby k1 22</div><div class="line">// 加0.5</div><div class="line">incrbyfloat k1 0.5</div><div class="line">// =================数值类结束=====================</div><div class="line">// =================bitmap类开始==================</div><div class="line">// 面向字节有索引，二进制位也有索引</div><div class="line">// offset 的 1 是指位索引的第二个位置设置为 1</div><div class="line">// 注意 setbit 是位级别 <span class="built_in">set</span></div><div class="line">// strlen为1 @</div><div class="line">setbit k1 1 1</div><div class="line">// strlen为1 A</div><div class="line">setbit k1 7 1</div><div class="line">// strlen为2 A@</div><div class="line">setbit k1 9 1</div><div class="line">getbit k1 0</div><div class="line">// 指定范围直接内，查询第一次出现指定位的位索引：1</div><div class="line">bitpos k1 1 0 0</div><div class="line">// 9</div><div class="line">bitpos k1 1 1 1</div><div class="line">// 1：第一个字节到第二个字节，1第一次出现1的位索引</div><div class="line">bitpos k1 1 0 1</div><div class="line">// 4：第一个字节到第二个字节1出现的次数</div><div class="line">bitcount k1 0 1</div><div class="line">// k1 k2 按位与的结果存到 andkey</div><div class="line">bitop and andkey k1 k2</div><div class="line">// 按位或</div><div class="line">bitop or orkey k1 k2</div><div class="line">// =================bitmap类结束==================</div></pre></td></tr></table></figure>
<h4 id="4-1-1-string-类型应用"><a href="#4-1-1-string-类型应用" class="headerlink" title="4.1.1 string 类型应用"></a>4.1.1 string 类型应用</h4><ol>
<li>分布式锁： string 类型的 setnx 的作用是“当 key 不存在时，设值并返回 1，当 key 已经存在时，不设值并返回 0”，“判断 key 是否存在”和“设值”两个操作是原子性地执行的，因此可以用 string 类型作为分布式锁，返回 1 表示获得锁，返回 0 表示没有获得锁。 </li>
<li>存储对象：对象转为 json，存入 Redis。</li>
</ol>
<h4 id="4-1-2-数值类型应用"><a href="#4-1-2-数值类型应用" class="headerlink" title="4.1.2 数值类型应用"></a>4.1.2 数值类型应用</h4><p>计数器：抢购、秒杀、点赞、评论数。<strong>规避并发下，对数据库的事务操作</strong>，完全由 reids 内存操作代替。</p>
<h4 id="4-1-3-bitmap-类应用"><a href="#4-1-3-bitmap-类应用" class="headerlink" title="4.1.3 bitmap 类应用"></a>4.1.3 bitmap 类应用</h4><ol>
<li><p>有一个用户系统，需要统计用户登录天数，且窗口（日期）随机，怎么统计？</p>
<p>使用用户 id 作为 key，value 为 bitmap，位索引表示日期，位值为 1 表示登录了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// alvin 第二天登录了</div><div class="line">setbit alvin 1 1</div><div class="line">// alvin 第八天登录了</div><div class="line">setbit alvin 7 1</div><div class="line">// alvin 第 365 天登录了</div><div class="line">setbit alvin 364 1</div><div class="line">// 仅占用 46 个字节</div><div class="line">strlen alvin</div><div class="line">// 今年最后 16 天 alvin 登录次数</div><div class="line">bitcount alvin -2 -1</div><div class="line">// 问题：最后 15 天怎么统计呢？窗口期只能是 8 的倍数？或者索引全部乘以 8，这样空间又提升了 8 倍。或者 getbit 一个一个取，这样访问量又上去了，考虑使用管道或许可行。</div></pre></td></tr></table></figure>
</li>
<li><p>京东 618 做活动，送礼物，大库应该备货多少？即活跃用户统计。</p>
<p>以日期作为 key，value 为 bitmap，位索引表示员工编号，位值为 1 表示登录了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// 一月一日一号员工登录</div><div class="line">setbit 20190101 1 1</div><div class="line">// 一月二日一号员工登录</div><div class="line">setbit 20190102 1 1</div><div class="line">// 一月二日七号员工登录</div><div class="line">setbit 20190102 7 1</div><div class="line">// 一日、二日这两天多少人登录了？</div><div class="line">bitop or destkey 20190101 20190102</div><div class="line">bitcount destkey 0 -1</div><div class="line">// 问题：实际情况员工或者用户 id 不一定是 1 开始排序。</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="4-1-4-bitfield-命令理解"><a href="#4-1-4-bitfield-命令理解" class="headerlink" title="4.1.4 bitfield 命令理解"></a>4.1.4 bitfield 命令理解</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">// BITFIELD key </div><div class="line">// [GET <span class="built_in">type</span> offset] </div><div class="line">// [SET <span class="built_in">type</span> offset value] </div><div class="line">// [INCRBY <span class="built_in">type</span> offset increment] </div><div class="line">// [OVERFLOW WRAP|SAT|FAIL]</div><div class="line"><span class="built_in">set</span> key1 a</div><div class="line">// 97,a ASCII 码就是 97</div><div class="line">bitfield key1 get i8 0</div><div class="line"></div><div class="line">// 有符号 8 位，表数范围（-128~127）</div><div class="line">bitfield key1 <span class="built_in">set</span> i8 0 127</div><div class="line">// 127</div><div class="line">bitfield key1 get i8 0</div><div class="line">// 溢出默认 WARP</div><div class="line">bitfield key1 <span class="built_in">set</span> i8 0 128</div><div class="line">// -128</div><div class="line">bitfield key1 get i8 0</div><div class="line">// 设置溢出 sat</div><div class="line">bitfield key1 overflow sat <span class="built_in">set</span> i8 0 128</div><div class="line">// 127</div><div class="line">bitfield key1 get i8 0</div><div class="line">// 设置溢出 fail</div><div class="line">bitfield key1 overflow fail <span class="built_in">set</span> i8 0 128</div><div class="line">// 127(没有变化)</div><div class="line">bitfield key1 get i8 0</div><div class="line"></div><div class="line">// 无符号 8 位，表数范围（0~255）</div><div class="line">bitfield key1 <span class="built_in">set</span> u8 0 255</div><div class="line">// 255</div><div class="line">bitfield key1 get u8 0</div><div class="line">// 溢出默认 WARP</div><div class="line">bitfield key1 <span class="built_in">set</span> u8 0 257</div><div class="line">// 1</div><div class="line">bitfield key1 get u8 0</div><div class="line">// 设置溢出 sat</div><div class="line">bitfield key1 overflow sat <span class="built_in">set</span> u8 0 257</div><div class="line">// 255</div><div class="line">bitfield key1 get u8 0</div><div class="line">// 设置溢出 fail</div><div class="line">bitfield key1 overflow fail <span class="built_in">set</span> u8 0 257</div><div class="line">// 255（没有变化）</div><div class="line">bitfield key1 get u8 0</div><div class="line"></div><div class="line">// 0110 0001</div><div class="line"><span class="built_in">set</span> key1 a</div><div class="line">// 97</div><div class="line">bitfield key1 get i8 0</div><div class="line">// 110 00010 ==&gt; -62</div><div class="line">bitfield key1 get i8 1</div></pre></td></tr></table></figure>
<h3 id="4-2-list"><a href="#4-2-list" class="headerlink" title="4.2 list"></a>4.2 list</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">// 向前追加</div><div class="line">lpush k1 a b c d e f</div><div class="line">// list 存在才 push</div><div class="line">lpushx k1 g h</div><div class="line">// 向后追加</div><div class="line">rpush k2 a b c d e f</div><div class="line">// list 存在才 push</div><div class="line">rpushx k2 g h</div><div class="line">// 删除并获取第一个</div><div class="line">lpop k1</div><div class="line">// 删除并获取最后一个</div><div class="line">rpop k1</div><div class="line">// 删除 lista 最后一个元素，prepend 到 listb</div><div class="line">rpoplpush</div><div class="line">// 有正向索引和反向索引</div><div class="line">lrange k1 0 -1</div><div class="line">// 根据索引获取 list 元素</div><div class="line">lindex k1 2</div><div class="line">// 反向索引</div><div class="line">lindex k1 -1</div><div class="line">// 根据索引设置值（不可超出索引范围）</div><div class="line">lset k1 3 xxxxx</div><div class="line">lrange k1 0 -1</div><div class="line">// 从左向右删除两个a</div><div class="line">lrem k1 2 a</div><div class="line">// 从右向左删除两个a</div><div class="line">lrem k3 -2 a</div><div class="line">// 在元素 6 后面插入 a</div><div class="line">linsert k3 after 6 a</div><div class="line">linsert k3 before 3 a</div><div class="line">// 删除索引两边的元素</div><div class="line">ltrim k3 2 -2</div><div class="line">ltrim k1 1 0</div><div class="line">// list 长度</div><div class="line">llen k1</div><div class="line">// block 版，没拿到数据则阻塞，timeout:秒</div><div class="line">blpop k1 0</div><div class="line">brpop k1 0</div><div class="line">brpoplpush</div></pre></td></tr></table></figure>
<h4 id="4-2-1-list-应用场景"><a href="#4-2-1-list-应用场景" class="headerlink" title="4.2.1 list 应用场景"></a>4.2.1 list 应用场景</h4><ol>
<li>实现各种数据结构：栈、队列、数组、阻塞的单播队列</li>
</ol>
<p><img src="../../images/redis1/list应用场景.png" alt=""></p>
<ol>
<li>定时计算的排行榜：实时计算的排行榜需要由 sorted set 来实现。当然 sorted set 也可以实现定时计算的排行榜，但是 sorted set 占用内存比 list 多，数据量大时需要具体考虑如何选择。</li>
</ol>
<h3 id="4-3-hash"><a href="#4-3-hash" class="headerlink" title="4.3 hash"></a>4.3 hash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">hset alvin name lixianfu age 18 address sz</div><div class="line">hmset alvin </div><div class="line">hsetnx alvin name alvin</div><div class="line">hget alvin name</div><div class="line">hgetall alvin</div><div class="line">hmget alvin name age</div><div class="line">hkeys alvin</div><div class="line">hvals alvin</div><div class="line">hincrby alvin age 1</div><div class="line">hincrbyfloat alvin age 0.5</div><div class="line">hdel alvin name address</div><div class="line">hexists alvin address</div><div class="line">// field 个数</div><div class="line">hlen alvin</div><div class="line">// 某个field 对应的 value 长度</div><div class="line">hstrlen alvin name</div><div class="line">// 迭代，同 scan 用法一样</div><div class="line">hscan alvin</div></pre></td></tr></table></figure>
<h4 id="4-3-1-hash-引用场景"><a href="#4-3-1-hash-引用场景" class="headerlink" title="4.3.1 hash 引用场景"></a>4.3.1 hash 引用场景</h4><ol>
<li>购物车：用户 id 为 key，商品 id 为 field，商品数量为 value。</li>
<li>存储对象： hash类型的(key, field, value)的结构与对象的(对象id, 属性, 值)的结构相似，也可以用来存储对象。  string + json 也可存储对象，但是不够灵活，如果对象某个属性修改频繁，可以考虑 hash</li>
</ol>
<h3 id="4-4-set"><a href="#4-4-set" class="headerlink" title="4.4 set"></a>4.4 set</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">// 新增元素</div><div class="line">sadd k1 alvin don calvin tyler alvin</div><div class="line">// 成员数量</div><div class="line">scard k1</div><div class="line">// 所有成员</div><div class="line">smembers k1</div><div class="line">// 删除成员</div><div class="line">srem k1 calvin</div><div class="line">// 判断成员是否存在</div><div class="line">sismember k1 alvin</div><div class="line">// 交集</div><div class="line">sadd k2 1 2 3 4 5 </div><div class="line">sadd k3 4 5 6 7 8 </div><div class="line">// 如果结果需要存入redis，需要客户端取出结果后，再 sadd </div><div class="line">sinter k2 k3</div><div class="line">// 减少了一个数据的交互过程</div><div class="line">sinterstore destkey k2 k3</div><div class="line">smembers destkey</div><div class="line">// 并集</div><div class="line">sunion k2 k3</div><div class="line">sunionstore destkey1 k2 k3</div><div class="line">smembers destkey1</div><div class="line">// 差集</div><div class="line">sdiff k2 k3</div><div class="line">sdiff k3 k2</div><div class="line">sdiffstore destkey k2 k3</div><div class="line">// 随机事件</div><div class="line">sadd k1 tom ooxx xxoo xoxo oxox xoox oxxo</div><div class="line">// 随机取出3个元素，元素不同。每个人最多中一次奖品</div><div class="line">srandmember k1 3</div><div class="line">// 随机取出3个元素，元素可能相同。可能一个人中两个奖品</div><div class="line">srandmember k1 -3</div><div class="line">// 取出并删除2个元素。年会抽奖（抽出去后不放回来）</div><div class="line">spop k1 2</div><div class="line">// 移动</div><div class="line">smove k1 k2 alvin</div><div class="line">// 分页查询</div><div class="line">sscan k1 0 count 2</div></pre></td></tr></table></figure>
<h4 id="4-4-1-set-应用场景"><a href="#4-4-1-set-应用场景" class="headerlink" title="4.4.1 set 应用场景"></a>4.4.1 set 应用场景</h4><ol>
<li>好友/关注/粉丝/感兴趣的人集合 <ol>
<li>sinter 命令可以获得 A 和 B 两个用户的共同好友 </li>
<li>sismember 命令可以判断A是否是B的好友 </li>
<li>scard 命令可以获取好友数量 </li>
<li>关注时，move 命令可以将 B从 A 的粉丝集合转移到 A 的好友集合 </li>
</ol>
</li>
<li>随机展示 </li>
<li>黑名单/白名单： sismember 判断是否在黑名单、白名单</li>
</ol>
<h3 id="4-5-sorted-set"><a href="#4-5-sorted-set" class="headerlink" title="4.5 sorted_set"></a>4.5 sorted_set</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">// 新增元素。nx/xx ch incr</div><div class="line">zadd k1 8 apple 2 banana 3 orange</div><div class="line">// 元素数量</div><div class="line">zcard k1</div><div class="line">// 指定分值之间的元素个数</div><div class="line">zcount k1 10 50</div><div class="line">// 增加元素分值</div><div class="line">zincrby k1 10 apple</div><div class="line">// 字母排序</div><div class="line">zlexcount k1 - +</div><div class="line">// 返回并删除</div><div class="line">zpopmax k1 2</div><div class="line">zpopmin k1 2</div><div class="line">// 索引范围查询</div><div class="line">zrange k1 0 -1</div><div class="line">zrange k1 0 -1 withscores</div><div class="line">// 价格由低到高取出前两名</div><div class="line">zrange k1 0 1</div><div class="line">// 价格由高到底前两名</div><div class="line">zrevrange k1 0 1</div><div class="line">// 字母排序</div><div class="line">zrangebylex k1 - +</div><div class="line">zrevrangebylex k1 10 50</div><div class="line">// 分值范围查询</div><div class="line">zrangebyscore k1 10 50</div><div class="line">zrevrangebyscore k1 10 50</div><div class="line">// 从一个或多个<span class="built_in">set</span>中返回并删除分值最高的元素，block 命令</div><div class="line">bzpopmax k1 k2 0</div><div class="line">// 同上，返回最小</div><div class="line">bzpopmin k1 k2 0</div><div class="line">// 取出分值</div><div class="line">zscore k1 apple</div><div class="line">// 取出排名</div><div class="line">zrank k1 apple</div><div class="line">// 倒数第几名</div><div class="line">zrevrank k1 apple</div><div class="line">// 修改分值(会自动刷新顺序)</div><div class="line">// 实现歌曲排名</div><div class="line">zincrby k1 2.5 banana</div><div class="line">// 删除元素</div><div class="line">zrem k1 apple banana</div><div class="line">// 字母排序</div><div class="line">zremreangebylex k1 - +</div><div class="line">// 根据排名删除</div><div class="line">zremrangebyrank k1 1 3</div><div class="line">// 根据分值删除</div><div class="line">zremrangebyscore k1 10 50</div><div class="line">// 交集</div><div class="line">zadd k1 80 tom 60 sean 70 baby</div><div class="line">zadd k2 60 tom 100 sean 40 yiming</div><div class="line">zinterstore unkey 2 k1 k2</div><div class="line">zinterstore unkey1 2 k1 k2 weights 1 0.5</div><div class="line">zinterstore unkey2 2 k1 k2 aggregate max</div><div class="line">// 并集</div><div class="line">zadd k1 80 tom 60 sean 70 baby</div><div class="line">zadd k2 60 tom 100 sean 40 yiming</div><div class="line">zunionstore unkey 2 k1 k2</div><div class="line">zunionstore unkey1 2 k1 k2 weights 1 0.5</div><div class="line">zunionstore unkey2 2 k1 k2 aggregate max</div><div class="line">// 遍历</div><div class="line">zscan</div></pre></td></tr></table></figure>
<h4 id="4-5-1-sorted-set-使用场景"><a href="#4-5-1-sorted-set-使用场景" class="headerlink" title="4.5.1 sorted set 使用场景"></a>4.5.1 sorted set 使用场景</h4><p>排名、热点话题。</p>
<h4 id="4-5-2-字典规则-lexicographical"><a href="#4-5-2-字典规则-lexicographical" class="headerlink" title="4.5.2 字典规则  lexicographical"></a>4.5.2 字典规则  lexicographical</h4><p>根据字典顺序比较大小。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ZADD myzset1 0 aaa 0 b 0 c 0 d 0 e</div><div class="line">ZADD myzset1 0 foo 0 zap 0 zip 0 ALPHA 0 alpha</div><div class="line">// 和 zrange myzset 0 -1 等价</div><div class="line">zrangebylex myzset - +</div><div class="line">ZRANGEBYLEX myzset1 [alpha [omega</div><div class="line">ZRANGEBYLEX myzset1 [alpha [fmaga</div><div class="line">ZRANGEBYLEX myzset1 [alpha [f</div><div class="line">ZRANGEBYLEX myzset1 [alpha [fop</div></pre></td></tr></table></figure>
<p>使用场景</p>
<ul>
<li>电话号码排序<ul>
<li>获取所有号码：ZRANGEBYLEX phone - +</li>
<li>获取132号段：ZRANGEBYLEX phone [132 (133</li>
</ul>
</li>
<li>姓名排序<ul>
<li>获取所有人名字：ZRANGEBYLEX phone [132 (133</li>
<li>A开头的所有人 ：ZRANGEBYLEX names [A (B</li>
</ul>
</li>
</ul>
<p><strong>问题：</strong>sorted_set 排序是怎么实现的，增删改查的速度怎么样？</p>
<p><strong>答案：跳跃表</strong>实现的。平均事件复杂度：O(logN)</p>
<h4 id="4-5-3-跳跃表"><a href="#4-5-3-跳跃表" class="headerlink" title="4.5.3 跳跃表"></a>4.5.3 跳跃表</h4><p>单链表查询的事件复杂度是 O(n) 而且很难优化了。所以引入跳跃表，跳跃表是基于概率的，时间复杂度是  O(logn) 。</p>
<p><img src="../../images/redis1/跳跃表.png" alt=""></p>
<h2 id="5-Redis-通用指令"><a href="#5-Redis-通用指令" class="headerlink" title="5. Redis 通用指令"></a>5. Redis 通用指令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">// OK</div><div class="line">del k1 k2</div><div class="line">// OK 返回序列化。有何用处？</div><div class="line">dump k1</div><div class="line">// OK</div><div class="line">exists k1</div><div class="line">// OK</div><div class="line">expire k1 20</div><div class="line">// OK 到达指定时间戳过期</div><div class="line">expireat k1 timestamp</div><div class="line">// OK 设置毫秒</div><div class="line">pexpire k1 2000</div><div class="line">// </div><div class="line">pexpireat k1 milliseconds-timestamp</div><div class="line">// OK 取消过期时间</div><div class="line">persist k1</div><div class="line">// OK 查看剩余多少秒过期</div><div class="line">ttl k1</div><div class="line">// OK 查看剩余多少毫秒过期</div><div class="line">pttl k1</div><div class="line">// OK</div><div class="line">keys *</div><div class="line">// </div><div class="line">migrate 127.0.0.1 6379 k1 | db10 2000</div><div class="line">// OK</div><div class="line">move k1 db 10</div><div class="line">// OK</div><div class="line">object encoding/freq/idletime/refcount</div><div class="line">// OK</div><div class="line">randomkey</div><div class="line">// OK</div><div class="line">rename k1 newkey</div><div class="line">// OK</div><div class="line">renamenx k1 newkey</div><div class="line">// </div><div class="line">restore </div><div class="line">// OK 迭代</div><div class="line">scan 0</div><div class="line">//</div><div class="line">sort</div><div class="line">// OK 更新访问时间</div><div class="line">touch</div><div class="line">// OK</div><div class="line"><span class="built_in">type</span> k1</div><div class="line">// OK 异步删除 k1 k2</div><div class="line">unlink k1 k2</div><div class="line">// </div><div class="line"><span class="built_in">wait</span></div></pre></td></tr></table></figure>
<h3 id="5-1-scan-命令理解"><a href="#5-1-scan-命令理解" class="headerlink" title="5.1 scan 命令理解"></a>5.1 scan 命令理解</h3><p>SCAN 命令及其相关的 SSCAN, HSCAN 和 ZSCAN 命令都用于增量迭代一个集合元素。</p>
<p>他们都支持增量式迭代，它们每次执行都只会返回少量元素，所以这些命令可以用于生产环境，而不会出现像 KEYS 或者 SMEMBERS 命令带来的<strong>可能会阻塞服务器</strong>的问题。相对的有一个缺点，就是 scan 在迭代过程中，集合元素可能会被修改，对返回的值无法提供完全的保证。</p>
<p>scan 是基于游标的迭代器。每次迭代需要上次迭代返回的游标。游标为 0 表示一个新的迭代；服务器返回 0 时表示迭代结束。</p>
<p>问题：</p>
<ul>
<li>同一个元素可能会被返回多次 </li>
<li>如果一个元素是在迭代过程中被添加到数据集的， 又或者是在迭代过程中从数据集中被删除的， 那么这个元素可能会被返回， 也可能不会。 </li>
<li>SCAN增量式迭代命令并不保证每次执行都返回某个给定数量的元素,甚至可能会返回零个元素， 但只要命令返回的游标不是 0 ， 应用程序就不应该将迭代视作结束。 </li>
</ul>
<h2 id="6-学习地址记录"><a href="#6-学习地址记录" class="headerlink" title="6. 学习地址记录"></a>6. 学习地址记录</h2><ul>
<li>redis 中文： <a href="http://redis.cn/" target="_blank" rel="external">http://redis.cn/</a> </li>
<li>redis 官网： <a href="https://redis.io/" target="_blank" rel="external">https://redis.io/</a> </li>
<li>数据库排名： <a href="https://db-engines.com/en/" target="_blank" rel="external">https://db-engines.com/en/</a></li>
<li>bitfield 理解：<a href="https://blog.csdn.net/qq_36535196/article/details/103819697" target="_blank" rel="external">https://blog.csdn.net/qq_36535196/article/details/103819697</a> </li>
<li>跳跃表理解：<ul>
<li><a href="https://blog.csdn.net/qpzkobe/article/details/80056807" target="_blank" rel="external">https://blog.csdn.net/qpzkobe/article/details/80056807</a> </li>
<li><a href="https://redisbook.readthedocs.io/en/latest/internal-datastruct/skiplist.html" target="_blank" rel="external">https://redisbook.readthedocs.io/en/latest/internal-datastruct/skiplist.html</a> </li>
<li><a href="https://www.jianshu.com/p/dc252b5efca6" target="_blank" rel="external">https://www.jianshu.com/p/dc252b5efca6</a> </li>
</ul>
</li>
</ul>
</div><div class="tags"><a href="/tags/Redis/">Redis</a></div><div class="post-nav"><a class="pre" href="/2020-02-19-202002/Redis 学习(二)-基本功能.html">Redis 学习(二)-管道、发布/订阅、事务、modules、过期</a><a class="next" href="/2020-01-18-疯狂Java讲义/疯狂Java讲义C18.html">第 18 章 类加载机制与反射</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Srping-Boot/">Srping Boot</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ZooKeeper/">ZooKeeper</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/加解密技术/">加解密技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/吉他/">吉他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/多线程/">多线程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列/">消息队列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/疯狂-Java-讲义/">疯狂 Java 讲义</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计划/">计划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/LVS/" style="font-size: 15px;">LVS</a> <a href="/tags/计划/" style="font-size: 15px;">计划</a> <a href="/tags/心情/" style="font-size: 15px;">心情</a> <a href="/tags/SFTP/" style="font-size: 15px;">SFTP</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/Samba/" style="font-size: 15px;">Samba</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/MQTT/" style="font-size: 15px;">MQTT</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/PGP/" style="font-size: 15px;">PGP</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/tags/Eureka/" style="font-size: 15px;">Eureka</a> <a href="/tags/Srping-Boot/" style="font-size: 15px;">Srping Boot</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/吉他/" style="font-size: 15px;">吉他</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/疯狂-Java-讲义/" style="font-size: 15px;">疯狂 Java 讲义</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/ZooKeeper/" style="font-size: 15px;">ZooKeeper</a> <a href="/tags/Observer/" style="font-size: 15px;">Observer</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Singleton/" style="font-size: 15px;">Singleton</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.jamespan.me/" title="小鶸の道场" target="_blank">小鶸の道场</a><ul></ul><a href="https://www.haomwei.com/" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://www.ruanyifeng.com/home.html" title="阮一峰" target="_blank">阮一峰</a><ul></ul><a href="https://www.cnblogs.com/jingmoxukong/" title="静默虚空" target="_blank">静默虚空</a><ul></ul><a href="https://blog.hushhw.cn/" title="hushhw" target="_blank">hushhw</a><ul></ul><a href="https://hasaik.com/" title="hasaik" target="_blank">hasaik</a><ul></ul><a href="https://www.imalan.cn/" title="三无计划" target="_blank">三无计划</a><ul></ul><a href="https://i-meto.com/" title="meto" target="_blank">meto</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">悟空.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>