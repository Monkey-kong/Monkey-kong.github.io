<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="悟空的技术博客"><title>第 9 章 泛型 | 悟空</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">第 9 章 泛型</h1><a id="logo" href="/.">悟空</a><p class="description">悟空的技术博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">第 9 章 泛型</h1><div class="post-meta">Jan 9, 2020<span> | </span><span class="category"><a href="/categories/疯狂-Java-讲义/">疯狂 Java 讲义</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-泛型入门"><span class="toc-text">9.1  泛型入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-1-编译时不检查类型的异常"><span class="toc-text">9.1.1 编译时不检查类型的异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-2-使用泛型"><span class="toc-text">9.1.2 使用泛型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-3-Java-9-增强的菱形语法"><span class="toc-text">9.1.3 Java 9 增强的菱形语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-深入泛型"><span class="toc-text">9.2 深入泛型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-1-定义泛型接口、类"><span class="toc-text">9.2.1 定义泛型接口、类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-2-从泛型派生子类"><span class="toc-text">9.2.2 从泛型派生子类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-3-并不存在泛型类"><span class="toc-text">9.2.3 并不存在泛型类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-类型统配符"><span class="toc-text">9.3 类型统配符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-1-使用类型统配符"><span class="toc-text">9.3.1 使用类型统配符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-2-设定类型通配符的上限"><span class="toc-text">9.3.2 设定类型通配符的上限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-3-设定类型通配符的下限"><span class="toc-text">9.3.3 设定类型通配符的下限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-4-设定泛型形参的上限"><span class="toc-text">9.3.4 设定泛型形参的上限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-泛型方法"><span class="toc-text">9.4 泛型方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-1-定义泛型方法"><span class="toc-text">9.4.1 定义泛型方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-2-泛型方法和类型通配符的区别"><span class="toc-text">9.4.2 泛型方法和类型通配符的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-3-Java-7-的菱形语法与泛型构造器"><span class="toc-text">9.4.3 Java 7 的菱形语法与泛型构造器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-4-泛型方法与方法重载"><span class="toc-text">9.4.4 泛型方法与方法重载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-5-Java-8-改进的类型推断"><span class="toc-text">9.4.5 Java 8 改进的类型推断</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-擦除和转换"><span class="toc-text">9.5 擦除和转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-泛型与数组"><span class="toc-text">9.6 泛型与数组</span></a></li></ol></div></div><div class="post-content"><p>第 9 章 泛型</p>
<a id="more"></a>
<h2 id="9-1-泛型入门"><a href="#9-1-泛型入门" class="headerlink" title="9.1  泛型入门"></a>9.1  泛型入门</h2><h3 id="9-1-1-编译时不检查类型的异常"><a href="#9-1-1-编译时不检查类型的异常" class="headerlink" title="9.1.1 编译时不检查类型的异常"></a>9.1.1 编译时不检查类型的异常</h3><p>不使用泛型，容易引发类型转换异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListErr</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="comment">// 创建一个只想保存字符串的 List</span></div><div class="line">        List strList = <span class="keyword">new</span> ArrayList();</div><div class="line">        strList.add(<span class="string">"111"</span>);</div><div class="line">        strList.add(<span class="string">"222"</span>);</div><div class="line">        <span class="comment">// 不小心把一个 Integer 对象丢进了集合</span></div><div class="line">        strList.add(<span class="number">333</span>);</div><div class="line">        <span class="comment">// 引发 ClassCastException</span></div><div class="line">        strList.forEach(str -&gt; System.out.println(((String)str).length()));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="9-1-2-使用泛型"><a href="#9-1-2-使用泛型" class="headerlink" title="9.1.2 使用泛型"></a>9.1.2 使用泛型</h3><p>使用泛型后，如果不符合类型要求直接编译报错。</p>
<p><code>List&lt;String&gt; strList = new ArrayList&lt;String&gt;();</code></p>
<h3 id="9-1-3-Java-9-增强的菱形语法"><a href="#9-1-3-Java-9-增强的菱形语法" class="headerlink" title="9.1.3 Java 9 增强的菱形语法"></a>9.1.3 Java 9 增强的菱形语法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Foo</span>&lt;<span class="title">T</span>&gt;</span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(T t)</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnoymousTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="comment">// Java 7 开始，后面可以省略等号右边尖括号内容</span></div><div class="line">        List&lt;String&gt; strList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        Map&lt;String, List&lt;String&gt;&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"></div><div class="line">        <span class="comment">// Java 9 开始，创建匿名内部类时使用菱形语法</span></div><div class="line">        <span class="comment">// 指定 Foo 类中泛型为 String</span></div><div class="line">        Foo&lt;String&gt; f = <span class="keyword">new</span> Foo&lt;&gt;()&#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(String s)</span> </span>&#123;</div><div class="line">                System.out.println(<span class="string">"test 方法的 s 参数为："</span> + s);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">// 使用泛型通配符，此时相当于通配符的上限为 Object</span></div><div class="line">        Foo&lt;?&gt; fo = <span class="keyword">new</span> Foo&lt;&gt;()&#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">                System.out.println(<span class="string">"test 方法的 o 参数为："</span> + o);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">// 使用泛型通配符，通配符的上限为 Number。</span></div><div class="line">        <span class="comment">// ? 为 Number 的子类，所以是上限</span></div><div class="line">        Foo&lt;? extends Number&gt; fn = <span class="keyword">new</span> Foo&lt;&gt;()&#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Number number)</span> </span>&#123;</div><div class="line">                System.out.println(<span class="string">"test 方法的 Number 参数为："</span> + number);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="9-2-深入泛型"><a href="#9-2-深入泛型" class="headerlink" title="9.2 深入泛型"></a>9.2 深入泛型</h2><p>所谓泛型，就是允许在定义类、接口、方法时使用<strong>类型形参</strong>，这个类型形参（或叫泛型）将在<strong>声明变量、创建对象、调用方法</strong>时动态地指定（即传入实际的类型参数，也可称为类型实参）。</p>
<p>Java 5 改写了集合框架中的全部接口和类，为这些接口、类增加了泛型支持，从而可以在声明集合变量、创建集合对象时传入类型实参，这就是在前面程序中看到的 List<string> 和 ArrayList<string> 两种类型。</string></string></p>
<h3 id="9-2-1-定义泛型接口、类"><a href="#9-2-1-定义泛型接口、类" class="headerlink" title="9.2.1 定义泛型接口、类"></a>9.2.1 定义泛型接口、类</h3><p>类型形参、类型实参。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义接口时指定一个泛型形参，该形参名为 E</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;</span>&#123;</div><div class="line">    <span class="comment">// 在该接口里，E 可作为类型使用</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(E x)</span></span>;</div><div class="line">    <span class="function">Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 定义该接口时，指定了两个泛型形参，其形参名为 K、V</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Map</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span>&#123;</div><div class="line">    <span class="function">Set&lt;K&gt; <span class="title">keySet</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">V <span class="title">put</span><span class="params">(K key, V value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以为任何类、接口增加泛型声明，并不是只有集合才可以使用泛型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义 Apple 类时使用了泛型声明</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">// 使用 T 类型定义实例bianl</span></div><div class="line">    <span class="keyword">private</span> T info;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">    <span class="comment">// 使用 T 类型类定义构造器</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">(T info)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.info = info;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> info;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInfo</span><span class="params">(T info)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.info = info;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="comment">// 由于传给 T 形参的是 String，所以构造器参数只能是 String</span></div><div class="line">        Apple&lt;String&gt; a1 = <span class="keyword">new</span> Apple&lt;&gt;(<span class="string">"苹果"</span>);</div><div class="line">        System.out.println(a1.getInfo());</div><div class="line">        <span class="comment">// 只能是 Double 或 double</span></div><div class="line">        Apple&lt;Double&gt; a2 = <span class="keyword">new</span> Apple&lt;&gt;(<span class="number">5.67</span>);</div><div class="line">        System.out.println(a2.getInfo());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="9-2-2-从泛型派生子类"><a href="#9-2-2-从泛型派生子类" class="headerlink" title="9.2.2 从泛型派生子类"></a>9.2.2 从泛型派生子类</h3><p>使用父类或者接口时，不能再包含形参，必须给定实参或者默认 Object 类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A1</span> <span class="keyword">extends</span> <span class="title">Apple</span>&lt;<span class="title">String</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">// 正确重写了父类的方法，返回值</span></div><div class="line">    <span class="comment">// 与父类Apple&lt;String&gt;的返回值完全相同</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"子类"</span> + <span class="keyword">super</span>.getInfo();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 编译报错，重写父类方法时，返回值不一致</span></div><div class="line"><span class="comment">//    @Override</span></div><div class="line"><span class="comment">//    public Object getInfo() &#123;</span></div><div class="line"><span class="comment">//        return "子类";</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A2</span> <span class="keyword">extends</span> <span class="title">Apple</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// super.getIno() 方法返回值是 Object 类型</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getInfo().toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="9-2-3-并不存在泛型类"><a href="#9-2-3-并不存在泛型类" class="headerlink" title="9.2.3 并不存在泛型类"></a>9.2.3 并不存在泛型类</h3><p>前面提到可以把 ArrayList&lt; String&gt; 类当成 ArrayList 的子类， 事实上， ArrayList<string> 类也确实像一种特殊的 ArrayLi st 类但实际上， 系统并没有为ArrayList<s tring=""> 生成新的 cl ass 文件，而且也不会把 ArrayLi st&lt; String&gt; 当成新类来处理。</s></string></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NoClassExits</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List&lt;String&gt; l1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        List&lt;Integer&gt; l2 = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="comment">// 并不存在泛型类，都是List 类型。true</span></div><div class="line">        System.out.println(l1.getClass() == l2.getClass());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不管为泛型形参传入哪一种类型实参， 对于 Java 来说， 它们依然被当成同一个类处理，在内存中也只占用一块内存空间，因此在<strong>静态方法、静态初始化块或者静态变量的声明和初始化</strong>中不允许使用泛型形参。</p>
<p>如何理解？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticTest</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">// 下面代码错误，不能在静态变量声明中使用泛型形参</span></div><div class="line">    <span class="comment">// static T info;</span></div><div class="line">    T age;</div><div class="line">    <span class="comment">// 下面代码错误，不能再静态方法声明中使用泛型形参</span></div><div class="line">    <span class="comment">// public static void bar(T msg)&#123;&#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="9-3-类型统配符"><a href="#9-3-类型统配符" class="headerlink" title="9.3 类型统配符"></a>9.3 类型统配符</h2><p>当使用一个泛型类时（声明变量、创建对象），都应该为这个泛型类传入一个类型实参，否则编译器会提示泛型警告。假设现在要定义一个方法，该方法的一个集合形参的类型不确定，应该如何定义呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(List&lt;Object&gt; c)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;c.size(); i++)&#123;</div><div class="line">        System.out.println(c.get(i));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">List&lt;String&gt; strList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"><span class="comment">// 直接编译报错，可以看出：List&lt;String&gt; 对象不能被当成 List&lt;Object&gt; 子类</span></div><div class="line">test(strList);</div><div class="line"></div><div class="line">Integer[] ia = neww Integer[<span class="number">5</span>];</div><div class="line"><span class="comment">// 编译正常</span></div><div class="line">Number[] na = ia;</div><div class="line"><span class="comment">// 报错，因为 0.5 不是 Integer</span></div><div class="line">na[<span class="number">0</span>] = <span class="number">0.5</span>;</div></pre></td></tr></table></figure>
<p>泛型的设计原则是，只要代码在编译时没有出现警告，就不会遇到运行时 ClassCastException 异常。所以数组之后出现的泛型，不允许上面数组那样直接赋值。</p>
<h3 id="9-3-1-使用类型统配符"><a href="#9-3-1-使用类型统配符" class="headerlink" title="9.3.1 使用类型统配符"></a>9.3.1 使用类型统配符</h3><p>List&lt;?&gt; ：意思是元素类型未知的 List，这个问号就是通配符。</p>
<p>所以上面方法可以改写为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(List&lt;?&gt; c)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;c.size(); i++)&#123;</div><div class="line">        System.out.println(c.get(i));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意：这种带通配符的 List 仅表示他是各种泛型 List 的父类，并不能把元素加入到其中。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">List&lt;?&gt; c = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line"><span class="comment">// 编译报错，因为程序无法确定 c 中元素类型，所以不能添加元素</span></div><div class="line">c.add(<span class="keyword">new</span> Object());</div></pre></td></tr></table></figure>
<h3 id="9-3-2-设定类型通配符的上限"><a href="#9-3-2-设定类型通配符的上限" class="headerlink" title="9.3.2 设定类型通配符的上限"></a>9.3.2 设定类型通配符的上限</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义一个抽象类 Shape</span></div><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas c)</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas c)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"在画布"</span> + c + <span class="string">"上画了一个圆"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas c)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"在画布"</span> + c + <span class="string">"上画了一个矩形"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Canvas</span> </span>&#123;</div><div class="line">    <span class="comment">// 同时画多个形状</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawAll</span><span class="params">(List&lt;? extends Shape&gt; shapes)</span></span>&#123;</div><div class="line">        <span class="keyword">for</span>(Shape s : shapes)&#123;</div><div class="line">            s.draw(<span class="keyword">this</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 同样，使用泛型上限后，无法添加元素</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addRectangle</span><span class="params">(List&lt;? extends Shape&gt; shapes)</span></span>&#123;</div><div class="line">        <span class="comment">// 编译报错</span></div><div class="line">        <span class="comment">// shapes.add(0, new Rectangle());</span></div><div class="line">        <span class="comment">// 正常</span></div><div class="line">        shapes.add(<span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List&lt;Circle&gt; circleList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        circleList.add(<span class="keyword">new</span> Circle());</div><div class="line">        Canvas c = <span class="keyword">new</span> Canvas();</div><div class="line">        <span class="comment">// 如果不用泛型上线，编译报错。改写后正常</span></div><div class="line">         c.drawAll(circleList);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意：没法添加元素。只出不进。</p>
<h3 id="9-3-3-设定类型通配符的下限"><a href="#9-3-3-设定类型通配符的下限" class="headerlink" title="9.3.3 设定类型通配符的下限"></a>9.3.3 设定类型通配符的下限</h3><p>可以添加元素。但是取出的元素全部被当成 Object 处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUtils</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">copy</span><span class="params">(Collection&lt;? <span class="keyword">super</span> T&gt; dest, Collection&lt;T&gt; src)</span></span>&#123;</div><div class="line">        T last = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">for</span>(T ele : src)&#123;</div><div class="line">            last = ele;</div><div class="line">            <span class="comment">// 逆变的泛型集合添加元素是安全的</span></div><div class="line">            dest.add(ele);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> last;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List&lt;Number&gt; ln = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        List&lt;Integer&gt; li = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        li.add(<span class="number">5</span>);</div><div class="line">        Integer last = copy(ln, li);</div><div class="line">        System.out.println(ln);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="9-3-4-设定泛型形参的上限"><a href="#9-3-4-设定泛型形参的上限" class="headerlink" title="9.3.4 设定泛型形参的上限"></a>9.3.4 设定泛型形参的上限</h3><p>定义泛型形参时也可以设置上限。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Number</span>&gt; </span>&#123;</div><div class="line">    T col;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</div><div class="line">        Apple&lt;Integer&gt; ai = <span class="keyword">new</span> Apple&lt;&gt;();</div><div class="line">        Apple&lt;Double&gt; ad = <span class="keyword">new</span> Apple&lt;&gt;();</div><div class="line">        <span class="comment">// 编译报错，String 不是 Number 的子类</span></div><div class="line">        <span class="comment">//Apple&lt;String&gt; as = new Apple&lt;&gt;();</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以设置多个上限：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Apple</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Number</span> &amp; <span class="title">Serializable</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="9-4-泛型方法"><a href="#9-4-泛型方法" class="headerlink" title="9.4 泛型方法"></a>9.4 泛型方法</h2><p>定义类、接口时没有使用泛型形参，但定义方法时想自己定义泛型形参这也是可以的。</p>
<h3 id="9-4-1-定义泛型方法"><a href="#9-4-1-定义泛型方法" class="headerlink" title="9.4.1 定义泛型方法"></a>9.4.1 定义泛型方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericMethodTest</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">fromArrayToCollection</span><span class="params">(T[] a, Collection&lt;T&gt; c)</span></span>&#123;</div><div class="line">        <span class="keyword">for</span>(T o : a)&#123;</div><div class="line">            c.add(o);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(Collection&lt;T&gt; from, Collection&lt;T&gt; to)</span></span>&#123;</div><div class="line">        <span class="keyword">for</span> (T ele : from)&#123;</div><div class="line">            to.add(ele);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">test1</span><span class="params">(Collection&lt;? extends T&gt; from, Collection&lt;T&gt; to)</span></span>&#123;</div><div class="line">        <span class="keyword">for</span> (T ele : from)&#123;</div><div class="line">            to.add(ele);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Object[] oa = <span class="keyword">new</span> Object[<span class="number">100</span>];</div><div class="line">        Collection&lt;Object&gt; co = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="comment">// T:Object</span></div><div class="line">        fromArrayToCollection(oa, co);</div><div class="line"></div><div class="line">        String[] sa = <span class="keyword">new</span> String[<span class="number">100</span>];</div><div class="line">        Collection&lt;String&gt; cs = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="comment">// T:String</span></div><div class="line">        fromArrayToCollection(sa, cs);</div><div class="line">        <span class="comment">// T:Object？？</span></div><div class="line">        fromArrayToCollection(sa, co);</div><div class="line"></div><div class="line">        List&lt;Object&gt; ao = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        List&lt;String&gt; as = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="comment">// 编译报错？</span></div><div class="line">        <span class="comment">// test(as, ao);</span></div><div class="line">        <span class="comment">// 正常</span></div><div class="line">        test1(as, ao);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="9-4-2-泛型方法和类型通配符的区别"><a href="#9-4-2-泛型方法和类型通配符的区别" class="headerlink" title="9.4.2 泛型方法和类型通配符的区别"></a>9.4.2 泛型方法和类型通配符的区别</h3><p>类型通配符既可以在方法签名中定义形参的类型，也可以用于定义变量的类型；但泛型方法中的泛型形参必须在对应方法中显式声明。</p>
<p>如果某个方法中一个形参( a) 的类型或返回值的类型依赖于另一个形参( b )的类型，则形参( b )的类型声明不应该使用通配符一因为形参( a) 或返回值的类型依赖于该形参( b )的类型，如果形参( b ) 的类型无法确定，程序就无法定义形参( a) 的类型。在这种情况下，只能考虑使用在方法签名中声明泛型一一也就是泛型方法。</p>
<h3 id="9-4-3-Java-7-的菱形语法与泛型构造器"><a href="#9-4-3-Java-7-的菱形语法与泛型构造器" class="headerlink" title="9.4.3 Java 7 的菱形语法与泛型构造器"></a>9.4.3 Java 7 的菱形语法与泛型构造器</h3><p>许在构造器签名中声明泛型形参。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span>&#123;</div><div class="line">    <span class="keyword">public</span> &lt;T&gt; Foo(T t)&#123;</div><div class="line">        System.out.println(t);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericConstructor</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> Foo(<span class="string">"aaa"</span>);</div><div class="line">        <span class="keyword">new</span> Foo(<span class="number">200</span>);</div><div class="line">        <span class="keyword">new</span> &lt;String&gt; Foo(<span class="string">"bbbb"</span>);</div><div class="line">        <span class="comment">// 报错</span></div><div class="line">        <span class="comment">// new &lt;String&gt; Foo(12.3);</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果程序显式指定了泛型构造器中声明的泛型形参的实际类型，则不可以使用”菱形”语法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>&lt;<span class="title">E</span>&gt;</span>&#123;</div><div class="line">    <span class="keyword">public</span> &lt;T&gt; MyClass(T t)&#123;</div><div class="line">        System.out.println(<span class="string">"t参数的值为："</span> + t);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericDiarnondTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="comment">// E:String T:Integer</span></div><div class="line">        MyClass&lt;String&gt; mc1 = <span class="keyword">new</span> MyClass&lt;&gt;(<span class="number">5</span>);</div><div class="line">        <span class="comment">// 显示指定 E T</span></div><div class="line">        MyClass&lt;String&gt; mc2 = <span class="keyword">new</span> &lt;Integer&gt;MyClass&lt;String&gt;(<span class="number">5</span>);</div><div class="line">        <span class="comment">// 如果显示指定泛型构造器形参，此时不可使用形参，编译报错。</span></div><div class="line">        <span class="comment">// MyClass&lt;String&gt; mc3 = new &lt;Integer&gt;MyClass&lt;&gt;(5);</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为何？</p>
<h3 id="9-4-4-泛型方法与方法重载"><a href="#9-4-4-泛型方法与方法重载" class="headerlink" title="9.4.4 泛型方法与方法重载"></a>9.4.4 泛型方法与方法重载</h3><p>有可能导致定义时正常，但是调用时报错。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">copy</span><span class="params">(Collection&lt;? <span class="keyword">super</span> T&gt; dest, Collection&lt;T&gt; src)</span></span>&#123;</div><div class="line">    T last = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">for</span>(T ele : src)&#123;</div><div class="line">        last = ele;</div><div class="line">        <span class="comment">// 逆变的泛型集合添加元素是安全的</span></div><div class="line">        dest.add(ele);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> last;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">copy</span><span class="params">(Collection&lt;T&gt; dest, Collection&lt;? extends T&gt; src)</span></span>&#123;</div><div class="line">    T last = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">for</span>(T ele : src)&#123;</div><div class="line">        last = ele;</div><div class="line">        <span class="comment">// 逆变的泛型集合添加元素是安全的</span></div><div class="line">        dest.add(ele);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> last;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="9-4-5-Java-8-改进的类型推断"><a href="#9-4-5-Java-8-改进的类型推断" class="headerlink" title="9.4.5 Java 8 改进的类型推断"></a>9.4.5 Java 8 改进的类型推断</h3><p>类型推断方法：</p>
<ul>
<li>通过调用方法的上下文来推断泛型的目标类型</li>
<li>在方法调用链中，将推断得到的泛型传递到最后一个方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUtil</span>&lt;<span class="title">E</span>&gt;</span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;Z&gt; <span class="function">MyUtil&lt;Z&gt; <span class="title">nil</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;Z&gt; <span class="function">MyUtil&lt;Z&gt; <span class="title">cons</span><span class="params">(Z head, MyUtil&lt;Z&gt; tail)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function">E <span class="title">head</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InferenceTes</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        MyUtil&lt;String&gt; ls = MyUtil.nil();</div><div class="line">        MyUtil&lt;String&gt; mu = MyUtil.&lt;String&gt;nil();</div><div class="line">        MyUtil.cons(<span class="number">42</span>, MyUtil.nil());</div><div class="line">        MyUtil.cons(<span class="number">42</span>, MyUtil.&lt;Integer&gt;nil());</div><div class="line">        </div><div class="line">        <span class="comment">// 报错，推断不是万能的</span></div><div class="line">        <span class="comment">// String s = MyUtil.nil().head();</span></div><div class="line">        String s = MyUtil.&lt;String&gt;nil().head();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="9-5-擦除和转换"><a href="#9-5-擦除和转换" class="headerlink" title="9.5 擦除和转换"></a>9.5 擦除和转换</h2><p>当把一个具有泛型信息的对象赋给另一个没有泛型信息的变量时，所有在尖括号之间的类型信息都将被扔掉。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Number</span>&gt;</span>&#123;</div><div class="line">    T size;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">()</span></span>&#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Apple</span><span class="params">(T size)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.size = size;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSize</span><span class="params">(T size)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.size = size;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getSize</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.size;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErasureTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Apple&lt;Integer&gt; a = <span class="keyword">new</span> Apple&lt;&gt;(<span class="number">6</span>);</div><div class="line">        Integer as = a.getSize();</div><div class="line"></div><div class="line">        <span class="comment">// 丢失尖括号信息</span></div><div class="line">        Apple b = a;</div><div class="line">        Number size1 = b.getSize();</div><div class="line">        <span class="comment">// 编译报错</span></div><div class="line">        <span class="comment">// Integer size2 = b.getSize();</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从逻辑上来看， List&lt; String&gt;是List 的子类，如果直接把一个List 对象赋给一个List<string>对象应该引起编译错误，但实际上不会。</string></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErasureTest2</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List&lt;Integer&gt; li = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        li.add(<span class="number">6</span>);</div><div class="line">        li.add(<span class="number">9</span>);</div><div class="line">        List list = li;</div><div class="line">        <span class="comment">// 只是警告，运行时完全正常</span></div><div class="line">        List&lt;String&gt; ls = list;</div><div class="line">        <span class="comment">// 但是访问元素时会引发运行时异常。</span></div><div class="line">        System.out.println(ls.get(<span class="number">0</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="9-6-泛型与数组"><a href="#9-6-泛型与数组" class="headerlink" title="9.6 泛型与数组"></a>9.6 泛型与数组</h2><p>数组元素的类型不能包含泛型变量或泛型形参，除非是无上限的类型通配符。</p>
<p>但可以声明元素类型包含泛型变量或泛型形参的数组。</p>
<p>也就是说， 只能声明List<string>[]形式的数组， 但不能创建ArrayList<string>[1 0]这样的数组对象。</string></string></p>
<p>假设可以创建这样的数组：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 实际上会编译报错</span></div><div class="line">List&lt;String&gt;[] lsa = <span class="keyword">new</span> ArrayList&lt;String&gt;[<span class="number">10</span>];</div><div class="line"><span class="comment">// 这样是允许的，但是会有警告</span></div><div class="line">List&lt;String&gt;[] lsa = <span class="keyword">new</span> ArrayList[<span class="number">10</span>];</div><div class="line"><span class="comment">// 向上转型</span></div><div class="line">Object[] oa = lsa;</div><div class="line">List&lt;Integer&gt; li = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">li.add(<span class="number">3</span>);</div><div class="line">oa[<span class="number">1</span>] = li;</div><div class="line"><span class="comment">// 没有任何警告，但是将引发异常</span></div><div class="line">String s = lsa[<span class="number">1</span>].get(<span class="number">0</span>);</div></pre></td></tr></table></figure>
<p>Java 允许创建无上限的通配符泛型数组，例如new AηayList&lt;?&gt;[ 1 0] ， 因此也可以将第一段代码改为使用无上限的通配符泛型数组，在这种情况下，程序不得不进行强制类型转换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericAndArray2</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List&lt;?&gt;[] lsa = <span class="keyword">new</span> ArrayList&lt;?&gt;[<span class="number">10</span>];</div><div class="line">        Object[] oa = lsa;</div><div class="line">        List&lt;Integer&gt; li = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        li.add(<span class="number">3</span>);</div><div class="line">        oa[<span class="number">1</span>] = li;</div><div class="line">        Object target = lsa[<span class="number">1</span>].get(<span class="number">0</span>);</div><div class="line">        <span class="keyword">if</span>((target <span class="keyword">instanceof</span> String))&#123;</div><div class="line">            <span class="comment">// 下面代码安全了</span></div><div class="line">            String s = (String) target;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line"><span class="comment">//    &lt;T&gt; T[] makeArray(Collection&lt;T&gt; coll)&#123;</span></div><div class="line"><span class="comment">//        // 编译报错</span></div><div class="line"><span class="comment">//        return new T[coll.size()];</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/疯狂-Java-讲义/">疯狂 Java 讲义</a></div><div class="post-nav"><a class="pre" href="/2020-01-10-疯狂Java讲义/疯狂Java讲义C10.html">第 10 章 异常处理</a><a class="next" href="/2020-01-08-疯狂Java讲义/疯狂Java讲义C8.html">第 8 章 Java 集合</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Srping-Boot/">Srping Boot</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ZooKeeper/">ZooKeeper</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/加解密技术/">加解密技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/吉他/">吉他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/多线程/">多线程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列/">消息队列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/疯狂-Java-讲义/">疯狂 Java 讲义</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计划/">计划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/LVS/" style="font-size: 15px;">LVS</a> <a href="/tags/计划/" style="font-size: 15px;">计划</a> <a href="/tags/心情/" style="font-size: 15px;">心情</a> <a href="/tags/SFTP/" style="font-size: 15px;">SFTP</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/Samba/" style="font-size: 15px;">Samba</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/MQTT/" style="font-size: 15px;">MQTT</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/PGP/" style="font-size: 15px;">PGP</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/tags/Eureka/" style="font-size: 15px;">Eureka</a> <a href="/tags/Srping-Boot/" style="font-size: 15px;">Srping Boot</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/吉他/" style="font-size: 15px;">吉他</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/疯狂-Java-讲义/" style="font-size: 15px;">疯狂 Java 讲义</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/ZooKeeper/" style="font-size: 15px;">ZooKeeper</a> <a href="/tags/Observer/" style="font-size: 15px;">Observer</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Singleton/" style="font-size: 15px;">Singleton</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.jamespan.me/" title="小鶸の道场" target="_blank">小鶸の道场</a><ul></ul><a href="https://www.haomwei.com/" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://www.ruanyifeng.com/home.html" title="阮一峰" target="_blank">阮一峰</a><ul></ul><a href="https://www.cnblogs.com/jingmoxukong/" title="静默虚空" target="_blank">静默虚空</a><ul></ul><a href="https://blog.hushhw.cn/" title="hushhw" target="_blank">hushhw</a><ul></ul><a href="https://hasaik.com/" title="hasaik" target="_blank">hasaik</a><ul></ul><a href="https://www.imalan.cn/" title="三无计划" target="_blank">三无计划</a><ul></ul><a href="https://i-meto.com/" title="meto" target="_blank">meto</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">悟空.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>