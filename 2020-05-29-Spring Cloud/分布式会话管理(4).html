<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="悟空的技术博客"><title> | 悟空</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">悟空</h1><a id="logo" href="/.">悟空</a><p class="description">悟空的技术博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-meta">May 29, 2020</div><div class="post-content"><p>title:  会话管理(一)<br>tags:</p>
<ul>
<li>SpringCloud<br>comments: true<br>toc: true<br>categories: SpringCloud<br>date: 2020-04-7 22:13:12</li>
</ul>
<p>Token/接口安全性问题、XSS 攻击、Oauth2</p>
<h2 id="1-Token-安全性问题"><a href="#1-Token-安全性问题" class="headerlink" title="1. Token 安全性问题"></a>1. Token 安全性问题</h2><h3 id="1-1-问题"><a href="#1-1-问题" class="headerlink" title="1.1 问题"></a>1.1 问题</h3><ul>
<li>XSS 重放攻击<ul>
<li>非法 js 读取 header 中的 token，这就可以发送非法请求了</li>
<li>用户提交表单（比如发帖子），填入了非法 js，被存入 DB。</li>
<li>非法 js 被其他用户加载到页面，就执行了非法的 js 请求了，这就是 XSS 攻击。</li>
<li>hash(url+timestamp+token+盐)=hmac ，服务端重新验证，匹配上则认为是安全的请求。但是这个盐非法 js 也可以读到，不能防止 XSS 攻击。hmac 只能防止数据被篡改。有了 https 为什么还要用 hmac？nginx 和 公网之间使用 https 保证数据不会在公网被篡改。<strong>微服务内部都是 http 协议通信，所以用 hmac 防止内网泄漏。在业务端检查数据是否被篡改。</strong></li>
</ul>
</li>
<li>SCRF 跨域攻击</li>
</ul>
<h3 id="1-2-Token-携带方式"><a href="#1-2-Token-携带方式" class="headerlink" title="1.2 Token 携带方式"></a>1.2 Token 携带方式</h3><p><strong>浏览器</strong></p>
<ul>
<li>http header<ul>
<li>js 是否可以读取当前浏览器 header 中的东西？可以</li>
</ul>
</li>
<li>url 上的 Get 请求<ul>
<li>js 可以读到</li>
</ul>
</li>
<li>Cookies<ul>
<li>js 可以读到</li>
</ul>
</li>
<li>localstorage<ul>
<li>js 可以读到</li>
</ul>
</li>
</ul>
<p><strong>APP</strong></p>
<p>server 下发 app，通过 https</p>
<p>app 没有 xss 攻击。app 装在每个手机，抓包只能抓到自己的数据，抓不到别人数据。</p>
<p>除非 webview 可能存在重放攻击。可以通过本地代理，过滤无效请求。</p>
<h3 id="1-3-如何防止-XSS-重放攻击"><a href="#1-3-如何防止-XSS-重放攻击" class="headerlink" title="1.3 如何防止 XSS 重放攻击"></a>1.3 如何防止 XSS 重放攻击</h3><p><strong>没用的解决办法：</strong></p>
<ul>
<li><p>token 只能用一次。token 用完之后，放入缓存，相当于加入了黑名单。不能防止 XSS 攻击，非法 js 还是可以拿到新的 token。</p>
</li>
<li><p>设法先执行非法 js，再加载 token？不行，非法 js 可以死循环一直跑。</p>
</li>
<li><p>hmac，即给数据签名。不行，由于盐是在客户端，正常 js 可以读取到，非法 js 也可以读取到，也就可以发送同样的请求。</p>
</li>
<li><p>token 有效期设置短一点，有一点点效果。</p>
</li>
</ul>
<p>所以怎么做都没法防止非法 js 获取 token，也就无法防止非法 js 执行 XSS 攻击。</p>
<p><strong>有用的解决办法：</strong></p>
<ul>
<li>加入人机交互：图形验证码，旧密码，删除（confirm 1+1=?）</li>
<li>防止非法 js 进入系统：表单提交（发帖子）非法字符<strong>转义</strong>处理（URLEncode）</li>
<li>服务端定期扫描：定期扫描服务器端静态资源、数据库字段。比如扫描所有<code>&lt;script src</code></li>
<li>记录日志：出现问题时，能够快速追溯到原因</li>
</ul>
<p>综合：web 端防不住</p>
<h3 id="1-4-token-丢了咋办？"><a href="#1-4-token-丢了咋办？" class="headerlink" title="1.4 token 丢了咋办？"></a>1.4 token 丢了咋办？</h3><ul>
<li><p>转移责任：短音验证码、ip 改变时发出安全提示</p>
</li>
<li><p>人机交互：滑动</p>
</li>
<li><p>代码混淆：加盐、无法反编译，乱码</p>
</li>
</ul>
<p>物理隔离：</p>
<p>放内部人员。需要通过制度约束。</p>
<h2 id="2-oauth2-0"><a href="#2-oauth2-0" class="headerlink" title="2. oauth2.0"></a>2. oauth2.0</h2><p>和 JWT 一样，是一套标准，不是一个具体的框架。<strong>OAuth 的核心就是向第三方应用颁发令牌</strong>。</p>
<h3 id="2-1-访问流程"><a href="#2-1-访问流程" class="headerlink" title="2.1 访问流程"></a>2.1 访问流程</h3><ol>
<li>用户访问资源服务器，发现用户没有权限，跳转登录页</li>
<li>用户访问认证服务器进行登录认证，得到权限</li>
<li>认证服务器带着该用户的权限通过重定向地址再次访问资源服务器</li>
<li>资源服务器发送 authentication code、client id、client secret 到认证服务器获取 access token</li>
<li>用户登录</li>
</ol>
<p>中间 authentication 有何作用，为啥要用访问两次认证服务器才拿到 token，第一次直接拿 token 不行吗？</p>
<h3 id="2-2-角色"><a href="#2-2-角色" class="headerlink" title="2.2 角色"></a>2.2 角色</h3><h4 id="Resource-Owner"><a href="#Resource-Owner" class="headerlink" title="Resource Owner"></a>Resource Owner</h4><p>资源拥有者。对应微信的每个用户微信上设置的个人信息是属于每个用户的，不属于腾讯。</p>
<h4 id="Resource-Server"><a href="#Resource-Server" class="headerlink" title="Resource Server"></a>Resource Server</h4><p>资源服务器，一般就是用户数据的一些操作（增删改查）的 REST API，比如微信的获取用户基本信息的接口。</p>
<h4 id="Client-Application"><a href="#Client-Application" class="headerlink" title="Client Application"></a>Client Application</h4><p>第三方客户端，对比微信中就是各种微信公众号开发的应用，第三方应用经过<code>认证服务器</code>授权后即可访问<code>资源服务器</code>的 REST API 来获取用户的头像、性别、地区等基本信息。</p>
<h4 id="Authorization-Server"><a href="#Authorization-Server" class="headerlink" title="Authorization Server"></a>Authorization Server</h4><p>认证服务器，验证第三方客户端是否合法。如果合法就给客户端颁布 token，第三方通过 token 来调用资源服务器的 API。</p>
<h3 id="2-3-授权类型"><a href="#2-3-授权类型" class="headerlink" title="2.3 授权类型"></a>2.3 授权类型</h3><h4 id="anthorization-code"><a href="#anthorization-code" class="headerlink" title="anthorization_code"></a>anthorization_code</h4><p>授权码类型，适用于 Web Server Application。</p>
<p>模式为：</p>
<ul>
<li>客户端先调用<code>/oauth/authorize/</code>进到用户授权界面，用户授权后返回 code</li>
<li>客户端然后根据 code 和 secret 获取 access token</li>
</ul>
<h4 id="implicit"><a href="#implicit" class="headerlink" title="implicit"></a>implicit</h4><p>简化类型，相对于授权码类型少了授权码获取的步骤。客户端应用授权后认证服务器会直接将access token放在客户端的 url。客户端解析 url 获取 token。这种方式其实是不太安全的，可以通过 <strong>https 安全通道</strong>和<strong>缩短 access token 的有效时间</strong>来较少风险。</p>
<h4 id="password"><a href="#password" class="headerlink" title="password"></a>password</h4><p>密码类型，客户端应用通过用户的 username 和 password 获 access token。适用于资源服务器、认证服务器与客户端具有完全的信任关系，因为要将用户要将用户的用户名密码直接发送给客户端应用，客户端应用通过用户发送过来的用户名密码获取 token，然后访问资源服务器资源。比如支付宝就可以直接用淘宝用户名和密码登录，因为它们属于同一家公司，彼此<strong>充分信任</strong>。</p>
<h4 id="client-credentials"><a href="#client-credentials" class="headerlink" title="client_credentials"></a>client_credentials</h4><p>客户端类型，是不需要用户参与的一种方式，用于不同服务之间的对接。比如自己开发的应用程序要调用短信验证码服务商的服务，调用地图服务商的服务、调用手机消息推送服务商的服务。当需要调用服务时可以直接使用服务商给的<code>appID</code>和<code>appSecret</code>来获取token，得到token之后就可以直接调用服务。</p>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><ul>
<li><strong>scope</strong>：访问资源服务器的哪些作用域。一组权限，Role</li>
<li><strong>refresh token</strong>：当 access token 过期后，可以通过 refresh token 重新获取 access token。</li>
</ul>
<h3 id="2-4-应用场景"><a href="#2-4-应用场景" class="headerlink" title="2.4 应用场景"></a>2.4 应用场景</h3><ul>
<li>单点登录</li>
<li>第三方登录<ul>
<li>微信授权：<a href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Development_Guide.html" target="_blank" rel="external">https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Development_Guide.html</a></li>
</ul>
</li>
</ul>
<h3 id="2-5-实现"><a href="#2-5-实现" class="headerlink" title="2.5 实现"></a>2.5 实现</h3><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-oauth2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="认证服务器"><a href="#认证服务器" class="headerlink" title="认证服务器"></a>认证服务器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> alvin</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-10-06 10:14</span></div><div class="line"><span class="comment"> * 认证服务器配置</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@EnableAuthorizationServer</span></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationServerConfiguration</span>  <span class="keyword">extends</span> <span class="title">AuthorizationServerConfigurerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        clients.inMemory()</div><div class="line">                <span class="comment">// 客户端名称</span></div><div class="line">                .withClient(<span class="string">"client-postman"</span>)</div><div class="line">                <span class="comment">// 重定向地址</span></div><div class="line">                .redirectUris(<span class="string">"http://localhost:81/order"</span>)</div><div class="line">                <span class="comment">// scopes-&gt;role</span></div><div class="line">                .scopes(<span class="string">"read"</span>,<span class="string">"write"</span>)</div><div class="line">                <span class="comment">// 密码</span></div><div class="line">                .secret(<span class="string">"secret"</span>)</div><div class="line">                <span class="comment">// 授权类型</span></div><div class="line">                .authorizedGrantTypes(<span class="string">"authorization_code"</span>,<span class="string">"password"</span>,<span class="string">"implicit"</span>,<span class="string">"client_credentials"</span>);&#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerSecurityConfigurer security)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">super</span>.configure(security);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        endpoints.authenticationManager(authenticationManager);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    <span class="meta">@Qualifier</span>(<span class="string">"authenticationManagerBean"</span>)</div><div class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="security-配置"><a href="#security-配置" class="headerlink" title="security 配置"></a>security 配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> alvin</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-10-06 10:17</span></div><div class="line"><span class="comment"> * spring security 配置</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfiguration</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        http</div><div class="line">            .formLogin()</div><div class="line">            <span class="comment">// 关闭 csrf</span></div><div class="line">            .and().csrf().disable()</div><div class="line">            <span class="comment">// 所有请求需要认证</span></div><div class="line">            .authorizeRequests().anyRequest().authenticated();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">super</span>.configure(web);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        auth.inMemoryAuthentication()</div><div class="line">            .withUser(<span class="string">"111"</span>).password(<span class="string">"222"</span>).authorities(<span class="string">"user"</span>)</div><div class="line">            .and()</div><div class="line">            .withUser(<span class="string">"admin"</span>).password(<span class="string">"admin"</span>).authorities(<span class="string">"admin"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> AuthenticationManager <span class="title">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.authenticationManagerBean();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="function">PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> NoOpPasswordEncoder.getInstance();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="资源服务器"><a href="#资源服务器" class="headerlink" title="资源服务器"></a>资源服务器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> alvin</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-10-06 10:19</span></div><div class="line"><span class="comment"> * 资源服务器配置</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(prePostEnabled = <span class="keyword">true</span>)</div><div class="line"><span class="meta">@EnableResourceServer</span></div><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResourceServerConfiguration</span> <span class="keyword">extends</span> <span class="title">ResourceServerConfigurerAdapter</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        http</div><div class="line">            <span class="comment">// /oauth2/api/** 全部需要认证</span></div><div class="line">            .antMatcher(<span class="string">"/oauth2/api/**"</span>).authorizeRequests()</div><div class="line">            <span class="comment">// /oauth2/api/read/** 需要 read scope</span></div><div class="line">            <span class="comment">// /oauth2/api/write/** 需要 write scope</span></div><div class="line">            .antMatchers(HttpMethod.GET, <span class="string">"/oauth2/api/read/**"</span>).access(<span class="string">"#oauth2.hasScope('read')"</span>)</div><div class="line">            .antMatchers(HttpMethod.GET, <span class="string">"/oauth2/api/write/**"</span>).access(<span class="string">"#oauth2.hasScope('write')"</span>)</div><div class="line">        ;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="第三方服务-资源"><a href="#第三方服务-资源" class="headerlink" title="第三方服务(资源 )"></a>第三方服务(资源 )</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> alvin</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span> 2020-10-06 10:23</span></div><div class="line"><span class="comment"> * 第三方服务</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="meta">@RestController</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/oauth2/api/me"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">me</span><span class="params">()</span> </span>&#123;</div><div class="line">        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</div><div class="line">        <span class="keyword">return</span> authentication;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/oauth2/api/read/xxoo"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">xxoo</span><span class="params">()</span> </span>&#123;</div><div class="line">        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</div><div class="line">        System.out.println(<span class="string">"xxpp"</span>);</div><div class="line">        <span class="keyword">return</span> authentication;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/oauth2/api/write/xxoo"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">write</span><span class="params">()</span> </span>&#123;</div><div class="line">        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</div><div class="line">        System.out.println(<span class="string">"write"</span>);</div><div class="line">        <span class="keyword">return</span> authentication;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="使用PostMan获取token"><a href="#使用PostMan获取token" class="headerlink" title="使用PostMan获取token"></a>使用PostMan获取token</h4><p>启动服务，访问 <code>http://localhost:8080/oauth2/api/me</code>，正常访问；访问 <code>http://localhost:8080/oauth2/api/read/xxoo</code>，提示需要授权。</p>
<p><img src="../../images/springcloud/oauth2/获取token.png" alt=""></p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2020-05-31-算法与数据结构/训练营一期/线段树.html"></a><a class="next" href="/2020-05-28-算法与数据结构/每日一题/20200528_买卖股票最佳时机.html">121_买卖股票最佳时机</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IO/">IO</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS/">OS</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Srping-Boot/">Srping Boot</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ZooKeeper/">ZooKeeper</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/加解密技术/">加解密技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/吉他/">吉他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/多线程/">多线程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/无关技术/">无关技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列/">消息队列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/疯狂-Java-讲义/">疯狂 Java 讲义</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计划/">计划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/计划/" style="font-size: 15px;">计划</a> <a href="/tags/心情/" style="font-size: 15px;">心情</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/IO/" style="font-size: 15px;">IO</a> <a href="/tags/SFTP/" style="font-size: 15px;">SFTP</a> <a href="/tags/Samba/" style="font-size: 15px;">Samba</a> <a href="/tags/PGP/" style="font-size: 15px;">PGP</a> <a href="/tags/MQTT/" style="font-size: 15px;">MQTT</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/tags/Srping-Boot/" style="font-size: 15px;">Srping Boot</a> <a href="/tags/LVS/" style="font-size: 15px;">LVS</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/Eureka/" style="font-size: 15px;">Eureka</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/吉他/" style="font-size: 15px;">吉他</a> <a href="/tags/OS/" style="font-size: 15px;">OS</a> <a href="/tags/无关技术/" style="font-size: 15px;">无关技术</a> <a href="/tags/疯狂-Java-讲义/" style="font-size: 15px;">疯狂 Java 讲义</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/ZooKeeper/" style="font-size: 15px;">ZooKeeper</a> <a href="/tags/Observer/" style="font-size: 15px;">Observer</a> <a href="/tags/Singleton/" style="font-size: 15px;">Singleton</a> <a href="/tags/Proxy/" style="font-size: 15px;">Proxy</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.jamespan.me/" title="小鶸の道场" target="_blank">小鶸の道场</a><ul></ul><a href="https://www.haomwei.com/" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://www.ruanyifeng.com/home.html" title="阮一峰" target="_blank">阮一峰</a><ul></ul><a href="https://www.cnblogs.com/jingmoxukong/" title="静默虚空" target="_blank">静默虚空</a><ul></ul><a href="https://blog.hushhw.cn/" title="hushhw" target="_blank">hushhw</a><ul></ul><a href="https://hasaik.com/" title="hasaik" target="_blank">hasaik</a><ul></ul><a href="https://www.imalan.cn/" title="三无计划" target="_blank">三无计划</a><ul></ul><a href="https://i-meto.com/" title="meto" target="_blank">meto</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">悟空.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>