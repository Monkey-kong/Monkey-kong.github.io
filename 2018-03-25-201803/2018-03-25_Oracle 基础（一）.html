<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="悟空的技术博客"><title>Oracle 基础 | 悟空</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Oracle 基础</h1><a id="logo" href="/.">悟空</a><p class="description">悟空的技术博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Oracle 基础</h1><div class="post-meta">Mar 25, 2018<span> | </span><span class="category"><a href="/categories/数据库/">数据库</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Oracle-11g-的安装"><span class="toc-number">1.</span> <span class="toc-text">Oracle 11g 的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#下载地址："><span class="toc-number">1.1.</span> <span class="toc-text">下载地址：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统服务："><span class="toc-number">1.2.</span> <span class="toc-text">系统服务：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件体系结构"><span class="toc-number">1.3.</span> <span class="toc-text">文件体系结构:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#管理工具和开发工具"><span class="toc-number">1.4.</span> <span class="toc-text">管理工具和开发工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库的启动与关闭"><span class="toc-number">2.</span> <span class="toc-text">数据库的启动与关闭</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#启动"><span class="toc-number">2.1.</span> <span class="toc-text">启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关闭"><span class="toc-number">2.2.</span> <span class="toc-text">关闭</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询数据库状态"><span class="toc-number">2.3.</span> <span class="toc-text">查询数据库状态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Oracle-数据库系统结构"><span class="toc-number">3.</span> <span class="toc-text">Oracle 数据库系统结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#系统结构概述"><span class="toc-number">3.1.</span> <span class="toc-text">系统结构概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#存储结构"><span class="toc-number">3.2.</span> <span class="toc-text">存储结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#物理存储结构"><span class="toc-number">3.2.1.</span> <span class="toc-text">物理存储结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#逻辑存储结构"><span class="toc-number">3.2.2.</span> <span class="toc-text">逻辑存储结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#软件结构"><span class="toc-number">3.3.</span> <span class="toc-text">软件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#内存结构"><span class="toc-number">3.3.1.</span> <span class="toc-text">内存结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#后台进程"><span class="toc-number">3.3.2.</span> <span class="toc-text">后台进程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据库存储设置与管理"><span class="toc-number">4.</span> <span class="toc-text">数据库存储设置与管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#表空间的设置与管理"><span class="toc-number">4.1.</span> <span class="toc-text">表空间的设置与管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-创建表空间"><span class="toc-number">4.1.1.</span> <span class="toc-text">1.创建表空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-修改表空间"><span class="toc-number">4.1.2.</span> <span class="toc-text">2.修改表空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-查询表空间"><span class="toc-number">4.1.3.</span> <span class="toc-text">3.查询表空间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据文件的设置与管理"><span class="toc-number">4.2.</span> <span class="toc-text">数据文件的设置与管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#控制文件的设置与管理"><span class="toc-number">4.3.</span> <span class="toc-text">控制文件的设置与管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建控制文件和恢复数据库"><span class="toc-number">4.3.1.</span> <span class="toc-text">创建控制文件和恢复数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#控制文件的备份、删除以及查询"><span class="toc-number">4.3.2.</span> <span class="toc-text">控制文件的备份、删除以及查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重做日志文件的设置与管理"><span class="toc-number">4.4.</span> <span class="toc-text">重做日志文件的设置与管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#重做日志文件的创建、切换和删除"><span class="toc-number">4.4.1.</span> <span class="toc-text">重做日志文件的创建、切换和删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改重做日志文件的名称或位置、查询"><span class="toc-number">4.4.2.</span> <span class="toc-text">修改重做日志文件的名称或位置、查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#归档日志文件的设置与管理"><span class="toc-number">4.5.</span> <span class="toc-text">归档日志文件的设置与管理</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="Oracle-11g-的安装"><a href="#Oracle-11g-的安装" class="headerlink" title="Oracle 11g 的安装"></a>Oracle 11g 的安装</h2><h3 id="下载地址："><a href="#下载地址：" class="headerlink" title="下载地址："></a>下载地址：</h3><p><a href="http://www.oracle.com/technetwork/indexes/downloads/index.html" target="_blank" rel="external">Oracle 官网下载页</a>；安装时注意以管理员身份运行。</p>
<h3 id="系统服务："><a href="#系统服务：" class="headerlink" title="系统服务："></a>系统服务：</h3><ul>
<li>OracleServiceORCL:数据库服务，Oracle 核心服务，必须启动。</li>
<li>OracleOraDb11g_home1TNSListener:监听器服务，远程访问数据库时需要，必须启动。</li>
<li>其他服务均是非必须启动项，按需启动即可。</li>
</ul>
<h3 id="文件体系结构"><a href="#文件体系结构" class="headerlink" title="文件体系结构:"></a>文件体系结构:</h3><ul>
<li>admin:以数据库为单位，存放数据库运行过程中产生的跟踪文件。</li>
<li>cfgtoollogs:存放运行 dbca、emca和netca图形化程序时产生的日志信息。</li>
<li>checkpoints:存放数据库检查点相关信息。</li>
<li>diag:以组件为单位，集中存储数据库中各个组件运行的诊断信息。</li>
<li>flash_recory_area:以数据库为单位，当数据库自动备份时，存放备份文件、存放数据库的闪回日志文件。</li>
<li>oradata:以数据库为单位，存放数据库的物理文件，包括数据文件、控制文件和重做日志文件。</li>
<li>product:存放 Oracle 11g 数据库管理系统相关的软件，包括可执行文件、网络配置文件、脚本文件等。<h3 id="管理工具和开发工具"><a href="#管理工具和开发工具" class="headerlink" title="管理工具和开发工具"></a>管理工具和开发工具</h3>Oracle 企业管理器（OEM）：&lt; ORACLE_HOME &gt;\install\portlist.int<br><a href="https://127.0.0.1:1158/em" target="_blank" rel="external">https://127.0.0.1:1158/em</a><br>SQL Plus:<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">sqlplus sys/tiger@humansource AS SYSDBA</div><div class="line">CONNECT sys/tiger@humansource AS SYSDBA</div><div class="line">DISCONNECT</div><div class="line">EDIT</div><div class="line">SAVE D:\SAVE_FILE.sql</div><div class="line">GET D:\SAVE_FILE.sql</div><div class="line">EDIT</div><div class="line"><span class="keyword">START</span> D:\SAVE_FILE.sql</div><div class="line"><span class="keyword">SHOW</span> LINESIZE PAGESIZE</div><div class="line"><span class="keyword">SET</span> LINESIZE <span class="number">100</span> PAGESIZE <span class="number">30</span> <span class="keyword">TIME</span> <span class="keyword">ON</span></div><div class="line"><span class="keyword">DESC</span> DEPT</div><div class="line">SPOOL D:\SCREEN.txt</div><div class="line">SPOOL <span class="keyword">OFF</span></div><div class="line"><span class="keyword">CLEAR</span> SCREEN</div><div class="line"><span class="keyword">HELP</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="数据库的启动与关闭"><a href="#数据库的启动与关闭" class="headerlink" title="数据库的启动与关闭"></a>数据库的启动与关闭</h2><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><ul>
<li>STARTUP NOMOUNT：不装入数据库而启动实例。<br>仅仅通过初始化文件，分配出SGA区，启动数据库后台进程，没有打开控制文件和数<br>据文件。不能任何访问数据库。</li>
<li>STARTUP MOUNT：启动事例并装入数据库。<br>MOUNT数据库，仅仅给DBA进行管理操作，不允许数据库的用户访问。仅仅只是当前实例的控制文件被打开，数据文件未打开。</li>
<li>STARTUP：启动实例装入并打开数据库。</li>
<li>STARTUP RESTRICT：限制在启动时对数据库的访问。</li>
<li>STARTUP FORCE：强制事例启动 </li>
<li>STARTUP OPEN RECOVER：启动一个事例，装入数据库，并启动全部的介质恢复 </li>
<li>STARTUP OPEN sale PFILE=initsale.ora PARALLEL：启动独占或并行模式<h3 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h3></li>
<li>SHUTDOWN NORMAL：不允许新的连接、等待会话结束、等待事务结束、做一个检查点并关闭数据文件。启 动时不需要实例恢复。</li>
<li>SHUTDOWN TRANSACTIONAL：不允许新的连接、不等待会话结束、等待事务结束、做一个检查点并关闭数据文件。启动时不需要实例恢复。</li>
<li>SHUTDOWN IMMEDIATE：不允许新的连接、不等待会话结束、不等待事务结束、做一个检查点并关闭数据文件。没有结束的事务是自动rollback的。启动时不需要实例恢复。</li>
<li>SHUTDOWN ABORT：不允许新的连接、不等待会话结束、不等待事务结束、不做检查点且没有关闭数据文件。启动时自动进行实例恢复。<h3 id="查询数据库状态"><a href="#查询数据库状态" class="headerlink" title="查询数据库状态"></a>查询数据库状态</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> OPEN_MODE <span class="keyword">FROM</span> V$<span class="keyword">DATABASE</span>;</div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">STATUS</span> <span class="keyword">FROM</span> V$<span class="keyword">INSTANCE</span>;</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Oracle-数据库系统结构"><a href="#Oracle-数据库系统结构" class="headerlink" title="Oracle 数据库系统结构"></a>Oracle 数据库系统结构</h2><h3 id="系统结构概述"><a href="#系统结构概述" class="headerlink" title="系统结构概述"></a>系统结构概述</h3><p><img src="http://oexnrs3kx.bkt.clouddn.com/Oracle%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.jpg" alt="Oracle 数据库系统结构图"><br>从上图可看出，一个 Oracle 服务器，也就是一个数据库管理系统，由数据库<strong>存储结构</strong>和<strong>数据库实例(软件结构)</strong>两部分组成。<br>其中，存储结构包括<strong>物理存储结构和逻辑存储结构</strong>，是数据库存储以及空间分配的基础；<br>数据库实例是构成 Oracle 数据库的软件结构，包括<strong>内存结构（SGA）和后台进程</strong>，是数据库运行与管理的基础。</p>
<p>Oracle 数据库是由存放在磁盘上的数据库（DB）和对磁盘上的数据库进行管理的数据库管理系统（DBMS）两部分组成，分别对应数据库的存储结构和软件结构。</p>
<h3 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h3><p><img src="http://oexnrs3kx.bkt.clouddn.com/%E7%89%A9%E7%90%86%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E4%B8%8E%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%85%B3%E7%B3%BB.jpg" alt="此处输入图片的描述"></p>
<ul>
<li>一个数据库在物理上包含多个数据文件，在逻辑上包含多个表空间</li>
<li>表空间和数据文件是一对多关系</li>
<li>逻辑块由一个或多个操作系统块组成</li>
<li>一个逻辑区只能属于一个数据文件，而一个数据文件可以包含一个或多个逻辑区</li>
</ul>
<h4 id="物理存储结构"><a href="#物理存储结构" class="headerlink" title="物理存储结构"></a>物理存储结构</h4><ul>
<li>数据文件：数据库中所有数据的实际存储空间，所有数据文件的大小构成了数据库的大小</li>
<li>控制文件：记录数据库结构信息的重要二进制文件，由 Oracle 系统进行读写操作，DBA 不能直接操作控制文件</li>
<li>重做日志文件：以重做记录的形式记录、保存用户对数据库所进行的变更操作，是数据库中最重要的物理文件</li>
<li>归档日志文件：历史联机重做日志文件的集合</li>
<li>初始化参数文件：数据库启动过程所必须的文件，记录了数据库显示的参数的设置。数据库启动的第一步就是根据初始化参数文件中的设置，创建并启动实例，即分配内存空间、启动后台进程</li>
<li>跟踪文件：数据库中重要的诊断文件，是获取数据库信息的重要工具，对管理数据库的实例起着重要的作用<h4 id="逻辑存储结构"><a href="#逻辑存储结构" class="headerlink" title="逻辑存储结构"></a>逻辑存储结构</h4>块（对应 OS 块） —-&gt; 区 —-&gt; 段（表段、索引段、临时段、回退段） —-&gt; 表空间<br>数据库自动创建的表空间<br>|名称|类型|描述|<br>|—–|:——–|:—|<br>|SYSTEM|系统表空间|存放数据字典、数据库对象定义、PL/SQL程序源代码等|<br>|SYSAUX|辅助系统表空间|存储数据库组件信息|<br>|TEMP|临时表空间|存放临时数据，用于排序等|<br>|UNDOTBS1|撤销表空间|存储、管理回退信息|<br>|USERS|用户表空间|存放用户业务数据信息|<br>|EXAMPLE|实例表空间|存放实例的数据库方案对象信息|<h3 id="软件结构"><a href="#软件结构" class="headerlink" title="软件结构"></a>软件结构</h3>Oracle 数据库实例（软件结构）由一系列内存结构和后台进程组成。用户操作数据库的过程实质上是与数据库实例建立连接，然后通过实例来操作数据库的过程。用户所有的操作都在内存中进行，最后由数据库后台进程将操作结果写入各种物理文件中永久保存。<h4 id="内存结构"><a href="#内存结构" class="headerlink" title="内存结构"></a>内存结构</h4></li>
<li>系统全局区（SGA）：由 Oracle 分配的共享内存结构，包含一个数据库实例的数据和控制信息。SGA 数据供所有的服务器进程和后台进程共享，所以 SGA 又称为共享全局区。SGA 主要由数据高速缓冲区、共享池、重做日志缓冲区、大型池、Java 池、流池和其他结构组成。</li>
<li><p>程序全局区（PGA）</p>
<ul>
<li>排序区：存放排序操作所产生的临时数据</li>
<li>游标信息区：存放执行游标操作时产生的数据</li>
<li>会话信息区：保存用户会话所具有的权限、角色、性能统计信息</li>
<li>堆栈区：保存会话过程中的绑定变量、会话变量等信息<h4 id="后台进程"><a href="#后台进程" class="headerlink" title="后台进程"></a>后台进程</h4>进程概念：进程是操作系统中一个独立的可以调度的任务，用于完成指定的任务。进程与程序的区别在于：</li>
</ul>
</li>
<li><p>进程是动态的概念，即动态创建，完成任务后立即消亡；而程序事一个静态实体。</p>
</li>
<li>进程强调执行过程，而程序仅仅是指令的集合</li>
</ul>
<p>Oracle 中进程类型：</p>
<ul>
<li>用户进程：当用户连接数据库执行一个应用程序时，会创建一个用户进程，来完成用户指定的任务</li>
<li>服务器进程：由 Oracle 自身创建，用于处理连接到数据库实例的用户进程所提出的请求，其主要任务如下<ul>
<li>解析并执行用户提交的 SQL 语句和 PL/SQL 程序。</li>
<li>在 SGA 的数据高速缓冲区中搜索用户进程所要访问的数据，如果数据不在缓冲区中，则需要从硬盘数据文件中读取所需的数据，再将他们复制到缓冲区中。</li>
<li>将用户改变数据库的操作信息写入日志缓冲区中。</li>
<li>将查询或执行成功的结果数据返回给用户进程。</li>
</ul>
</li>
<li>后台进程：为保证 Oracle 数据库在任意一个时刻都可以处理多用户的并发请求，进行复杂的数据操作，而且优化系统性能，Oracle 数据库启用了一些互相独立的附加程序，称为后台进程。服务器进程在执行用户请求时，会调用后台进程来实现对数据库的操作。<ul>
<li>数据库写入进程（DBWR）:负责吧数据高速缓冲区中已经被修改的数据（脏缓存块）成批写入数据文件中永久保存，同时使得数据高速缓冲区有更多的空闲缓冲块，保证服务器进程将所需数据从数据文件中读取到高速缓冲区中，提高缓存命中率。</li>
<li>日志写入进程（LGWR）：负责把重做日志缓冲区中的重做记录写入重做日志文件中永久保存。</li>
<li>检查点（CKPT）：更新控制文件与数据文件的头部，使其同步；触发 DBWR 进程，将脏缓存快写入数据文件</li>
<li>归档进程（ARCH）：负责在日志切换后，将已经写满的重做日志文件复制到归档文件，防止写满的重做日志文件被覆盖。</li>
<li>系统监控进程（SMON）:数据库实例恢复；回收不再使用的临时空间；合并各个表空间的空闲碎片</li>
<li>进程监控进程（PMON）：恢复失败的用户进程或服务器进程，并释放进程所占用的资源；’清除非正常中断的用户进程留下的孤儿会话，回退未提交的事务，释放会话所占用的锁、SGA、PGA等资源；监控调度进程和服务器进程的状态，如果他们失败，则尝试重新启动他们，并释放他们所占用的资源。</li>
</ul>
</li>
</ul>
<h2 id="数据库存储设置与管理"><a href="#数据库存储设置与管理" class="headerlink" title="数据库存储设置与管理"></a>数据库存储设置与管理</h2><h3 id="表空间的设置与管理"><a href="#表空间的设置与管理" class="headerlink" title="表空间的设置与管理"></a>表空间的设置与管理</h3><h4 id="1-创建表空间"><a href="#1-创建表空间" class="headerlink" title="1.创建表空间"></a>1.创建表空间</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--创建永久性表空间，区定制扩展，段手动管理（默认全是自动）</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLESPACE</span> HRTBS1 <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\HRTBS1_1.DBF'</span> <span class="keyword">SIZE</span> <span class="number">50</span>M </div><div class="line">  <span class="keyword">EXTENT</span> <span class="keyword">MANAGEMENT</span> <span class="keyword">LOCAL</span> <span class="keyword">UNIFORM</span> <span class="keyword">SIZE</span> <span class="number">512</span>K</div><div class="line">  <span class="keyword">SEGMENT</span> <span class="keyword">SPACE</span> MANEGEMENT <span class="keyword">MANUAL</span>;</div><div class="line">  </div><div class="line"><span class="comment">--创建临时表空间和临时表空间组（段只能自动管理）</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLESPACE</span> HRTEMP1 TEMPFILE <span class="string">'D:\3_database\oracle\oradata\humansource\HRTEMP1_1.DBF'</span> <span class="keyword">SIZE</span> <span class="number">20</span>M </div><div class="line">  <span class="keyword">EXTENT</span> <span class="keyword">MANAGEMENT</span> <span class="keyword">LOCAL</span> <span class="keyword">UNIFORM</span> <span class="keyword">SIZE</span> <span class="number">15</span>M;</div><div class="line">  </div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLESPACE</span> HRTEMP2 TEMPFILE <span class="string">'D:\3_database\oracle\oradata\humansource\HRTEMP2_1.DBF'</span> <span class="keyword">SIZE</span> <span class="number">20</span>M </div><div class="line">  <span class="keyword">EXTENT</span> <span class="keyword">MANAGEMENT</span> <span class="keyword">LOCAL</span> <span class="keyword">UNIFORM</span> <span class="keyword">SIZE</span> <span class="number">15</span>M <span class="keyword">TABLESPACE</span> </div><div class="line">  <span class="keyword">GROUP</span> TEMP_GROUP;</div><div class="line">  </div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> HRTEMP1 <span class="keyword">TABLESPACE</span> <span class="keyword">GROUP</span> TEMP_GROUP;</div><div class="line"></div><div class="line"><span class="comment">--创建撤销表空间（段只能自动管理）</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNDO</span> <span class="keyword">TABLESPACE</span> HRUNDO1 <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\HRUNDO1_1.DBF'</span> <span class="keyword">SIZE</span> <span class="number">20</span>M;</div></pre></td></tr></table></figure>
<p>Oracle 主要有以上三种表空间。创建时注意数据文件的后缀是<strong>DBF</strong>,指定大小的后缀是<strong>M</strong>，不是MB。<br>还有一种大文件表空间（段只能自动管理），创建方式如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">BIGFILE</span> <span class="keyword">TABLESPACE</span> BIG_TBS <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\BIG01.DBF'</span> <span class="keyword">SIZE</span> <span class="number">1</span>G </div><div class="line">  <span class="keyword">EXTENT</span> <span class="keyword">MANAGEMENT</span> <span class="keyword">LOCAL</span> <span class="keyword">UNIFORM</span> <span class="keyword">SIZE</span> <span class="number">512</span>K;</div></pre></td></tr></table></figure></p>
<p>问题：<br>怎么理解区定制扩展、段手工管理？</p>
<h4 id="2-修改表空间"><a href="#2-修改表空间" class="headerlink" title="2.修改表空间"></a>2.修改表空间</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--2.1 为表空间添加数据文件</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> <span class="keyword">USERS</span> <span class="keyword">ADD</span> <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\USERS02.DBF'</span> <span class="keyword">SIZE</span> <span class="number">10</span>M;</div><div class="line"></div><div class="line"><span class="comment">--2.2 修改数据文件的扩展性</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\USERS02.DBF'</span> </div><div class="line">  <span class="keyword">AUTOEXTEND</span> <span class="keyword">ON</span> <span class="keyword">NEXT</span> <span class="number">1</span>M <span class="keyword">MAXSIZE</span> <span class="keyword">UNLIMITED</span>;</div><div class="line"><span class="comment">--取消自动增长</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\USERS02.DBF'</span> </div><div class="line">  <span class="keyword">AUTOEXTEND</span> <span class="keyword">OFF</span>;</div><div class="line"></div><div class="line"><span class="comment">--2.3 重新设置表空间的大小</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\USERS02.DBF'</span> <span class="keyword">RESIZE</span> <span class="number">8</span>M;</div><div class="line"></div><div class="line"><span class="comment">--2.4 修改表空间的可用性(SYSTEM、临时表空间和撤销表空间不可以修改)</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> <span class="keyword">USERS</span> <span class="keyword">OFFLINE</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> <span class="keyword">USERS</span> <span class="keyword">ONLINE</span>;</div><div class="line"></div><div class="line"><span class="comment">--2.5 修改表空间读写性</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> <span class="keyword">USERS</span> <span class="keyword">READ</span> <span class="keyword">ONLY</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> <span class="keyword">USERS</span> <span class="keyword">READ</span> WRITE;</div><div class="line"></div><div class="line"><span class="comment">--2.6 设置数据库的默认表空间</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">DEFAULT</span> <span class="keyword">TABLESPACE</span> HRTBS1;</div><div class="line"><span class="comment">--设置temp_grop临时表空间组为数据库的默认临时表空间</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">DEFAULT</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLESPACE</span> temp_group;</div><div class="line"></div><div class="line"><span class="comment">--2.7 表空间备份</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> HRTBS1 <span class="keyword">BEGIN</span> <span class="keyword">BACKUP</span>;</div><div class="line"><span class="comment">--将 HRTBS1 表空间的数据文件 HRTBS1_1.DBF 复制到备份路径</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> HRTBS1 <span class="keyword">END</span> <span class="keyword">BACKUP</span>;</div><div class="line"><span class="comment">--ORA-01123: 无法启动联机备份; 未启用介质恢复 解决方法</span></div><div class="line">ARCHIVE LOG LIST;</div><div class="line">SHUTDOWN IMMEDIATE;</div><div class="line">STARTUP MOUNT;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">ARCHIVELOG</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">OPEN</span>;</div><div class="line"></div><div class="line"><span class="comment">--2.8 删除表空间</span></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLESPACE</span> HRUNDO1 <span class="keyword">INCLUDING</span> <span class="keyword">CONTENTS</span> <span class="keyword">AND</span> <span class="keyword">DATAFILES</span> <span class="keyword">CASCADE</span> <span class="keyword">CONSTRAINTS</span>;</div></pre></td></tr></table></figure>
<p>修改表空间主要包括：</p>
<ul>
<li>为表空间添加数据文件</li>
<li>修改数据文件的扩展性（<strong>设置自动增长</strong>）</li>
<li>重新设置表空间的大小</li>
<li>修改表空间的可用性和读写性（<strong>OFFLINE、ONLINE\READ、WRITE</strong>）</li>
<li>设置数据库的默认表空间</li>
<li>表空间备份</li>
<li>表空间的删除<br>问题：<br>怎么理解表空间的 OFFLINE、ONLINE？</li>
</ul>
<p>怎么理解表空间的备份？不使用 BEGIN BACKUP 直接复制数据文件不能备份？</p>
<h4 id="3-查询表空间"><a href="#3-查询表空间" class="headerlink" title="3.查询表空间"></a>3.查询表空间</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> TABLESPACE_NAME,EXTENT_MANAGEMENT,ALLOCATION_TYPE,<span class="keyword">CONTENTS</span> <span class="keyword">FROM</span> DBA_TABLESPACES;</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> DBA_TABLESPACE_GROUPS;</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> V$<span class="keyword">TABLESPACE</span>;</div></pre></td></tr></table></figure>
<h3 id="数据文件的设置与管理"><a href="#数据文件的设置与管理" class="headerlink" title="数据文件的设置与管理"></a>数据文件的设置与管理</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--3.1 创建数据文件(就是向表空间添加数据文件；REUSE字句只能用于那些存在但是没有被应用的文件)</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> <span class="keyword">USERS</span> <span class="keyword">ADD</span> <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\HRUNDO1_1.DBF'</span> <span class="keyword">SIZE</span> <span class="number">10</span>M <span class="keyword">REUSE</span>;</div><div class="line"><span class="comment">--3.2 修改数据文件的大小（同设置表空间大小）</span></div><div class="line"></div><div class="line"><span class="comment">--3.3 改变数据文件的可用性</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\USERS02.DBF'</span> <span class="keyword">OFFLINE</span>;</div><div class="line"><span class="comment">--ORA-01145: 除非启用了介质恢复, 否则不允许立即脱机</span></div><div class="line">RECOVER DATAFILE 'D:\3_database\oracle\oradata\humansource\USERS02.DBF';</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">DATAFILE</span> <span class="string">'D:\3_database\oracle\oradata\humansource\USERS02.DBF'</span> <span class="keyword">ONLINE</span>;</div><div class="line"></div><div class="line"><span class="comment">--3.4 改变数据文件的名称和位置</span></div><div class="line"><span class="comment">--同一个表空间下</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> <span class="keyword">USERS</span> <span class="keyword">OFFLINE</span>;</div><div class="line">HOST COPY D:\3_database\oracle\oradata\humansource\USERS02.DBF</div><div class="line">  D:\3_database\oracle\oradata\USERS02.DBF;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> <span class="keyword">USERS</span> <span class="keyword">RENAME</span> <span class="keyword">DATAFILE</span></div><div class="line">  <span class="string">'D:\3_database\oracle\oradata\humansource\USERS02.DBF'</span> </div><div class="line">  <span class="keyword">TO</span> <span class="string">'D:\3_database\oracle\oradata\USERS02.DBF'</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span> <span class="keyword">USERS</span> <span class="keyword">ONLINE</span>;</div><div class="line"></div><div class="line"><span class="comment">--改变属于多个表空间的数据文件的名称或位置</span></div><div class="line"><span class="comment">--将 USERS 表空间中的 USERS01.DBF 文件和 UNDOTBS1 表空间中的 UNDOTBS01.DBF 文件移动到 D:\3_database\oracle\oradata 目录中</span></div><div class="line">SHUTDOWN IMMEDIATE;</div><div class="line">HOST COPY D:\3_database\oracle\oradata\humansource\USERS01.DBF</div><div class="line">  D:\3_database\oracle\oradata\USERS01.DBF;</div><div class="line">HOST COPY D:\3_database\oracle\oradata\humansource\UNDOTBS01.DBF</div><div class="line">  D:\3_database\oracle\oradata\UNDOTBS01.DBF;</div><div class="line">STARTUP MOUNT;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">RENAME</span> <span class="keyword">FILE</span></div><div class="line">  <span class="string">'D:\3_database\oracle\oradata\humansource\USERS01.DBF'</span>,</div><div class="line">  <span class="string">'D:\3_database\oracle\oradata\humansource\UNDOTBS01.DBF'</span> </div><div class="line">  <span class="keyword">TO</span> <span class="string">'D:\3_database\oracle\oradata\USERS01.DBF'</span>,</div><div class="line">  <span class="string">'D:\3_database\oracle\oradata\UNDOTBS01.DBF'</span>;</div><div class="line">RECOVER DATAFILE 'D:\3_database\oracle\oradata\UNDOTBS01.DBF';</div><div class="line">RECOVER DATAFILE 'D:\3_database\oracle\oradata\USERS01.DBF';</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">OPEN</span>;</div><div class="line"></div><div class="line"><span class="comment">--4.5 查询数据文件信息</span></div><div class="line"><span class="keyword">SELECT</span> TABLESPACE_NAME,FILE_NAME <span class="keyword">FROM</span> DBA_DATA_FILES;</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> V$<span class="keyword">DATAFILE</span>;</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> DBA_TEMP_FILES;</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> V$TEMPFILE;</div></pre></td></tr></table></figure>
<p>数据文件的设置与管理主要包括：</p>
<ol>
<li>数据文件的创建、设置文件的大小以及可用性。这些都和表空间的设置差不多。</li>
<li>改变数据文件的位置和名称<br>如果改变同一个表空间下的数据文件：依次表空间 <strong>OFFLINE</strong>、物理的 <strong>COPY</strong>、<strong>RENAME</strong>、<strong>ONLINE</strong> 即可。<br>如果改变不同表空间的数据文件,需要关闭数据库，然后将数据库启动到加载状态。<br>即依次：<strong>SHUTDOWN</strong>、物理<strong>COPY</strong>、<strong>STARTUP</strong> <strong>MOUNT</strong>、<strong>RENAME</strong>、<strong>RECOVER</strong>、<strong>OPEN</strong></li>
</ol>
<h3 id="控制文件的设置与管理"><a href="#控制文件的设置与管理" class="headerlink" title="控制文件的设置与管理"></a>控制文件的设置与管理</h3><h4 id="创建控制文件和恢复数据库"><a href="#创建控制文件和恢复数据库" class="headerlink" title="创建控制文件和恢复数据库"></a>创建控制文件和恢复数据库</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--1. 查询数据库中的重做日志文件和数据文件，方便控制文件的创建</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">MEMBER</span> <span class="keyword">FROM</span> V$<span class="keyword">LOGFILE</span>;</div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span> <span class="keyword">FROM</span> V$<span class="keyword">DATAFILE</span>;</div><div class="line"></div><div class="line"><span class="comment">--2. 关闭数据库、进入 NOMOUNT 状态</span></div><div class="line">SHUTDOWN NORMAL;</div><div class="line"><span class="comment">--备份所有数据文件和重做日志文件</span></div><div class="line">STARTUP NOMOUNT;</div><div class="line"></div><div class="line"><span class="comment">--3.1 创建控制文件（NORESETLOGS 方式）</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">CONTROLFILE</span> <span class="keyword">REUSE</span> <span class="keyword">DATABASE</span> <span class="string">"HUMANSOU"</span> <span class="keyword">NORESETLOGS</span> <span class="keyword">ARCHIVELOG</span> </div><div class="line">    <span class="keyword">MAXLOGFILES</span> <span class="number">16</span> </div><div class="line">    <span class="keyword">MAXLOGMEMBERS</span> <span class="number">3</span> </div><div class="line">    MAXDATAFILES <span class="number">100</span> </div><div class="line">    <span class="keyword">MAXINSTANCES</span> <span class="number">8</span> </div><div class="line">    <span class="keyword">MAXLOGHISTORY</span> <span class="number">292</span></div><div class="line"><span class="keyword">LOGFILE</span></div><div class="line">    <span class="keyword">GROUP</span> <span class="number">1</span> <span class="string">'D:\3_database\oracle\oradata\humansource\REDO01.LOG'</span> <span class="keyword">SIZE</span> <span class="number">50</span>M,</div><div class="line">    <span class="keyword">GROUP</span> <span class="number">2</span> <span class="string">'D:\3_database\oracle\oradata\humansource\REDO02.LOG'</span> <span class="keyword">SIZE</span> <span class="number">50</span>M,</div><div class="line">    <span class="keyword">GROUP</span> <span class="number">3</span> <span class="string">'D:\3_database\oracle\oradata\humansource\REDO03.LOG'</span> <span class="keyword">SIZE</span> <span class="number">50</span>M </div><div class="line"><span class="keyword">DATAFILE</span> </div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\SYSTEM01.DBF'</span>,</div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\SYSAUX01.DBF'</span>,</div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\UNDOTBS01.DBF'</span>,</div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\USERS01.DBF'</span>,</div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\EXAMPLE01.DBF'</span></div><div class="line"><span class="built_in">CHARACTER</span> <span class="keyword">SET</span> ZHS16GBK;</div><div class="line"></div><div class="line"><span class="comment">--4. 恢复和启动数据库</span></div><div class="line">RECOVER DATABASE;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">OPEN</span>;</div><div class="line"></div><div class="line"><span class="comment">--3.2 创建控制文件（RESETLOGS 方式） </span></div><div class="line"><span class="comment">--关闭数据库</span></div><div class="line">SHUTDOWN NORMAL;</div><div class="line">STARTUP NOMOUNT;</div><div class="line"></div><div class="line"><span class="comment">--创建控制文件</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">CONTROLFILE</span> <span class="keyword">REUSE</span> <span class="keyword">DATABASE</span> <span class="string">"HUMANSOU"</span> <span class="keyword">RESETLOGS</span> <span class="keyword">ARCHIVELOG</span> </div><div class="line">    <span class="keyword">MAXLOGFILES</span> <span class="number">16</span> </div><div class="line">    <span class="keyword">MAXLOGMEMBERS</span> <span class="number">3</span> </div><div class="line">    MAXDATAFILES <span class="number">100</span> </div><div class="line">    <span class="keyword">MAXINSTANCES</span> <span class="number">8</span> </div><div class="line">    <span class="keyword">MAXLOGHISTORY</span> <span class="number">292</span></div><div class="line"><span class="keyword">LOGFILE</span></div><div class="line">    <span class="keyword">GROUP</span> <span class="number">1</span> <span class="string">'D:\3_database\oracle\oradata\humansource\REDO01.LOG'</span> <span class="keyword">SIZE</span> <span class="number">50</span>M,</div><div class="line">    <span class="keyword">GROUP</span> <span class="number">2</span> <span class="string">'D:\3_database\oracle\oradata\humansource\REDO02.LOG'</span> <span class="keyword">SIZE</span> <span class="number">50</span>M,</div><div class="line">    <span class="keyword">GROUP</span> <span class="number">3</span> <span class="string">'D:\3_database\oracle\oradata\humansource\REDO03.LOG'</span> <span class="keyword">SIZE</span> <span class="number">50</span>M </div><div class="line"><span class="keyword">DATAFILE</span> </div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\SYSTEM01.DBF'</span>,</div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\SYSAUX01.DBF'</span>,</div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\UNDOTBS01.DBF'</span>,</div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\USERS01.DBF'</span>,</div><div class="line">    <span class="string">'D:\3_database\oracle\oradata\humansource\EXAMPLE01.DBF'</span></div><div class="line"><span class="built_in">CHARACTER</span> <span class="keyword">SET</span> ZHS16GBK;</div><div class="line"></div><div class="line"><span class="comment">--恢复（利用重做日志文件恢复）并启动数据库</span></div><div class="line">RECOVER DATABASE USING <span class="keyword">BACKUP</span> <span class="keyword">CONTROLFILE</span> <span class="keyword">UNTIL</span> <span class="keyword">CANCEL</span>;</div><div class="line">D:\3_database\oracle\oradata\humansource\REDO03.LOG</div><div class="line">RECOVER DATABASE USING <span class="keyword">BACKUP</span> <span class="keyword">CONTROLFILE</span> <span class="keyword">UNTIL</span> <span class="keyword">CANCEL</span>;</div><div class="line">D:\3_database\oracle\oradata\humansource\REDO02.LOG</div><div class="line">RECOVER DATABASE USING <span class="keyword">BACKUP</span> <span class="keyword">CONTROLFILE</span> <span class="keyword">UNTIL</span> <span class="keyword">CANCEL</span>;</div><div class="line">D:\3_database\oracle\oradata\humansource\REDO01.LOG</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">OPEN</span> <span class="keyword">RESETLOGS</span>;</div></pre></td></tr></table></figure>
<h4 id="控制文件的备份、删除以及查询"><a href="#控制文件的备份、删除以及查询" class="headerlink" title="控制文件的备份、删除以及查询"></a>控制文件的备份、删除以及查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--1. 备份新建的控制文件</span></div><div class="line"><span class="comment">--二进制文件形式备份</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">BACKUP</span> <span class="keyword">CONTROLFILE</span> <span class="keyword">TO</span></div><div class="line">  <span class="string">'D:\3_database\oracle\oradata\FILEBACKUP\CONTROL.BKP'</span>;</div><div class="line"> </div><div class="line"> <span class="comment">--跟踪文件形式备份</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">BACKUP</span> <span class="keyword">CONTROLFILE</span> <span class="keyword">TO</span> <span class="keyword">TRACE</span>;</div><div class="line"><span class="comment">--然后通过查询跟踪文件的脚本可以查询到相关的详细信息</span></div><div class="line"><span class="keyword">SELECT</span> a.VALUE||b.symbol||c.instance_name||<span class="string">'_ora_'</span>||d.spid||<span class="string">'.trc'</span> TRACE_FILE_NAME</div><div class="line">    <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">VALUE</span> <span class="keyword">FROM</span> v$parameter <span class="keyword">WHERE</span> <span class="keyword">NAME</span>=<span class="string">'user_dump_dest'</span>) a,</div><div class="line">         (<span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="keyword">VALUE</span>,<span class="number">-6</span>,<span class="number">1</span>) symbol <span class="keyword">FROM</span> v$parameter <span class="keyword">WHERE</span> <span class="keyword">NAME</span>=<span class="string">'user_dump_dest'</span>) b,</div><div class="line">         (<span class="keyword">SELECT</span> instance_name <span class="keyword">FROM</span> v$<span class="keyword">instance</span>) c,</div><div class="line">         (<span class="keyword">SELECT</span> spid <span class="keyword">FROM</span> v$<span class="keyword">session</span> s,v$process p,v$mystat m</div><div class="line">          <span class="keyword">WHERE</span> s.paddr=p.addr <span class="keyword">AND</span> s.SID=m.SID <span class="keyword">AND</span> m.statistic#=<span class="number">0</span>) d</div><div class="line"></div><div class="line"><span class="comment">--2. 删除控制文件</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> CONTROL_FILES=</div><div class="line">  <span class="string">'D:\3_database\oracle\oradata\humansource\CONTROL01.CTL'</span>,</div><div class="line">  <span class="string">'D:\3_database\oracle\flash_recovery_area\humansource\CONTROL02.CTL'</span></div><div class="line">  <span class="keyword">SCOPE</span>=<span class="keyword">SPFILE</span>;</div><div class="line">SHUTDOWN IMMEDIATE;</div><div class="line">HOST DEL D:\3_database\oracle\oradata\humansource\CONTROL03.CTL</div><div class="line">STARTUP;</div><div class="line"></div><div class="line"><span class="comment">--3. 查询控制文件信息</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span> <span class="keyword">FROM</span> V$<span class="keyword">CONTROLFILE</span>;</div></pre></td></tr></table></figure>
<h3 id="重做日志文件的设置与管理"><a href="#重做日志文件的设置与管理" class="headerlink" title="重做日志文件的设置与管理"></a>重做日志文件的设置与管理</h3><h4 id="重做日志文件的创建、切换和删除"><a href="#重做日志文件的创建、切换和删除" class="headerlink" title="重做日志文件的创建、切换和删除"></a>重做日志文件的创建、切换和删除</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--1.创建重做日志文件组及其成员</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">ADD</span> <span class="keyword">LOGFILE</span> <span class="keyword">GROUP</span> <span class="number">4</span> </div><div class="line">    (<span class="string">'D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO04A.LOG'</span>,</div><div class="line">    <span class="string">'D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO04B.LOG'</span>) <span class="keyword">SIZE</span> <span class="number">10</span>M;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">ADD</span> <span class="keyword">LOGFILE</span> <span class="keyword">MEMBER</span> </div><div class="line">    <span class="string">'D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO01B.LOG'</span> <span class="keyword">TO</span> <span class="keyword">GROUP</span> <span class="number">1</span>,</div><div class="line">    <span class="string">'D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO02B.LOG'</span> <span class="keyword">TO</span> <span class="keyword">GROUP</span> <span class="number">2</span>,</div><div class="line">    <span class="string">'D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO03B.LOG'</span> <span class="keyword">TO</span> <span class="keyword">GROUP</span> <span class="number">3</span>;</div><div class="line">    </div><div class="line"><span class="comment">--2.重做日志文件切换</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SWITCH</span> <span class="keyword">LOGFILE</span>;</div><div class="line"></div><div class="line"><span class="comment">--3.删除重做日志文件组及其成员</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">DROP</span> <span class="keyword">LOGFILE</span> <span class="keyword">MEMBER</span> <span class="string">'D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO04B.LOG'</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">DROP</span> <span class="keyword">LOGFILE</span> <span class="keyword">GROUP</span> <span class="number">4</span>;</div></pre></td></tr></table></figure>
<p>注意：<br>只能删除 INACTIVE、UNUSED 状态下的日志文件。<br>删除指的是改变控制文件，并没有真正的从磁盘上删除这个重做日志文件。</p>
<h4 id="修改重做日志文件的名称或位置、查询"><a href="#修改重做日志文件的名称或位置、查询" class="headerlink" title="修改重做日志文件的名称或位置、查询"></a>修改重做日志文件的名称或位置、查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--4.修改重做日志文件的名称或位置(INACTIVE状态的日志)</span></div><div class="line">HOST MOVE D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO01B.LOG</div><div class="line">  D:\3_DATABASE\ORACLE\ORADATA\REDO01B.LOG;</div><div class="line">HOST MOVE D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO03B.LOG</div><div class="line">  D:\3_DATABASE\ORACLE\ORADATA\REDO03B.LOG;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">RENAME</span> <span class="keyword">FILE</span> </div><div class="line">    <span class="string">'D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO01B.LOG'</span>,</div><div class="line">    <span class="string">'D:\3_DATABASE\ORACLE\ORADATA\HUMANSOURCE\REDO03B.LOG'</span> </div><div class="line">    <span class="keyword">TO</span> </div><div class="line">    <span class="string">'D:\3_DATABASE\ORACLE\ORADATA\REDO01B.LOG'</span>,</div><div class="line">    <span class="string">'D:\3_DATABASE\ORACLE\ORADATA\REDO03B.LOG'</span>;</div><div class="line">    </div><div class="line"><span class="comment">--5.查询重做日志文件信息</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">GROUP</span>#,<span class="keyword">SEQUENCE</span>#,MEMBERS,<span class="keyword">ARCHIVED</span>,<span class="keyword">STATUS</span> <span class="keyword">FROM</span> V$<span class="keyword">LOG</span>;</div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">GROUP</span>#,<span class="keyword">STATUS</span>,<span class="keyword">MEMBER</span> <span class="keyword">FROM</span> V$<span class="keyword">LOGFILE</span>;</div></pre></td></tr></table></figure>
<h3 id="归档日志文件的设置与管理"><a href="#归档日志文件的设置与管理" class="headerlink" title="归档日志文件的设置与管理"></a>归档日志文件的设置与管理</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--1.数据库归档模式的设置</span></div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">NAME</span>,<span class="keyword">VALUE</span> <span class="keyword">FROM</span> V$PARAMETER <span class="keyword">WHERE</span> <span class="keyword">NAME</span>=<span class="string">'db_recovery_file_dest'</span>;</div><div class="line">SHUTDOWN IMMEDIATE;</div><div class="line">STARTUP MOUNT;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">NOARCHIVELOG</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">ARCHIVELOG</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> <span class="keyword">OPEN</span>;</div><div class="line"></div><div class="line"><span class="comment">--2.归档目标设置</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> db_recovery_file_dest=<span class="string">''</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> LOG_ARCHIVE_DEST=<span class="string">'D:\3_database\oracle\oradata\FILEBACKUP\ARCHIVE'</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> LOG_ARCHIVE_DUPLEX_DEST=<span class="string">'D:\3_database\oracle\oradata\FILEBACKUP\ARCHIVE'</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> LOG_ARCHIVE_DEST_1=<span class="string">'D:\3_database\oracle\oradata\FILEBACKUP\ARCHIVE MANDAROTY'</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> LOG_ARCHIVE_DEST_2=<span class="string">'D:\3_database\oracle\oradata\FILEBACKUP\ARCHIVE MANDAROTY'</span>;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> LOG_ARCHIVE_DEST_5=<span class="string">'SERVICE=STANDBY1'</span>;</div><div class="line"></div><div class="line"><span class="comment">--3.查询归档信息</span></div><div class="line">ARCHIVE LOG LIST;</div><div class="line"><span class="keyword">SELECT</span> <span class="keyword">SEQUENCE</span>#,FIRST_CHANGE#,NEXT_CHANGE# <span class="keyword">FROM</span> V$ARCHIVED_LOG;</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> V$<span class="keyword">DATABASE</span>;</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> V$ARCHIVE_DEST;</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> V$ARCHIVE_PROCESSES;</div></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/Oracle/">Oracle</a></div><div class="post-nav"><a class="pre" href="/2018-03-25-201803/2018-03-25_Samba 入门.html">Samba 入门</a><a class="next" href="/2018-03-25-201803/2018-03-25_Linux 基础.html">Linux 基础</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/加解密技术/">加解密技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列/">消息队列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020-02-22-202002/NIO原理.html">NIO 原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020-02-21-202002/Redis 学习(四)-集群.html">Redis 学习(四)-主从复制、高可用、集群</a></li><li class="post-list-item"><a class="post-list-link" href="/2020-02-20-202002/Redis 学习(三)-持久化.html">Redis 学习(三)-持久化</a></li><li class="post-list-item"><a class="post-list-link" href="/2020-02-19-202002/Redis 学习(二)-基本功能.html">Redis 学习(二)-管道、发布/订阅、事务、modules、过期</a></li><li class="post-list-item"><a class="post-list-link" href="/2020-02-18-202002/Redis 学习(一)-基本指令.html">Redis 学习(一)-概述、安装、类型、指令</a></li><li class="post-list-item"><a class="post-list-link" href="/2019-11-09-201911/2019-11-09_mqtt 学习笔记.html">mqtt 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019-11-09-201911/2019-11-09_Kafka 学习笔记（一）.html">Kafka 学习笔记（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019-11-07-201911/2019-11-07_云服务器的使用.html">云服务器的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019-03-09-201609/2016-09-17_使用Hexo搭建个人技术博客.html">使用Hexo搭建个人技术博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2018-03-25-201803/2018-03-25_Samba 入门.html">Samba 入门</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.jamespan.me/" title="小鶸の道场" target="_blank">小鶸の道场</a><ul></ul><a href="https://www.haomwei.com/" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://www.ruanyifeng.com/home.html" title="阮一峰" target="_blank">阮一峰</a><ul></ul><a href="https://www.cnblogs.com/jingmoxukong/" title="静默虚空" target="_blank">静默虚空</a><ul></ul><a href="https://blog.hushhw.cn/" title="hushhw" target="_blank">hushhw</a><ul></ul><a href="https://hasaik.com/" title="hasaik" target="_blank">hasaik</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">悟空.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>