<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="悟空的技术博客"><title>第 8 章 Java 集合 | 悟空</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">第 8 章 Java 集合</h1><a id="logo" href="/.">悟空</a><p class="description">悟空的技术博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">第 8 章 Java 集合</h1><div class="post-meta">Jan 8, 2020<span> | </span><span class="category"><a href="/categories/疯狂-Java-讲义/">疯狂 Java 讲义</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-Java-集合概述"><span class="toc-text">8.1 Java 集合概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-Collection-和-Iterator-接口"><span class="toc-text">8.2 Collection 和 Iterator 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-使用-Lambda-表达式遍历集合"><span class="toc-text">8.2.1 使用 Lambda 表达式遍历集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-Java-8-增强的-Iterator-遍历集合"><span class="toc-text">8.2.2 Java 8 增强的 Iterator 遍历集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-3-使用-Lambda-表达式遍历-Iterator"><span class="toc-text">8.2.3 使用 Lambda 表达式遍历 Iterator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-4-使用-foreach-遍历集合"><span class="toc-text">8.2.4 使用 foreach 遍历集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-5-Java8-新增的-Predicate-操作集合"><span class="toc-text">8.2.5 Java8 新增的 Predicate 操作集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-6-Java8-新增的-Stream-操作集合"><span class="toc-text">8.2.6 Java8 新增的 Stream 操作集合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-Set-集合"><span class="toc-text">8.3 Set 集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-1-HashSet-类"><span class="toc-text">8.3.1 HashSet 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-2-LinkedHashSet-类"><span class="toc-text">8.3.2 LinkedHashSet 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-3-TreeSet-类"><span class="toc-text">8.3.3 TreeSet 类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-自然排序"><span class="toc-text">1. 自然排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-定制排序"><span class="toc-text">2. 定制排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-4-EnumSet-类"><span class="toc-text">8.3.4 EnumSet 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-5-各-Set-实现类性能分析"><span class="toc-text">8.3.5 各 Set 实现类性能分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-List-集合"><span class="toc-text">8.4 List 集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-1-Java8-改进的-List-接口和-ListIterator-接口"><span class="toc-text">8.4.1 Java8 改进的 List 接口和 ListIterator 接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-2-ArrayList-和-Vector-实现类"><span class="toc-text">8.4.2 ArrayList 和 Vector 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-3-固定长度的-List"><span class="toc-text">8.4.3 固定长度的 List</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-Queue-集合"><span class="toc-text">8.5 Queue 集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-1-PriorityQueue-实现类"><span class="toc-text">8.5.1 PriorityQueue 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-2-Deque-接口与-ArrayDeque-实现类"><span class="toc-text">8.5.2 Deque 接口与 ArrayDeque 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-3-LinkedList-实现类"><span class="toc-text">8.5.3 LinkedList 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-4-各种线性表性能分析"><span class="toc-text">8.5.4 各种线性表性能分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-6-Java8-增强的-Map-集合"><span class="toc-text">8.6 Java8 增强的 Map 集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-1-Java8-为-Map-新增的方法"><span class="toc-text">8.6.1 Java8 为 Map 新增的方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-2-Java8-改进的-HashMap-和-Hashtable-实现类"><span class="toc-text">8.6.2 Java8 改进的 HashMap 和 Hashtable 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-3-LinkedHashMap-实现类"><span class="toc-text">8.6.3 LinkedHashMap 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-4-使用-Properties-读写属性文件"><span class="toc-text">8.6.4 使用 Properties 读写属性文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-5-SortedMap-接口和-TreeMap-实现类"><span class="toc-text">8.6.5 SortedMap 接口和 TreeMap 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-6-WeakHashMap-实现类"><span class="toc-text">8.6.6 WeakHashMap 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-7-IdentityHashMap-实现类"><span class="toc-text">8.6.7 IdentityHashMap 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-8-EnumMap-实现类"><span class="toc-text">8.6.8 EnumMap 实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-9-各-Map-实现类性能分析"><span class="toc-text">8.6.9 各 Map 实现类性能分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-7-HashSet-和-HashMap-的性能选项"><span class="toc-text">8.7 HashSet 和 HashMap 的性能选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-8-操作集合工具类：Collections"><span class="toc-text">8.8 操作集合工具类：Collections</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-1-排序操作"><span class="toc-text">8.8.1 排序操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-2-查找、替换操作"><span class="toc-text">8.8.2 查找、替换操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-3-同步操作"><span class="toc-text">8.8.3 同步操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-4-设置不可变集合"><span class="toc-text">8.8.4 设置不可变集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-5-Java9-新增的不可变集合"><span class="toc-text">8.8.5 Java9 新增的不可变集合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-9-繁琐的接口：Enumeration"><span class="toc-text">8.9 繁琐的接口：Enumeration</span></a></li></ol></div></div><div class="post-content"><p>第 8 章 Java 集合</p>
<a id="more"></a>
<h2 id="8-1-Java-集合概述"><a href="#8-1-Java-集合概述" class="headerlink" title="8.1 Java 集合概述"></a>8.1 Java 集合概述</h2><p>可以使用数组来保存多个对象，但数组的<strong>长度不可变化</strong>，同时数组也没法保存具有映射关系的数据。</p>
<p>数组元素既可以是基本类型的值也可以是对象（实际上是对象的引用）；而集合里只能保存对象。</p>
<p>Java 的集合类主要由两个接口派生而成：Collection、Map</p>
<p><img src="../../images/java/c8/Collection体系继承树.png" alt=""></p>
<p><img src="../../images/java/c8/Map体系继承树.png" alt=""></p>
<h2 id="8-2-Collection-和-Iterator-接口"><a href="#8-2-Collection-和-Iterator-接口" class="headerlink" title="8.2 Collection 和 Iterator 接口"></a>8.2 Collection 和 Iterator 接口</h2><p>Collection 是 List、Set、Queue 接口的父接口，所有它定义的方法，其他三类集合均可使用。</p>
<ul>
<li>boolean add(Object o)</li>
<li>boolean addAll(Cllection c)</li>
<li>void clear()</li>
<li>boolean contains(Object o)</li>
<li>boolean containsAll(Collection c)</li>
<li>boolean isEmpty()</li>
<li><strong>Iterator iterator()</strong></li>
<li>boolean remove(Object o)：包含多个 o 时，只删除第一个</li>
<li>boolean removeAll(Collection c)</li>
<li><strong>boolean retainAll(Collection c)</strong>：删除 c 中不包含的元素</li>
<li>int size()</li>
<li>Object[] toArray()</li>
</ul>
<h3 id="8-2-1-使用-Lambda-表达式遍历集合"><a href="#8-2-1-使用-Lambda-表达式遍历集合" class="headerlink" title="8.2.1 使用 Lambda 表达式遍历集合"></a>8.2.1 使用 Lambda 表达式遍历集合</h3><p>Java8 为 Iterable 接口新增了 forEach(Consumer action) 默认方法，Iterable是 Collection 的父接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionEach</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Collection books = <span class="keyword">new</span> HashSet();</div><div class="line">        books.add(<span class="string">"疯狂 Java 讲义"</span>);</div><div class="line">        books.add(<span class="string">"Spring 实战"</span>);</div><div class="line">        books.add(<span class="string">"轻量级 Java EE 企业应用实战"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// <span class="doctag">TODO:</span> 理解函数式编程</span></div><div class="line">        books.forEach(obj -&gt; System.out.println(obj));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-2-2-Java-8-增强的-Iterator-遍历集合"><a href="#8-2-2-Java-8-增强的-Iterator-遍历集合" class="headerlink" title="8.2.2 Java 8 增强的 Iterator 遍历集合"></a>8.2.2 Java 8 增强的 Iterator 遍历集合</h3><p>Iterator 主要用于遍历 Collection 元素，也称之为迭代器。</p>
<ul>
<li>boolean hasNext()</li>
<li>Object next()</li>
<li>void remove()：删除集合里上次 next 返回的元素</li>
<li>void forEachRemaining(Consumer action)：Java8 新增，可用 Lambda 遍历</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Iterator it = books.iterator();</div><div class="line"><span class="keyword">while</span> (it.hasNext())&#123;</div><div class="line">    String book = (String)it.next();</div><div class="line">    System.out.println(book);</div><div class="line">    <span class="keyword">if</span>(book.equalsIgnoreCase(<span class="string">"疯狂 Java 讲义"</span>))&#123;</div><div class="line">        it.remove();</div><div class="line">        <span class="comment">// ConcurrentModificationException 异常</span></div><div class="line">        <span class="comment">// SDK12 不报错了</span></div><div class="line">        books.remove(book);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 不会改变集合元素本身</span></div><div class="line">    <span class="comment">// 可以看出：遍历时，不是把集合元素本身传递给迭代变量</span></div><div class="line">    book = <span class="string">"测试。。。"</span>;</div><div class="line">&#125;</div><div class="line">System.out.println(books);</div></pre></td></tr></table></figure>
<h3 id="8-2-3-使用-Lambda-表达式遍历-Iterator"><a href="#8-2-3-使用-Lambda-表达式遍历-Iterator" class="headerlink" title="8.2.3 使用 Lambda 表达式遍历 Iterator"></a>8.2.3 使用 Lambda 表达式遍历 Iterator</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Iterator it2 = books.iterator();</div><div class="line">it2.forEachRemaining(obj -&gt; System.out.println(obj));</div></pre></td></tr></table></figure>
<h3 id="8-2-4-使用-foreach-遍历集合"><a href="#8-2-4-使用-foreach-遍历集合" class="headerlink" title="8.2.4 使用 foreach 遍历集合"></a>8.2.4 使用 foreach 遍历集合</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (Object obj : books)&#123;</div><div class="line">    <span class="comment">// 此处 book 也不是集合元素本身</span></div><div class="line">    String book = (String)obj;</div><div class="line">    System.out.println(book);</div><div class="line">    <span class="keyword">if</span>(book.equals(<span class="string">"Spring 实战"</span>))&#123;</div><div class="line">        <span class="comment">// ConcurrentModificationException 异常</span></div><div class="line">        books.remove(book);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-2-5-Java8-新增的-Predicate-操作集合"><a href="#8-2-5-Java8-新增的-Predicate-操作集合" class="headerlink" title="8.2.5 Java8 新增的 Predicate 操作集合"></a>8.2.5 Java8 新增的 Predicate 操作集合</h3><p>Java 8 为 Collection 新增了一个 removeIf(Predicate filter) 方法，用来批量删除符合 filter 的所有元素。Predicate 也是函数式接口，可以用 Lambda</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 删除长度小于 10 的元素</span></div><div class="line">books.removeIf(ele -&gt; ((String)ele).length() &lt; <span class="number">10</span>);</div></pre></td></tr></table></figure>
<p>使用 Predicate 可以充分简化集合的运算。</p>
<ul>
<li>统计书名中出现“Java”字符串的数量</li>
<li>统计书名长度大于10的数量</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">callAll</span><span class="params">(Collection books, Predicate predicate)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (Object obj : books)&#123;</div><div class="line">        <span class="keyword">if</span>(predicate.test(obj))&#123;</div><div class="line">            count++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    System.out.println(count);</div><div class="line">    <span class="keyword">return</span> count;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 包含 Java 的数量</span></div><div class="line">callAll(books, ele -&gt; ((String)ele).contains(<span class="string">"Java"</span>));</div><div class="line"><span class="comment">// 长度大于10的数量</span></div><div class="line">callAll(books, ele -&gt; ((String)ele).length() &gt; <span class="number">10</span>);</div></pre></td></tr></table></figure>
<h3 id="8-2-6-Java8-新增的-Stream-操作集合"><a href="#8-2-6-Java8-新增的-Stream-操作集合" class="headerlink" title="8.2.6 Java8 新增的 Stream 操作集合"></a>8.2.6 Java8 新增的 Stream 操作集合</h3><p>Java 8 还新增了 Stream、IntStream、LongStream、DoubleStream 等流式 API。</p>
<p>Java 8 为每个流式 API 提供了对应的 Builder，用于创建对应的流。</p>
<p>独立使用 Stream 步骤：</p>
<ol>
<li>Stream.builder 创建对应的 Builder</li>
<li>Builder 的 add() 向流中加入元素</li>
<li>Builder 的 build()  获取对应的流</li>
<li>调用 Stream 的聚集方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntStreamTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        IntStream is = IntStream.builder()</div><div class="line">                .add(<span class="number">20</span>)</div><div class="line">                .add(<span class="number">13</span>)</div><div class="line">                .add(-<span class="number">2</span>)</div><div class="line">                .add(<span class="number">18</span>)</div><div class="line">                .build();</div><div class="line">        <span class="comment">// 下面调用聚集方法的代码每次只能执行一行</span></div><div class="line">        <span class="comment">//System.out.println(String.format("最大值：[%s]", is.max().getAsInt()));</span></div><div class="line">        <span class="comment">//System.out.println(String.format("最小值：[%s]", is.min().getAsInt()));</span></div><div class="line">        <span class="comment">//System.out.println(String.format("是否所有元素的平方都大于20：[%s]",</span></div><div class="line">        <span class="comment">//       is.allMatch(ele -&gt; ele * ele &gt; 20)));</span></div><div class="line">        <span class="comment">// 映射成一个新的 stream</span></div><div class="line">        IntStream newIs = is.map(ele -&gt; ele * <span class="number">2</span>);</div><div class="line">        newIs.forEach(System.out::println);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Stream 提供了大量的方法进行聚集操作，既有中间操作也有末端操作。</p>
<ul>
<li>中间方法：允许流保持打开状态，并允许调用后续方法。中间方法的返回值是另外一个流。<ul>
<li>filter(Predicate predicate)</li>
<li>mapToXxx(ToXxxFunction mapper)</li>
<li>peek(Consumer action)</li>
<li>distinct()：有状态方法</li>
<li>sorted()：有状态方法</li>
<li>limit(long maxSize)：有状态、短路方法</li>
</ul>
</li>
<li>末端方法：对流的最终操作，执行后流将会被消耗。<ul>
<li>forEach(Consumerr action)</li>
<li>toArray()</li>
<li><strong>reduce()：通过某种操作来合并流中的元素</strong></li>
<li>min()</li>
<li>max()</li>
<li>count()</li>
<li>anyMatch(Predicate predicate)</li>
<li>allMatch(Predicate predicate)</li>
<li>noneMatch(Predicate predicate)</li>
<li>findFirst()</li>
<li>findAny()</li>
</ul>
</li>
<li>有状态方法：给流增加一些新的属性，比如元素唯一性、元素排序等，往往需要更大的性能开销</li>
<li>短路方法：尽早结束对流的操作，不必检查所有元素</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 包含 Java 的个数</span></div><div class="line">System.out.println(books.stream()</div><div class="line">                   .filter(ele -&gt; ((String)ele).contains(<span class="string">"Java"</span>))</div><div class="line">                   .count());</div><div class="line"><span class="comment">// 长度大于 10 的个数</span></div><div class="line">System.out.println(books.stream()</div><div class="line">                   .filter(ele -&gt; ((String)ele).length() &gt; <span class="number">10</span>)</div><div class="line">                   .count());</div><div class="line">books.stream().mapToInt(ele -&gt; ((String)ele).length())</div><div class="line">    .forEach(System.out::println);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="8-3-Set-集合"><a href="#8-3-Set-集合" class="headerlink" title="8.3 Set 集合"></a>8.3 Set 集合</h2><h3 id="8-3-1-HashSet-类"><a href="#8-3-1-HashSet-类" class="headerlink" title="8.3.1 HashSet 类"></a>8.3.1 HashSet 类</h3><ul>
<li>不保证元素顺序</li>
<li>不同步，多个线程同时修改 HashSet 时，必须通过代码来保证同步</li>
<li>元素可以为 null</li>
<li>equals()、hashCode() 返回值都相等时，判定元素重复</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="comment">// 没有重写 hashCode，导致可以加进去相同对象</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</div><div class="line">    <span class="comment">// 没有重写 equals，导致需要在同一个位置存储多个对象，会采用链式结构，导致性能下降</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSetTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        HashSet books = <span class="keyword">new</span> HashSet();</div><div class="line">        <span class="comment">// 加进去两</span></div><div class="line">        books.add(<span class="keyword">new</span> A());</div><div class="line">        books.add(<span class="keyword">new</span> A());</div><div class="line">        <span class="comment">// 加进去两</span></div><div class="line">        books.add(<span class="keyword">new</span> B());</div><div class="line">        books.add(<span class="keyword">new</span> B());</div><div class="line">        <span class="comment">// 只加进去一个</span></div><div class="line">        books.add(<span class="keyword">new</span> C());</div><div class="line">        books.add(<span class="keyword">new</span> C());</div><div class="line">        System.out.println(books);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从上边例子可以看出：当把一个对象放入 HashSet 中时，如果需要重写该对象对应订单 equals 方法，则也应该重写其 hashCode 方法。规则是，如果 equals 相等，hashCode 也应该相等。</p>
<p>hash 算法的价值在于速度。hash 算法可以直接根据元素的 hashCode 值计算出该元素的存储位置，从而快速定位该元素。数组是所有能存储一组元素里最快的数据结构，直接根据索引计算元素在内存里的存储位置。不用数组的原因是数组元素的索引是连续的，而且数组长度是固定的。所以可以把 hash 结构理解为一种特殊的数组，hashCode 方法的返回值就是索引，并且长度不固定。</p>
<p>重写 hashCode 方法的基本规则：</p>
<ul>
<li>同一个对象多次调用返回值应该相同</li>
<li>两个对象 equals 为 true 时，hashCode 返回值应该相等</li>
<li>对象中用作 equals 比较标准的<strong>实例变量</strong>，都应该用于计算 hashCode 值</li>
</ul>
<p>当向 HashSet 中添加可变对象时，必须十分小心，如果修改 HashSet 集合中的对象，有可能导致该对象与集合中的其他对象相等，从而导致 HashSet 无法准确访问该对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">R</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> count;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">R</span><span class="params">(<span class="keyword">int</span> count)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.count = count;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"R[count:"</span>+count+<span class="string">"]"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span> == obj)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">if</span>(obj != <span class="keyword">null</span> &amp;&amp; obj.getClass() == R.class)&#123;</div><div class="line">            R r = (R)obj;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.count == r.count;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSetTest2</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        HashSet hs = <span class="keyword">new</span> HashSet();</div><div class="line">        hs.add(<span class="keyword">new</span> R(<span class="number">5</span>));</div><div class="line">        hs.add(<span class="keyword">new</span> R(-<span class="number">3</span>));</div><div class="line">        hs.add(<span class="keyword">new</span> R(<span class="number">9</span>));</div><div class="line">        hs.add(<span class="keyword">new</span> R(-<span class="number">2</span>));</div><div class="line">        System.out.println(hs);</div><div class="line">        Iterator it = hs.iterator();</div><div class="line">        R first = (R)it.next();</div><div class="line">        first.count = -<span class="number">3</span>;</div><div class="line">        <span class="comment">// 此时发现集合中有重复元素</span></div><div class="line">        System.out.println(hs);</div><div class="line">        System.out.println(hs.remove(<span class="keyword">new</span> R(-<span class="number">3</span>)));</div><div class="line">        <span class="comment">// 可以看到被删除了一个R元素</span></div><div class="line">        System.out.println(hs);</div><div class="line">        <span class="comment">// false</span></div><div class="line">        System.out.println(<span class="string">"hs 是否包含-3："</span> + hs.contains(<span class="keyword">new</span> R(-<span class="number">3</span>)));</div><div class="line">        <span class="comment">// false</span></div><div class="line">        System.out.println(<span class="string">"hs 是否包含-2："</span> + hs.contains(<span class="keyword">new</span> R(-<span class="number">2</span>)));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>感觉 remove、contains 都出问题了，怎么解决呢？如果不重写 hashCode 方法，Java 是如何计算的？</p>
<h3 id="8-3-2-LinkedHashSet-类"><a href="#8-3-2-LinkedHashSet-类" class="headerlink" title="8.3.2 LinkedHashSet 类"></a>8.3.2 LinkedHashSet 类</h3><p>HashSet 有一个子类 LinkedHashSet，LinkedHashSet 也是根据元素的 hashCode 值来决定元素的存储位置，但它同时使用<strong>链表</strong>维护元素的次序，这样使得元素看起来是以插入的顺序保存的。插入性能变低，迭代访问全部元素时性能更好。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashSetTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        HashSet hs = <span class="keyword">new</span> LinkedHashSet();</div><div class="line">        hs.add(<span class="string">"test"</span>);</div><div class="line">        hs.add(<span class="string">"疯狂 Java 讲义"</span>);</div><div class="line">        System.out.println(hs);</div><div class="line">        hs.remove(<span class="string">"test"</span>);</div><div class="line">        hs.add(<span class="string">"test"</span>);</div><div class="line">        <span class="comment">// false, set 集合不允许重复</span></div><div class="line">        System.out.println(hs.add(<span class="string">"test"</span>));</div><div class="line">        System.out.println(hs);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-3-3-TreeSet-类"><a href="#8-3-3-TreeSet-类" class="headerlink" title="8.3.3 TreeSet 类"></a>8.3.3 TreeSet 类</h3><p>TreeSet 是 SortedSet 接口的实现类。TreeSet 可以确保集合元素处于排序状态。TreeSet 采用<strong>红黑树</strong>的数据结构来存储集合元素。</p>
<ul>
<li>Comparator comparator()：如果采用定制排序，返回定制排序的 Comparator；如果采用自然排序，返回 null</li>
<li>Object first()</li>
<li>Object last()</li>
<li>Object lower(Object e)：返回指定元素之前的元素，参考元素不需要是 TreeSet 中的元素</li>
<li>Object higher(Object e)</li>
<li>SortedSet subSet(Object from, Object to)：返回 Set 子集合，左闭右开</li>
<li>SortedSet headSet(Object to)：小于 to</li>
<li>SortedSet tailSet(Object from)：大于等于 from</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSetTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        TreeSet nums = <span class="keyword">new</span> TreeSet();</div><div class="line">        <span class="comment">// 向 TreeSet 添加四个 Integer 对象</span></div><div class="line">        nums.add(<span class="number">5</span>);</div><div class="line">        nums.add(<span class="number">2</span>);</div><div class="line">        nums.add(<span class="number">10</span>);</div><div class="line">        nums.add(-<span class="number">9</span>);</div><div class="line">        <span class="comment">// 输出是排序的</span></div><div class="line">        System.out.println(nums);</div><div class="line">        System.out.println(nums.first());</div><div class="line">        <span class="comment">// 输出小于5的子集</span></div><div class="line">        System.out.println(nums.headSet(<span class="number">5</span>));</div><div class="line">        <span class="comment">// 输出大于等于5的子集</span></div><div class="line">        System.out.println(nums.tailSet(<span class="number">5</span>));</div><div class="line">        <span class="comment">// 2=&lt; x &lt; 5</span></div><div class="line">        System.out.println(nums.subSet(<span class="number">2</span>, <span class="number">5</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="1-自然排序"><a href="#1-自然排序" class="headerlink" title="1. 自然排序"></a>1. 自然排序</h4><p>TreeSet 会调用集合元素的 compareTo(Object obj) 方法来比较元素之间的大小关系，然后将集合元素按<strong>升序</strong>排列，这就是自然排序。</p>
<p>TreeSet 中的元素必须实现 Comparable 接口，否则会抛出异常。以下常用类已经实现：</p>
<ul>
<li>BigDecimal、BigInteger、所有数值类型的包装类</li>
<li>Character：按字符 UNICODE 值进行比较</li>
<li>Boolean：true &gt; false</li>
<li>String：按字符 UNICODE 值进行比较</li>
<li>Date、Time：后面时间、日期大于前面</li>
</ul>
<p>TreeSet 元素必须实现 Comparable 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Err</span> </span>&#123;&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSetErrorTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        TreeSet ts = <span class="keyword">new</span> TreeSet();</div><div class="line">        <span class="comment">// 添加失败， Err 没有实现 Comparable 接口</span></div><div class="line">        ts.add(<span class="keyword">new</span> Err());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>TreeSet 元素必须是同一个类的实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSetErrorTest2</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        TreeSet ts = <span class="keyword">new</span> TreeSet();</div><div class="line">        ts.add(<span class="keyword">new</span> String(<span class="string">"test"</span>));</div><div class="line">        <span class="comment">// 报错，TreeSet 元素要求为同一个类的实例</span></div><div class="line">        ts.add(<span class="keyword">new</span> Date());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>TreeSet 元素<strong>不和</strong>已经存在的元素相等时才可以成功加入。判断相等的标准是 compareTo 返回 0。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Z</span> <span class="keyword">implements</span> <span class="title">Comparable</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> age;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Z</span><span class="params">(<span class="keyword">int</span> age)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> String.format(<span class="string">"Z[%s]"</span>, age);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSetTest2</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        TreeSet set = <span class="keyword">new</span> TreeSet();</div><div class="line">        Z z1 = <span class="keyword">new</span> Z(<span class="number">6</span>);</div><div class="line">        set.add(z1);</div><div class="line">        <span class="comment">// 再次添加 z1 还是成功，因为 compareTo 没有返回 0</span></div><div class="line">        System.out.println(set.add(z1));</div><div class="line">        System.out.println(set);</div><div class="line">        ((Z)set.first()).age = <span class="number">9</span>;</div><div class="line">        <span class="comment">// 发现两个元素全部变为了 9</span></div><div class="line">        System.out.println(set);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>TODO: 该程序堆内存、栈内存示意图</p>
<p>TreeSet 元素，<strong>compareTo 返回 0，但是 equals 返回 false，添加将失败</strong>。按照 set 集合原则，equals 返回 false 应该可以加进去才对。所以，两个对象 equals 返回 true 时，compareTo 应该返回 0。</p>
<p>TreeSet 元素，添加可变对象，后边修改该可变对象的实例变量后，可能导致大小顺序发生变化，但 TreeSet 不会再次调整他们的顺序。这。。。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">T</span> <span class="keyword">implements</span> <span class="title">Comparable</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> count;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">T</span><span class="params">(<span class="keyword">int</span> count)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.count = count;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"T[count:"</span>+count+<span class="string">"]"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span> == obj)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">if</span>(obj != <span class="keyword">null</span> &amp;&amp; obj.getClass() == T.class)&#123;</div><div class="line">            T r = (T)obj;</div><div class="line">            <span class="keyword">return</span> r.count == <span class="keyword">this</span>.count;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object obj)</span></span>&#123;</div><div class="line">        T r = (T)obj;</div><div class="line">        <span class="keyword">return</span> count &gt; r.count ? <span class="number">1</span> :</div><div class="line">                count &lt; r.count ? -<span class="number">1</span> : <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 1. 修改可变元素后，排序可能变化，但是不会重新调整位置</span></div><div class="line"><span class="comment"> * 2. 实例变量被改变后，元素无法删除；但是没被改变并且没有重复的元素可以正常删除</span></div><div class="line"><span class="comment"> * 3. 为了程序健壮，推荐不要修改放入 HashSet 和 TreeSet 中元素的关键实例变量</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSetTest3</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        TreeSet ts = <span class="keyword">new</span> TreeSet();</div><div class="line">        ts.add(<span class="keyword">new</span> T(<span class="number">5</span>));</div><div class="line">        ts.add(<span class="keyword">new</span> T(-<span class="number">3</span>));</div><div class="line">        ts.add(<span class="keyword">new</span> T(<span class="number">9</span>));</div><div class="line">        ts.add(<span class="keyword">new</span> T(-<span class="number">2</span>));</div><div class="line">        <span class="comment">// 输出是有序的</span></div><div class="line">        System.out.println(ts);</div><div class="line">        <span class="comment">// 取出第一个元素，并重新赋值</span></div><div class="line">        ((T)ts.first()).count = <span class="number">20</span>;</div><div class="line">        <span class="comment">// 取出最后一个员，并重新赋值（值和第二个元素相同）</span></div><div class="line">        ((T)ts.last()).count = -<span class="number">2</span>;</div><div class="line">        <span class="comment">// 输出是无序的，并且有重复元素</span></div><div class="line">        System.out.println(ts);</div><div class="line">        <span class="comment">// 删除实例变量被改变的元素，删除失败</span></div><div class="line">        System.out.println(ts.remove(<span class="keyword">new</span> T(-<span class="number">2</span>)));</div><div class="line">        System.out.println(ts);</div><div class="line">        <span class="comment">// 删除实例变量没有被改变的元素，删除成功</span></div><div class="line">        System.out.println(ts.remove(<span class="keyword">new</span> T(<span class="number">5</span>)));</div><div class="line">        System.out.println(ts);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-定制排序"><a href="#2-定制排序" class="headerlink" title="2. 定制排序"></a>2. 定制排序</h4><p>通过构造器传入 Comparator 实现定制排序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">M</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> age;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">M</span><span class="params">(<span class="keyword">int</span> age)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.age = age;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"M[age:"</span> + age + <span class="string">"]"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 定制排序，构造器给出 Comparator 的实现</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSetTest4</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        TreeSet ts = <span class="keyword">new</span> TreeSet((o1, o2) -&gt; &#123;</div><div class="line">            M m1 = (M)o1;</div><div class="line">            M m2 = (M)o2;</div><div class="line">            <span class="comment">// age 越大， M 对象越小</span></div><div class="line">            <span class="keyword">return</span> m1.age &gt; m2.age ? -<span class="number">1</span></div><div class="line">                    : m1.age &lt; m2.age ? <span class="number">1</span> : <span class="number">0</span>;</div><div class="line">        &#125;);</div><div class="line">        ts.add(<span class="keyword">new</span> M(<span class="number">5</span>));</div><div class="line">        ts.add(<span class="keyword">new</span> M(-<span class="number">3</span>));</div><div class="line">        ts.add(<span class="keyword">new</span> M(<span class="number">9</span>));</div><div class="line">        System.out.println(ts);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-3-4-EnumSet-类"><a href="#8-3-4-EnumSet-类" class="headerlink" title="8.3.4 EnumSet 类"></a>8.3.4 EnumSet 类</h3><p>EnumSet 的元素也是有序的，就是 Enum 中定义的顺序。</p>
<p>EnumSet 内部以位向量的形式存储，这种存储形式非常紧凑、高效，因此占用内存小，效率高。</p>
<p>EnumSet 不允许加入 null 元素。</p>
<p>EnumSet 没有暴露任何构造器，只能通过它的类方法来创新 EnumSet 对象。</p>
<ul>
<li>EnumSet allOf(Class type)</li>
<li>EnumSet complementOf(EnumSet s)：刨除 s</li>
<li>EnumSet copyOf(Collenction c)</li>
<li>EnumSet copyOf(EnumSet s)</li>
<li>EnumSet noneOf(Class type)</li>
<li>EnumSet of(E first, E…rest)</li>
<li>EnumSet range(E from, E to)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> Season &#123;</div><div class="line">    SPRING,SUMMER,FALL,WINNER</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumSetTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        EnumSet es = EnumSet.allOf(Season.class);</div><div class="line">        <span class="comment">// 四个</span></div><div class="line">        System.out.println(es);</div><div class="line">        EnumSet&lt;Season&gt; es2 = EnumSet.noneOf(Season.class);</div><div class="line">        <span class="comment">// 空</span></div><div class="line">        System.out.println(es2);</div><div class="line">        es2.add(Season.WINNER);</div><div class="line">        es2.add(Season.SPRING);</div><div class="line">        <span class="comment">// 输出有序结果</span></div><div class="line">        System.out.println(es2);</div><div class="line">        <span class="comment">// 刨除 es2 后剩下的值</span></div><div class="line">        EnumSet&lt;Season&gt; es3 = EnumSet.complementOf(es2);</div><div class="line">        System.out.println(es3);</div><div class="line"></div><div class="line">        Collection c = <span class="keyword">new</span> HashSet();</div><div class="line">        c.add(Season.FALL);</div><div class="line">        c.add(Season.SPRING);</div><div class="line">        <span class="comment">// 赋值，要求集合中都是同一个枚举中的值</span></div><div class="line">        EnumSet enumSet = EnumSet.copyOf(c);</div><div class="line">        System.out.println(enumSet);</div><div class="line">        c.add(<span class="string">"test"</span>);</div><div class="line">        <span class="comment">// 报错</span></div><div class="line">        <span class="comment">// EnumSet enumSet1 = EnumSet.copyOf(c);</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-3-5-各-Set-实现类性能分析"><a href="#8-3-5-各-Set-实现类性能分析" class="headerlink" title="8.3.5 各 Set 实现类性能分析"></a>8.3.5 各 Set 实现类性能分析</h3><p>HashSet 性能总是比 TreeSet 好，因为 TreeSet 需要额外的红黑树算法来维护元素的次序。只有当需要一个保持排序的 Set 时采用 TreeSet，其他都用 HashSet。</p>
<p>LinkedHashSet：插入、删除比 HashSet 略微慢一点，因为要维护链表，但是遍历更快。</p>
<p>EnumSet 是所有 Set 实现中性能最好的，但是只能保存同一个枚举类的枚举值。</p>
<p>HashSet、TreeSet、EnumSet 都是线程不安全的。如果有多个线程同时访问一个 Set，并且有超过一个线程修改了该 Set，则必须手动保证该 Set 的同步性。</p>
<p><strong>问题：</strong>既然已经有了 LinkedHashSet 并且性能比 TreeSet 好，为啥还要使用 TreeSet？</p>
<h2 id="8-4-List-集合"><a href="#8-4-List-集合" class="headerlink" title="8.4 List 集合"></a>8.4 List 集合</h2><h3 id="8-4-1-Java8-改进的-List-接口和-ListIterator-接口"><a href="#8-4-1-Java8-改进的-List-接口和-ListIterator-接口" class="headerlink" title="8.4.1 Java8 改进的 List 接口和 ListIterator 接口"></a>8.4.1 Java8 改进的 List 接口和 ListIterator 接口</h3><p>除了 Collection 中方法，List 中还有一些根据索引来操作集合的方法：</p>
<ul>
<li>void add(int index, Object element)</li>
<li>boolean addAll(int index, Collection c)</li>
<li>Object get(int index)</li>
<li>int indexOf(Object 0)</li>
<li>Object remove(int index)</li>
<li>Object set(int index, Object element)</li>
<li>List subList(int from, int to)：左闭右开</li>
<li>void replaceAll(UnaryOperator operator)：根据 operator 指定的计算规则重新设置 List 的所有元素</li>
<li>void sort(Comparator c)：重新排序</li>
</ul>
<p>indexOf 方法根据 equals 判断相等；</p>
<p>add/set 只能是有效索引，否则数组越界；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List books = <span class="keyword">new</span> ArrayList();</div><div class="line">        books.add(<span class="keyword">new</span> String(<span class="string">"test1"</span>));</div><div class="line">        books.add(<span class="keyword">new</span> String(<span class="string">"test2"</span>));</div><div class="line">        books.add(<span class="keyword">new</span> String(<span class="string">"test3"</span>));</div><div class="line"></div><div class="line">        <span class="comment">// 将新字符串对象插入到第二个位置</span></div><div class="line">        books.add(<span class="number">1</span>, <span class="string">"new test2"</span>);</div><div class="line">        <span class="comment">// 发现变为4个元素了</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; books.size(); i++) &#123;</div><div class="line">            System.out.println(books.get(i));</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 删除第三个元素</span></div><div class="line">        books.remove(<span class="number">2</span>);</div><div class="line">        System.out.println(books);</div><div class="line">        <span class="comment">// 输出1，表明位于第二位</span></div><div class="line">        <span class="comment">// 虽然是new的对象，但是List是根据 equals 判断相等的</span></div><div class="line">        System.out.println(books.indexOf(<span class="keyword">new</span> String(<span class="string">"new test2"</span>)));</div><div class="line">        <span class="comment">// 将第二个元素替换回来</span></div><div class="line">        books.set(<span class="number">1</span>, <span class="keyword">new</span> String(<span class="string">"test2"</span>));</div><div class="line">        System.out.println(books);</div><div class="line">        <span class="comment">// 0 =&lt; x &lt; 1</span></div><div class="line">        System.out.println(books.subList(<span class="number">0</span>,<span class="number">1</span>));</div><div class="line">        </div><div class="line">        System.out.println(<span class="string">"========="</span>);</div><div class="line">        <span class="comment">// add/set 只能是有效索引，否则数组越界</span></div><div class="line">        <span class="comment">// books.set(10, "aaa");</span></div><div class="line">        <span class="comment">// books.add(10, "aaa");</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>List 根据 equals 判断相等</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListTest2</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List books = <span class="keyword">new</span> ArrayList();</div><div class="line">        books.add(<span class="string">"test1"</span>);</div><div class="line">        books.add(<span class="string">"test2"</span>);</div><div class="line">        books.add(<span class="string">"test3"</span>);</div><div class="line">        System.out.println(books);</div><div class="line">        <span class="comment">// 删除集合中的 A 对象，导致第一个元素被删除</span></div><div class="line">        books.remove(<span class="keyword">new</span> A());</div><div class="line">        <span class="comment">// 再次删除集合中的第一个元素</span></div><div class="line">        books.remove(<span class="keyword">new</span> A());</div><div class="line">        System.out.println(books);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Java 新增的排序和替换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListTest3</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List books = <span class="keyword">new</span> ArrayList();</div><div class="line">        books.add(<span class="string">"1"</span>);</div><div class="line">        books.add(<span class="string">"111"</span>);</div><div class="line">        books.add(<span class="string">"11"</span>);</div><div class="line">        books.add(<span class="string">"11111"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// Comparator</span></div><div class="line">        books.sort((o1,o2) -&gt;((String)o1).length() - ((String)o2).length());</div><div class="line">        System.out.println(books);</div><div class="line">        <span class="comment">// UnaryOperator</span></div><div class="line">        books.replaceAll(ele -&gt; ((String)ele).length());</div><div class="line">        System.out.println(books);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>除了 iteretor() 方法，List 还额外提供了一个 listIterator() 方法，返回 ListIterator</p>
<ul>
<li>boolean hasPrevious()</li>
<li>Object previous()</li>
<li>void add(Object o)：真的加进去了吗？</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListlteratorTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List books = <span class="keyword">new</span> ArrayList();</div><div class="line">        books.add(<span class="string">"test1"</span>);</div><div class="line">        books.add(<span class="string">"test2"</span>);</div><div class="line">        books.add(<span class="string">"test3"</span>);</div><div class="line">        books.add(<span class="string">"test4"</span>);</div><div class="line"></div><div class="line">        ListIterator lit = books.listIterator();</div><div class="line">        <span class="keyword">while</span> (lit.hasNext())&#123;</div><div class="line">            System.out.println(lit.next());</div><div class="line">            <span class="comment">// iterator 只有remove</span></div><div class="line">            lit.add(<span class="string">"---------aaa----------"</span>);</div><div class="line">        &#125;</div><div class="line">        System.out.println(<span class="string">"=============="</span>);</div><div class="line">        <span class="keyword">while</span> (lit.hasPrevious())&#123;</div><div class="line">            System.out.println(lit.previous());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-4-2-ArrayList-和-Vector-实现类"><a href="#8-4-2-ArrayList-和-Vector-实现类" class="headerlink" title="8.4.2 ArrayList 和 Vector 实现类"></a>8.4.2 ArrayList 和 Vector 实现类</h3><p>ArrayList 和 Vector 类都是<strong>基于数组</strong>实现的 List 类，所以 ArrayList 和 Vector 类封装了一个动态的、允许再分配的 Object[] 数组。ArrayList 或 Vector 对象使用 <strong>initialCapacity</strong> 参数来设置该数组的长度， 当向 ArrayList 或 Vector 中添加元素超出了该数组的长度时，它们的 initialCapacity 会自动增加。</p>
<p>如果开始就知道 ArrayList 或 Vector 集合需要保存多少个元素，则可以在创建它们时就指定initialCapacity 大小。如果创建空的 ArrayList 或 Vector 集合时不指定initialCapacity 参数，则 Object[] 数组的长度默认为 10 。</p>
<ul>
<li>void ensureCapacity(int minCapacity)：长度增加到大于等于 minCpacity</li>
<li>void trimToSize()</li>
</ul>
<p>ArrayList 线程不安全；Vector 线程安全，但也不推荐使用。</p>
<h3 id="8-4-3-固定长度的-List"><a href="#8-4-3-固定长度的-List" class="headerlink" title="8.4.3 固定长度的 List"></a>8.4.3 固定长度的 List</h3><p>Arrays.ArrayList 是一个固定长度的 List 集合，程序只能遍历访问该集合里的元素，不可增加、删除该集合里的元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FixedSizeList</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List&lt;String&gt; list = Arrays.asList(<span class="string">"test1"</span>, <span class="string">"test2"</span>);</div><div class="line">        <span class="comment">// 实现类：Arrays$ArrayList</span></div><div class="line">        System.out.println(list.getClass());</div><div class="line">        list.forEach(System.out::println);</div><div class="line">        <span class="comment">// 试图增加、删除都会抛出 UnsupportedOperationException 异常</span></div><div class="line">        list.add(<span class="string">"test3"</span>);</div><div class="line">        list.remove(<span class="string">"test1"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="8-5-Queue-集合"><a href="#8-5-Queue-集合" class="headerlink" title="8.5 Queue 集合"></a>8.5 Queue 集合</h2><p>FIFO 容器。<strong>新元素插入(offer)到队列的尾部，访问元素(poll)返回队列头部的元素</strong>。出头插尾</p>
<ul>
<li>boolean add(Object e)：加入队列尾部</li>
<li>boolean offer(Object e)：加入队列尾部，队列容量有限时，通城比 add 好</li>
<li>Object element()：获取头部元素，不删除。如果队列为空，NoSuchElementException</li>
<li>Object peek()：获取头部元素，不删除。如果队列为空，返回 null</li>
<li>Object poll()：获取头部元素，并删除。如果队列为空，返回null</li>
<li>Object remove()：获取头部元素，并删除。如果队列为空，NoSuchElementException</li>
</ul>
<p>Queue 接口有一个 PriorityQueue 实现类。</p>
<p>Queue 接口有一个 Deque 接口，表示<strong>双端队列</strong>，因此 Deque 既可以当成队列使用也可以当成栈使用。Deque 有 ArrayDeque、LinkedList 两个实现类。</p>
<h3 id="8-5-1-PriorityQueue-实现类"><a href="#8-5-1-PriorityQueue-实现类" class="headerlink" title="8.5.1 PriorityQueue 实现类"></a>8.5.1 PriorityQueue 实现类</h3><p>比较标准的队列实现类，不是绝对标准，因为不是 FIFO，而是<strong>根据大小排序</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PriorityQueueTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        PriorityQueue pq = <span class="keyword">new</span> PriorityQueue();</div><div class="line">        pq.offer(<span class="number">6</span>);</div><div class="line">        pq.offer(-<span class="number">3</span>);</div><div class="line">        pq.offer(<span class="number">20</span>);</div><div class="line">        pq.offer(<span class="number">18</span>);</div><div class="line">        <span class="comment">// PriorityQueue 不可有 null</span></div><div class="line">        <span class="comment">// pq.offer(null);</span></div><div class="line">        <span class="comment">// 输出不是按照加入顺序，而是按照大小</span></div><div class="line">        <span class="comment">// 显示没有准确按照大小是因为 toString 的影响</span></div><div class="line">        System.out.println(pq);</div><div class="line">        <span class="comment">// 获取并删除第一个元素</span></div><div class="line">        System.out.println(pq.poll());</div><div class="line">        System.out.println(pq);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>和 TreeSet 一样， PriorityQueue 的元素有两种排序方式</p>
<ul>
<li>自然排序：元素必须实现了 Comparable 接口，而且是同一个类实例</li>
<li>定制排序：创建 PriorityQueue 时，传入一个 Comparator 对象。定制排序时不要求元素实现 Comparable 接口</li>
</ul>
<h3 id="8-5-2-Deque-接口与-ArrayDeque-实现类"><a href="#8-5-2-Deque-接口与-ArrayDeque-实现类" class="headerlink" title="8.5.2 Deque 接口与 ArrayDeque 实现类"></a>8.5.2 Deque 接口与 ArrayDeque 实现类</h3><ul>
<li>void addFirst(Object o)：插入双端队列开头</li>
<li>void addLast(Object 0)</li>
<li>boolean offerFirst(Object o)</li>
<li>boolean offerLast(Object o)</li>
<li>Iterator descendingIterator()：逆向迭代器</li>
<li>Object getFirst()：获取第一个元素，不删除</li>
<li>Object getLast()：获取最后一个元素，不删除</li>
<li>Object peekFisrt()：获取第一个元素，不删除；如队列为空，返回null</li>
<li>Object peekLast()：获取最后一个元素，不删除；如队列为空，返回null</li>
<li>Object pollFisrt()：获取第一个元素，并删除；如队列为空，返回null</li>
<li>Object pollLast()：获取最后一个元素，并删除；如队列为空，返回null</li>
<li>Object removeFirst()：获取第一个元素，并删除；如队列为空，NoSuchElementException</li>
<li>Object removeLast()：获取最后一个元素，并删除；如队列为空，NoSuchElementException</li>
<li>Object removeFirstOccurrence(Object 0)：获取第一次出现的元素o，并删除</li>
<li>Object removeLastOccurrence(Object 0)：获取最后一次出现的元素o，并删除</li>
<li>Object pop()：栈方法。出栈，相当于 removeFirst()</li>
<li>void  pust(Object o)：栈方法。入栈，相当于 addFirst()</li>
</ul>
<p>ArrayDeque 基于数组实现，创建 Deque 时同样可以指定一个 numElements,用于指定 Object[] 长度，Deque 底层数组长度为 16。</p>
<p>作为栈使用。尽量使用 ArrayDeque，不要使用 Stack，Stack 是古老的集合，性能较差。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayDequeStack</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        ArrayDeque stack = <span class="keyword">new</span> ArrayDeque(<span class="number">10</span>);</div><div class="line">        <span class="comment">// 入栈</span></div><div class="line">        stack.push(<span class="string">"test1"</span>);</div><div class="line">        stack.push(<span class="string">"test2"</span>);</div><div class="line">        stack.push(<span class="string">"test3"</span>);</div><div class="line">        System.out.println(stack);</div><div class="line">        <span class="comment">// 访问第一个元素 test3</span></div><div class="line">        System.out.println(stack.peek());</div><div class="line">        <span class="comment">// 出栈 test3</span></div><div class="line">        System.out.println(stack.pop());</div><div class="line">        System.out.println(stack);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>作为队列使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayDequeQueue</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        ArrayDeque queue = <span class="keyword">new</span> ArrayDeque();</div><div class="line">        <span class="comment">// 入队</span></div><div class="line">        queue.offer(<span class="string">"test1"</span>);</div><div class="line">        queue.offer(<span class="string">"test2"</span>);</div><div class="line">        queue.offer(<span class="string">"test3"</span>);</div><div class="line">        <span class="comment">// test1 test2 test3</span></div><div class="line">        System.out.println(queue);</div><div class="line">        <span class="comment">// 访问第一个元素 test1</span></div><div class="line">        System.out.println(queue.peek());</div><div class="line">        <span class="comment">// 出队 test1</span></div><div class="line">        System.out.println(queue.poll());</div><div class="line">        System.out.println(queue);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-5-3-LinkedList-实现类"><a href="#8-5-3-LinkedList-实现类" class="headerlink" title="8.5.3 LinkedList 实现类"></a>8.5.3 LinkedList 实现类</h3><p>LinkedList 是 List 实现类，所以是一个 List 集合，可以根据索引来随机访问元素。</p>
<p>LinkedList 还实现了 Deque 接口，因此既可以当成队列来使用也可以当成栈来使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedListTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        LinkedList books = <span class="keyword">new</span> LinkedList();</div><div class="line">        <span class="comment">// 加入队列尾部</span></div><div class="line">        books.offer(<span class="string">"test1"</span>);</div><div class="line">        <span class="comment">// 加入栈顶部</span></div><div class="line">        books.push(<span class="string">"test2"</span>);</div><div class="line">        <span class="comment">// 加入队列头部（相当于栈顶部）</span></div><div class="line">        books.offerFirst(<span class="string">"test3"</span>);</div><div class="line">        <span class="comment">// 以 List 方式遍历集合 test3 test2 test1</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; books.size(); i++) &#123;</div><div class="line">            System.out.println(<span class="string">"遍历中："</span> + books.get(i));</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 访问栈顶元素 test3</span></div><div class="line">        System.out.println(books.peekFirst());</div><div class="line">        <span class="comment">// 访问队列最后一个元素 test1</span></div><div class="line">        System.out.println(books.peekLast());</div><div class="line">        <span class="comment">// 出栈 test3</span></div><div class="line">        System.out.println(books.pop());</div><div class="line">        <span class="comment">// test2 test1</span></div><div class="line">        System.out.println(books);</div><div class="line">        <span class="comment">// 删除最后一个 test1</span></div><div class="line">        System.out.println(books.pollLast());</div><div class="line">        <span class="comment">// test2</span></div><div class="line">        System.out.println(books);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ArrayList 、ArrayDeque 内部以<strong>数组</strong>的形式来保存集合中的元素， 因此<strong>随机访问</strong>集合元素时有较好的性能；而 LinkedList 内部以<strong>链表</strong>的形式来保存集合中的元素，因此随机访问集合元素时性能较差，但在<strong>插入、删除</strong>元素时性能比较出色(只需改变指针所指的地址即可)</p>
<h3 id="8-5-4-各种线性表性能分析"><a href="#8-5-4-各种线性表性能分析" class="headerlink" title="8.5.4 各种线性表性能分析"></a>8.5.4 各种线性表性能分析</h3><p>List 就是一个线性表接口，而 ArrayList、LinkedList 又是线性表的两种典型实现：基于数组的线性表和基于链表的线性表。</p>
<p>一般来说，数组以一块连续内存区来保存所有元素，所有数组随机访问性能最好；而链表在执行插入、删除操作时性能较好。总体来说 ArrayList 性能比 LinkedList 好。</p>
<ul>
<li>对于遍历 List 集合：ArrayList、Vector 应该使用随机访问方法（get）；LinkedList 集合，应该采用迭代器（Iterator）来遍历</li>
<li>需要经常执行插入、删除操作来改变包含大量数据的 List，可以考虑使用 LinkedList。使用 ArrayList、Vector 可能需要经常重新分配内部数组大小。</li>
<li>List 集合线程不安全。可以用 Collections 将集合包装成线程安全集合。</li>
</ul>
<h2 id="8-6-Java8-增强的-Map-集合"><a href="#8-6-Java8-增强的-Map-集合" class="headerlink" title="8.6 Java8 增强的 Map 集合"></a>8.6 Java8 增强的 Map 集合</h2><ul>
<li>void clear()</li>
<li>boolean containsKey(Object key)</li>
<li>boolean containsValue(Object value)</li>
<li>Set entrySet()</li>
<li>Set keySet()</li>
<li>Collection values()</li>
<li>Object get(Object key)</li>
<li>boolean isEmpty()</li>
<li>Object put(Object key, Object value)：key 已经存在则覆盖</li>
<li>void putAll(Map m)</li>
<li>Object remove(Object key)</li>
<li>int size()</li>
</ul>
<p>Map.Entry</p>
<ul>
<li>Object getKey()</li>
<li>Object getValue()</li>
<li>Object setValue()</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Map map = <span class="keyword">new</span> HashMap();</div><div class="line">        map.put(<span class="string">"test1"</span>, <span class="number">1</span>);</div><div class="line">        map.put(<span class="string">"test2"</span>, <span class="number">2</span>);</div><div class="line">        map.put(<span class="string">"test3"</span>, <span class="number">3</span>);</div><div class="line">        map.put(<span class="string">"test4"</span>, <span class="number">4</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 插入新值，返回原来的值</span></div><div class="line">        System.out.println(map.put(<span class="string">"test2"</span>, <span class="number">22</span>));</div><div class="line">        System.out.println(map);</div><div class="line">        System.out.println(map.containsKey(<span class="string">"test3"</span>));</div><div class="line">        System.out.println(map.containsValue(<span class="number">22</span>));</div><div class="line">        <span class="comment">// 遍历</span></div><div class="line">        <span class="keyword">for</span>(Object e : map.entrySet())&#123;</div><div class="line">            Map.Entry entry = (Map.Entry)e;</div><div class="line">            System.out.println(entry.getKey() + <span class="string">" == "</span> + entry.getValue());</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 删除 test2</span></div><div class="line">        System.out.println(map.remove(<span class="string">"test2"</span>));</div><div class="line">        System.out.println(map);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-6-1-Java8-为-Map-新增的方法"><a href="#8-6-1-Java8-为-Map-新增的方法" class="headerlink" title="8.6.1 Java8 为 Map 新增的方法"></a>8.6.1 Java8 为 Map 新增的方法</h3><ul>
<li>Object compute(Object key, BiFunction f)：使用 f 算一个新 value。新 value 不为 null，就覆盖；原 value 不为 null，新 value 为 null，删除 key；都为 null，不做操作，返回 null</li>
<li>Object computeIfAbsent(Object key, Function f)：key 不存在或者对应 value 为null，用 f 计算结果插入或替换 </li>
<li>Object computeIfPresent(Object key, Function f)：key 的 value 不为 null，则用 f 计算结果替换或者<strong>删除</strong></li>
<li>void forEach(BiConsumer action)</li>
<li>Object getOrDefault(Object key, V v)</li>
<li>Object merge(Object key, Object value, BiFunction f)：key 不存在或者对应 value 为 null，直接用 value 参数插入或覆盖；否则用 f 计算结果覆盖</li>
<li>Object putIfAbsent(Object key, Object value)：value 为 null，则替换</li>
<li>Object replace(Object key, Object value)：替换 value，如果不存在返回null，不会插入新 key</li>
<li>replaceAll(BiFunction function)：f 执行结果替换 value</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapTest2</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Map map = <span class="keyword">new</span> HashMap();</div><div class="line">        map.put(<span class="string">"test1"</span>, <span class="number">1</span>);</div><div class="line">        map.put(<span class="string">"test2"</span>, <span class="number">2</span>);</div><div class="line">        map.put(<span class="string">"test3"</span>, <span class="number">3</span>);</div><div class="line">        map.put(<span class="string">"test4"</span>, <span class="number">4</span>);</div><div class="line">        <span class="comment">// test5 不存在，不做任何改变</span></div><div class="line">        map.replace(<span class="string">"test5"</span>, <span class="number">5</span>);</div><div class="line">        System.out.println(map);</div><div class="line">        <span class="comment">// merge</span></div><div class="line">        map.merge(<span class="string">"test2"</span>, <span class="number">22</span>,</div><div class="line">                (oldVal, param) -&gt; (Integer)oldVal + (Integer)param);</div><div class="line">        <span class="comment">// 24</span></div><div class="line">        System.out.println(map.get(<span class="string">"test2"</span>));</div><div class="line">        <span class="comment">// computeIfAbsent 5</span></div><div class="line">        map.computeIfAbsent(<span class="string">"test5"</span>,</div><div class="line">                (key) -&gt; ((String)key).length());</div><div class="line">        System.out.println(map.get(<span class="string">"test5"</span>));</div><div class="line">        map.computeIfPresent(<span class="string">"test5"</span>,</div><div class="line">                (key, value) -&gt; (Integer)value * (Integer)value);</div><div class="line">        System.out.println(map);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-6-2-Java8-改进的-HashMap-和-Hashtable-实现类"><a href="#8-6-2-Java8-改进的-HashMap-和-Hashtable-实现类" class="headerlink" title="8.6.2 Java8 改进的 HashMap 和 Hashtable 实现类"></a>8.6.2 Java8 改进的 HashMap 和 Hashtable 实现类</h3><p>区别：</p>
<ul>
<li>HashTable 线程安全，HashMap 线程不安全</li>
<li>HashTable 不允许使用 null 作为 key 和value，HashMap 可以</li>
</ul>
<p>特点：</p>
<ul>
<li>key 对象必须实现 hashCode、equals 方法</li>
<li>所有自定义类作为 key 时，应该保证 hashCode、equals 结果一致</li>
<li>不能保证顺序</li>
<li>判断key相等标准：和 HashSet 一样，key 的 equals、hashCode 都相等</li>
<li>判断value相等标准：value equals 相等</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> count;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">(<span class="keyword">int</span> count)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.count = count;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(o == <span class="keyword">this</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">if</span>(o != <span class="keyword">null</span> &amp;&amp; o.getClass() == A.class)&#123;</div><div class="line">            A a = (A)o;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.count == a.count;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.count;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashTableTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Hashtable ht = <span class="keyword">new</span> Hashtable();</div><div class="line">        ht.put(<span class="keyword">new</span> A(<span class="number">60000</span>), <span class="string">"疯狂 Java 讲义"</span>);</div><div class="line">        ht.put(<span class="keyword">new</span> A(<span class="number">87563</span>), <span class="string">"请量级"</span>);</div><div class="line">        ht.put(<span class="keyword">new</span> A(<span class="number">1232</span>), <span class="keyword">new</span> B());</div><div class="line">        System.out.println(ht);</div><div class="line">        <span class="comment">// value：只要 equals 相等即可 true</span></div><div class="line">        System.out.println(ht.containsValue(<span class="string">"test"</span>));</div><div class="line">        <span class="comment">// key：需要 equals 和 hashCode 都相等 true</span></div><div class="line">        System.out.println(ht.containsKey(<span class="keyword">new</span> A(<span class="number">87563</span>)));</div><div class="line">        <span class="comment">// 删除最后一个entry</span></div><div class="line">        ht.remove(<span class="keyword">new</span> A(<span class="number">1232</span>));</div><div class="line">        System.out.println(ht);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>与 HashSet 类似的是，如果使用可变对象作为 HashMap 、Hashtable 的 key，并且程序修改了作为 key 的可变对象，则也可能出现与 HashSet 类似的情形：程序再也无法准确访问到Map 中被修改过的 key 。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashMapErrorTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        HashMap ht = <span class="keyword">new</span> HashMap();</div><div class="line">        ht.put(<span class="keyword">new</span> A(<span class="number">60000</span>), <span class="string">"test1"</span>);</div><div class="line">        ht.put(<span class="keyword">new</span> A(<span class="number">87563</span>), <span class="string">"test2"</span>);</div><div class="line">        Iterator it = ht.keySet().iterator();</div><div class="line">        <span class="comment">// 取出 Map 中第一个 key，并修改 count</span></div><div class="line">        A first = (A)it.next();</div><div class="line">        first.count = <span class="number">1</span>;</div><div class="line">        System.out.println(ht);</div><div class="line">        <span class="comment">// 只能删除没有被修改过的 key</span></div><div class="line">        ht.remove(<span class="keyword">new</span> A(<span class="number">87563</span>));</div><div class="line">        System.out.println(ht);</div><div class="line">        <span class="comment">// 无法获取被修改过的 key null</span></div><div class="line">        System.out.println(ht.get(<span class="keyword">new</span> A(<span class="number">1</span>)));</div><div class="line">        System.out.println(ht.get(<span class="keyword">new</span> A(<span class="number">60000</span>)));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-6-3-LinkedHashMap-实现类"><a href="#8-6-3-LinkedHashMap-实现类" class="headerlink" title="8.6.3 LinkedHashMap 实现类"></a>8.6.3 LinkedHashMap 实现类</h3><p>HashSet 有一个子类 LinkedHashSet；HashMap 也有一个子类 LinkedHashMap，也是用双向链表来维护顺序。顺序就是添加顺序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashMapTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        LinkedHashMap scores = <span class="keyword">new</span> LinkedHashMap();</div><div class="line">        <span class="comment">// HashMap scores = new HashMap();</span></div><div class="line">        scores.put(<span class="string">"语文"</span>, <span class="number">80</span>);</div><div class="line">        scores.put(<span class="string">"英文"</span>, <span class="number">82</span>);</div><div class="line">        scores.put(<span class="string">"数学"</span>, <span class="number">76</span>);</div><div class="line"></div><div class="line">        scores.forEach((key, value) -&gt; System.out.println(key+<span class="string">"--&gt;"</span>+value));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-6-4-使用-Properties-读写属性文件"><a href="#8-6-4-使用-Properties-读写属性文件" class="headerlink" title="8.6.4 使用 Properties 读写属性文件"></a>8.6.4 使用 Properties 读写属性文件</h3><p>Properties 相当于一个 key、value 都是 String 类型的 Map</p>
<ul>
<li>String getProperty(String key)</li>
<li>String getProperty(String key, String defaultValue)</li>
<li>Object setProperty(String key, String value)</li>
<li>void load(InputStream inStream)</li>
<li>void store(OutputStream out, String comments)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertiesTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        Properties props = <span class="keyword">new</span> Properties();</div><div class="line">        props.setProperty(<span class="string">"username"</span>, <span class="string">"admin"</span>);</div><div class="line">        props.setProperty(<span class="string">"password"</span>, <span class="string">"pass9876"</span>);</div><div class="line">        <span class="comment">// 保存到 a.ini 文件</span></div><div class="line">        props.store(<span class="keyword">new</span> FileOutputStream(<span class="string">"a.ini"</span>), <span class="string">"comment line"</span>);</div><div class="line">		props.storeToXML(<span class="keyword">new</span> FileOutputStream(<span class="string">"a.xml"</span>), <span class="string">"comment line"</span>);</div><div class="line">        </div><div class="line">        Properties props2 = <span class="keyword">new</span> Properties();</div><div class="line">        props2.setProperty(<span class="string">"gender"</span>, <span class="string">"male"</span>);</div><div class="line">        props2.load(<span class="keyword">new</span> FileInputStream(<span class="string">"a.ini"</span>));</div><div class="line">        System.out.println(props2);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-6-5-SortedMap-接口和-TreeMap-实现类"><a href="#8-6-5-SortedMap-接口和-TreeMap-实现类" class="headerlink" title="8.6.5 SortedMap 接口和 TreeMap 实现类"></a>8.6.5 SortedMap 接口和 TreeMap 实现类</h3><p>数据结构、排序方式、判断相等的标准和 TreeSet 一样。</p>
<ul>
<li>Map.Entry firstEntry()</li>
<li>Object firstKey()</li>
<li>Map.Entry lastEntry()</li>
<li>Object lastKey()</li>
<li>Map.Entry higherEntry(Object key)</li>
<li>Object higherKey(Object key)</li>
<li>Map.Entry lowerEntry(Object key)</li>
<li>Object lowerKey(Object key)</li>
<li>NavigableMap subMap(Object from, boolean fromIn, Object to, boolean toIn)</li>
<li>SortedMap subMap(Object from, Object to)：左闭右开</li>
<li>SortedMap tailMap(Object from)：包含 from</li>
<li>NavigableMap tailMap(Object from, boolean fromIn)</li>
<li>SortedMap headMap(Object to)：不包含 to</li>
<li>NavigableMap headMap(Object to, boolean toIn)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">R</span> <span class="keyword">implements</span> <span class="title">Comparable</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> count;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">R</span><span class="params">(<span class="keyword">int</span> count)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.count = count;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"R[count:"</span>+count+<span class="string">"]"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span> == o) <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">if</span>(o != <span class="keyword">null</span> &amp;&amp; o.getClass() == R.class)&#123;</div><div class="line">            R r = (R)o;</div><div class="line">            <span class="keyword">return</span> r.count == <span class="keyword">this</span>.count;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Object o)</span></span>&#123;</div><div class="line">        R r = (R)o;</div><div class="line">        <span class="keyword">return</span> count &gt; r.count ? <span class="number">1</span> : count &lt; r.count ? -<span class="number">1</span> : <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeMapTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        TreeMap tm = <span class="keyword">new</span> TreeMap();</div><div class="line">        tm.put(<span class="keyword">new</span> R(<span class="number">3</span>), <span class="string">"test3"</span>);</div><div class="line">        tm.put(<span class="keyword">new</span> R(-<span class="number">5</span>), <span class="string">"test-5"</span>);</div><div class="line">        tm.put(<span class="keyword">new</span> R(<span class="number">9</span>), <span class="string">"test9"</span>);</div><div class="line">        System.out.println(tm);</div><div class="line">        <span class="comment">// 取出第一个 entry -5</span></div><div class="line">        System.out.println(tm.firstEntry());</div><div class="line">        <span class="comment">// 取出最后一个 key 9</span></div><div class="line">        System.out.println(tm.lastKey());</div><div class="line">        <span class="comment">// 取出大于2的一个 key 3</span></div><div class="line">        System.out.println(tm.higherKey(<span class="keyword">new</span> R(<span class="number">2</span>)));</div><div class="line">        <span class="comment">// 取出小于2的一个 entry -5</span></div><div class="line">        System.out.println(tm.lowerEntry(<span class="keyword">new</span> R(<span class="number">2</span>)));</div><div class="line">        <span class="comment">// -5 =&lt; x &lt; 9 -5 3</span></div><div class="line">        System.out.println(tm.subMap(<span class="keyword">new</span> R(-<span class="number">5</span>), <span class="keyword">new</span> R(<span class="number">9</span>)));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-6-6-WeakHashMap-实现类"><a href="#8-6-6-WeakHashMap-实现类" class="headerlink" title="8.6.6 WeakHashMap 实现类"></a>8.6.6 WeakHashMap 实现类</h3><p>WeakHashMap 只持有对 key 的弱引用，所以 entry 有可能被 GC。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeakHashMapTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        WeakHashMap whm = <span class="keyword">new</span> WeakHashMap();</div><div class="line">        <span class="comment">// key 为 匿名字符串对象（没有其他引用）</span></div><div class="line">        whm.put(<span class="keyword">new</span> String(<span class="string">"语文"</span>), <span class="keyword">new</span> String(<span class="string">"良好"</span>));</div><div class="line">        whm.put(<span class="keyword">new</span> String(<span class="string">"数学"</span>), <span class="keyword">new</span> String(<span class="string">"及格"</span>));</div><div class="line">        whm.put(<span class="keyword">new</span> String(<span class="string">"英文"</span>), <span class="keyword">new</span> String(<span class="string">"中等"</span>));</div><div class="line">        <span class="comment">// key 为系统缓存的字符串对象，系统会自动保持强引用</span></div><div class="line">        whm.put(<span class="string">"java"</span>, <span class="keyword">new</span> String(<span class="string">"中等"</span>));</div><div class="line">        System.out.println(whm);</div><div class="line">        System.gc();</div><div class="line">        System.runFinalization();</div><div class="line">        System.out.println(whm);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-6-7-IdentityHashMap-实现类"><a href="#8-6-7-IdentityHashMap-实现类" class="headerlink" title="8.6.7 IdentityHashMap 实现类"></a>8.6.7 IdentityHashMap 实现类</h3><p>IdentityHashMap 中当且仅当两个 key 严格相等时（key1 == key2）才判定 key 相等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IdentityHashMapTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        IdentityHashMap ihm = <span class="keyword">new</span> IdentityHashMap();</div><div class="line">        ihm.put(<span class="keyword">new</span> String(<span class="string">"语文"</span>), <span class="number">89</span>);</div><div class="line">        ihm.put(<span class="keyword">new</span> String(<span class="string">"语文"</span>), <span class="number">89</span>);</div><div class="line">        ihm.put(<span class="string">"语文"</span>, <span class="number">89</span>);</div><div class="line">        ihm.put(<span class="string">"java"</span>, <span class="number">93</span>);</div><div class="line">        ihm.put(<span class="string">"java"</span>, <span class="number">93</span>);</div><div class="line">        <span class="comment">// 4个</span></div><div class="line">        System.out.println(ihm);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-6-8-EnumMap-实现类"><a href="#8-6-8-EnumMap-实现类" class="headerlink" title="8.6.8 EnumMap 实现类"></a>8.6.8 EnumMap 实现类</h3><ul>
<li>内部以数组形式保存</li>
<li>顺序根据枚举类中的定义</li>
<li>不允许 null 作为 key，但可以作为 value</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> Season&#123;</div><div class="line">    SPRING,SUMMER,FALL,WINTER</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnumTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        EnumMap enumMap = <span class="keyword">new</span> EnumMap(Season.class);</div><div class="line">        enumMap.put(Season.SUMMER, <span class="string">"夏日炎炎"</span>);</div><div class="line">        enumMap.put(Season.SPRING, <span class="string">"春暖花开"</span>);</div><div class="line">        <span class="comment">// 春、夏</span></div><div class="line">        System.out.println(enumMap);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-6-9-各-Map-实现类性能分析"><a href="#8-6-9-各-Map-实现类性能分析" class="headerlink" title="8.6.9 各 Map 实现类性能分析"></a>8.6.9 各 Map 实现类性能分析</h3><p>HashMap、Hashtable 实现机制几乎一样，但 Hashtable 是一个古老并且线程安全的集合，HashMap 效率通常更高。</p>
<p>TreeMap通常比 HashMap、Hashtable 慢，尤其在插入删除时，因为要维护红黑树。</p>
<p>LinkedHashMap 比 HashMap 慢一点，因为要维护链表。</p>
<h2 id="8-7-HashSet-和-HashMap-的性能选项"><a href="#8-7-HashSet-和-HashMap-的性能选项" class="headerlink" title="8.7 HashSet 和 HashMap 的性能选项"></a>8.7 HashSet 和 HashMap 的性能选项</h2><p>发生 hash 冲突时，hash 表中存储元素的示意图。</p>
<p><img src="../../images/java/c8/hash存储示意图.png" alt=""></p>
<p>因此，HashSet、HashMap、HashTable 的 hash 表包含如下属性：</p>
<ul>
<li>容量（capacity）：hash 表中桶的数量</li>
<li>初始化容量（initial capacity）：创建 hash 表时桶的数量</li>
<li>尺寸（size）：当前 hash 表中记录的数量</li>
<li><p>负载因子（load factor）：size/capacity</p>
</li>
<li><p>负载极限：决定 hash 表的最大填满程度，达到该极限时，hash 表自动成倍增加容量，并将原有的对象重新分配，成为 rehashing</p>
</li>
</ul>
<p>负载极限默认 0.75 是时间和空间成本上的一种折中方案。极限大节省空间，极限小查询效率高。</p>
<h2 id="8-8-操作集合工具类：Collections"><a href="#8-8-操作集合工具类：Collections" class="headerlink" title="8.8 操作集合工具类：Collections"></a>8.8 操作集合工具类：Collections</h2><h3 id="8-8-1-排序操作"><a href="#8-8-1-排序操作" class="headerlink" title="8.8.1 排序操作"></a>8.8.1 排序操作</h3><ul>
<li>void reverse(List list)</li>
<li>void shuffle(List list)：随机排序</li>
<li>void sort(List list)：自然顺序升序</li>
<li>void sort(List list, Comparator c)</li>
<li>void swap(List list, int i, int j)</li>
<li>void rotate(List list, int distance)：移动过元素，不改变长度</li>
</ul>
<h3 id="8-8-2-查找、替换操作"><a href="#8-8-2-查找、替换操作" class="headerlink" title="8.8.2 查找、替换操作"></a>8.8.2 查找、替换操作</h3><ul>
<li>int binarySearch(List list, Object key)：二分搜索法获取指定对象的索引。list 必须已经处于有序状态</li>
<li>Object max(Collection coll)</li>
<li>Object max(Collection coll, Comparator comp)</li>
<li>Object min(Collection coll)</li>
<li>Object min(Collection coll, Comparator comp)</li>
<li>void fill(List list, Object obj)：替换所有元素</li>
<li>int frequency(Collection c, Object o)：次数</li>
<li>int indexOfSublist(List source, List target)：目标list出现的索引，没有为 -1</li>
<li>int lastIndexOfSubList(List source, List target)</li>
<li>boolean repalceAll(List list, Object oldVal, Object newVal)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        ArrayList nums = <span class="keyword">new</span> ArrayList();</div><div class="line">        nums.add(<span class="number">2</span>);</div><div class="line">        nums.add(-<span class="number">5</span>);</div><div class="line">        nums.add(<span class="number">3</span>);</div><div class="line">        nums.add(<span class="number">0</span>);</div><div class="line">        <span class="comment">// 2 -5 3 0</span></div><div class="line">        System.out.println(nums);</div><div class="line">        <span class="comment">// 3</span></div><div class="line">        System.out.println(Collections.max(nums));</div><div class="line">        Collections.replaceAll(nums, <span class="number">0</span>, <span class="number">1</span>);</div><div class="line">        <span class="comment">// 2 -5 3 1</span></div><div class="line">        System.out.println(nums);</div><div class="line">        <span class="comment">// 1</span></div><div class="line">        System.out.println(Collections.frequency(nums, -<span class="number">5</span>));</div><div class="line">        Collections.sort(nums);</div><div class="line">        <span class="comment">// -5 1 2 3</span></div><div class="line">        System.out.println(nums);</div><div class="line">        <span class="comment">// 3</span></div><div class="line">        System.out.println(Collections.binarySearch(nums, <span class="number">3</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-8-3-同步操作"><a href="#8-8-3-同步操作" class="headerlink" title="8.8.3 同步操作"></a>8.8.3 同步操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Collection c = Collections.synchronizedCollection(<span class="keyword">new</span> ArrayList());</div><div class="line">        List list = Collections.synchronizedList(<span class="keyword">new</span> ArrayList());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-8-4-设置不可变集合"><a href="#8-8-4-设置不可变集合" class="headerlink" title="8.8.4 设置不可变集合"></a>8.8.4 设置不可变集合</h3><ul>
<li>emptyXxx()：空的、不可变的集合对象，List、Set、SortedSet、Map、SortedMap</li>
<li>singletonXxx()：只包含一个元素的不可变集合对象，List、Map</li>
<li>unmodifiableXxx()：指定集合的不可变试图，List、Set、SortedSet、Map、SortedMap</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnmodifiableTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        List&lt;Object&gt; l = Collections.emptyList();</div><div class="line">        Set&lt;String&gt; s = Collections.singleton(<span class="string">"test1"</span>);</div><div class="line">        HashMap scores = <span class="keyword">new</span> HashMap();</div><div class="line">        scores.put(<span class="string">"语文"</span>, <span class="number">80</span>);</div><div class="line">        scores.put(<span class="string">"java"</span>, <span class="number">82</span>);</div><div class="line">        Map map = Collections.unmodifiableMap(scores);</div><div class="line">        <span class="comment">// 下面都会抛出异常 UnsupportedOperationException</span></div><div class="line">        l.add(<span class="string">"test"</span>);</div><div class="line">        s.add(<span class="string">"test"</span>);</div><div class="line">        map.put(<span class="string">"test"</span>, <span class="number">10</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="8-8-5-Java9-新增的不可变集合"><a href="#8-8-5-Java9-新增的不可变集合" class="headerlink" title="8.8.5 Java9 新增的不可变集合"></a>8.8.5 Java9 新增的不可变集合</h3><p>不可变意味着程序不能向集合中添加元素，也不能从集合中删除元素。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Java9Collection</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="comment">// 创建包含 4 个元素的 set 集合</span></div><div class="line">        Set&lt;String&gt; set = Set.of(<span class="string">"Java"</span>, <span class="string">"Kotlin"</span>, <span class="string">"C"</span>, <span class="string">"C++"</span>);</div><div class="line">        System.out.println(set);</div><div class="line">        <span class="comment">// 报错</span></div><div class="line">        <span class="comment">// set.add("test");</span></div><div class="line"></div><div class="line">        List&lt;Integer&gt; l = List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</div><div class="line">        System.out.println(l);</div><div class="line">        <span class="comment">// l.remove(1);</span></div><div class="line"></div><div class="line">        Map&lt;String, Integer&gt; m = Map.of(<span class="string">"test1"</span>, <span class="number">1</span>, <span class="string">"test2"</span>, <span class="number">2</span>);</div><div class="line">        System.out.println(m);</div><div class="line"></div><div class="line">        Map&lt;String, Integer&gt; m2 = Map.ofEntries(Map.entry(<span class="string">"t1"</span>, <span class="number">1</span>),</div><div class="line">                Map.entry(<span class="string">"t2"</span>, <span class="number">2</span>));</div><div class="line">        System.out.println(m2);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="8-9-繁琐的接口：Enumeration"><a href="#8-9-繁琐的接口：Enumeration" class="headerlink" title="8.9 繁琐的接口：Enumeration"></a>8.9 繁琐的接口：Enumeration</h2><p>古老的迭代器，不推荐使用。</p>
</div><div class="tags"><a href="/tags/疯狂-Java-讲义/">疯狂 Java 讲义</a></div><div class="post-nav"><a class="pre" href="/2020-01-10-疯狂Java讲义/疯狂Java讲义C10.html">第 10 章 异常处理</a><a class="next" href="/2020-01-08-疯狂Java讲义/疯狂Java讲义C9.html">第 9 章 泛型</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Srping-Boot/">Srping Boot</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ZooKeeper/">ZooKeeper</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/加解密技术/">加解密技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/吉他/">吉他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/多线程/">多线程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列/">消息队列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/疯狂-Java-讲义/">疯狂 Java 讲义</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计划/">计划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/tags/计划/" style="font-size: 15px;">计划</a> <a href="/tags/SFTP/" style="font-size: 15px;">SFTP</a> <a href="/tags/PGP/" style="font-size: 15px;">PGP</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Samba/" style="font-size: 15px;">Samba</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/MQTT/" style="font-size: 15px;">MQTT</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/心情/" style="font-size: 15px;">心情</a> <a href="/tags/Eureka/" style="font-size: 15px;">Eureka</a> <a href="/tags/LVS/" style="font-size: 15px;">LVS</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/Srping-Boot/" style="font-size: 15px;">Srping Boot</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/疯狂-Java-讲义/" style="font-size: 15px;">疯狂 Java 讲义</a> <a href="/tags/吉他/" style="font-size: 15px;">吉他</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/ZooKeeper/" style="font-size: 15px;">ZooKeeper</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Observer/" style="font-size: 15px;">Observer</a> <a href="/tags/Singleton/" style="font-size: 15px;">Singleton</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.jamespan.me/" title="小鶸の道场" target="_blank">小鶸の道场</a><ul></ul><a href="https://www.haomwei.com/" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://www.ruanyifeng.com/home.html" title="阮一峰" target="_blank">阮一峰</a><ul></ul><a href="https://www.cnblogs.com/jingmoxukong/" title="静默虚空" target="_blank">静默虚空</a><ul></ul><a href="https://blog.hushhw.cn/" title="hushhw" target="_blank">hushhw</a><ul></ul><a href="https://hasaik.com/" title="hasaik" target="_blank">hasaik</a><ul></ul><a href="https://www.imalan.cn/" title="三无计划" target="_blank">三无计划</a><ul></ul><a href="https://i-meto.com/" title="meto" target="_blank">meto</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">悟空.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>