<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="悟空的技术博客"><title>第 13 章 MySQL 数据库与 JDBC 编程 | 悟空</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">第 13 章 MySQL 数据库与 JDBC 编程</h1><a id="logo" href="/.">悟空</a><p class="description">悟空的技术博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">第 13 章 MySQL 数据库与 JDBC 编程</h1><div class="post-meta">2020-01-13<span> | </span><span class="category"><a href="/categories/%E7%96%AF%E7%8B%82-Java-%E8%AE%B2%E4%B9%89/">疯狂 Java 讲义</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-1-JDBC-%E5%9F%BA%E7%A1%80"><span class="toc-text">13.1 JDBC 基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-1-JDBC-%E7%AE%80%E4%BB%8B"><span class="toc-text">13.1.1 JDBC 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-2-JDBC-%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F"><span class="toc-text">13.1.2 JDBC 驱动程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-2-SQL-%E8%AF%AD%E6%B3%95"><span class="toc-text">13.2 SQL 语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-1-%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">13.2.1 安装数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-2-%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E5%92%8C-MySQL-%E5%9F%BA%E6%9C%AC%E6%8C%87%E4%BB%A4"><span class="toc-text">13.2.2 关系数据库基本概念和 MySQL 基本指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-3-SQL-%E8%AF%AD%E5%8F%A5%E5%9F%BA%E7%A1%80"><span class="toc-text">13.2.3 SQL 语句基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-4-DDL-%E8%AF%AD%E5%8F%A5"><span class="toc-text">13.2.4 DDL 语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-text">修改表结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-text">删除表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#truncate-%E8%A1%A8"><span class="toc-text">truncate 表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-5-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BA%A6%E6%9D%9F"><span class="toc-text">13.2.5 数据库约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-6-%E7%B4%A2%E5%BC%95"><span class="toc-text">13.2.6 索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-7-%E8%A7%86%E5%9B%BE"><span class="toc-text">13.2.7 视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-8-MDL-%E8%AF%AD%E5%8F%A5"><span class="toc-text">13.2.8 MDL 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-9-%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">13.2.9 单表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-10-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%BD%E6%95%B0"><span class="toc-text">13.2.10 数据库函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-11-%E5%88%86%E7%BB%84%E5%92%8C%E7%BB%84%E5%87%BD%E6%95%B0"><span class="toc-text">3.2.11 分组和组函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-2-%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text">13.2.2 多表连接查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL-92-%E7%9A%84%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text">SQL 92 的连接查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL-99-%E7%9A%84%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text">SQL 99 的连接查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-13-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">13.2.13 子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-14-%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-text">13.2.14 集合运算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-union-%E8%BF%90%E7%AE%97"><span class="toc-text">1. union 运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-minus-%E8%BF%90%E7%AE%97"><span class="toc-text">2. minus 运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-intersect-%E8%BF%90%E7%AE%97"><span class="toc-text">3. intersect 运算</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-3-JDBC-%E7%9A%84%E5%85%B8%E5%9E%8B%E7%94%A8%E6%B3%95"><span class="toc-text">13.3 JDBC 的典型用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-3-1-JDBC-4-2-%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3%E5%92%8C%E7%B1%BB%E7%AE%80%E4%BB%8B"><span class="toc-text">13.3.1 JDBC 4.2 常用接口和类简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-3-2-JDBC-%E7%BC%96%E7%A8%8B%E6%AD%A5%E9%AA%A4"><span class="toc-text">13.3.2 JDBC 编程步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-4-%E6%89%A7%E8%A1%8C-SQL-%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-text">13.4 执行 SQL 语句的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-4-1-%E4%BD%BF%E7%94%A8-Java-8-%E6%96%B0%E5%A2%9E%E7%9A%84-executeLargeUpdate-%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C-DDL-%E5%92%8C-DML-%E8%AF%AD%E5%8F%A5"><span class="toc-text">13.4.1 使用 Java 8 新增的 executeLargeUpdate 方法执行 DDL 和 DML 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-4-2-%E4%BD%BF%E7%94%A8-execute-%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-text">13.4.2 使用 execute 方法执行 SQL 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-4-3-%E4%BD%BF%E7%94%A8-PreparedStatement-%E6%89%A7%E8%A1%8C-SQL-%E8%AF%AD%E5%8F%A5"><span class="toc-text">13.4.3 使用 PreparedStatement 执行 SQL 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-4-4-%E4%BD%BF%E7%94%A8-CallableStatement-%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-text">13.4.4 使用 CallableStatement 调用存储过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-5-%E7%AE%A1%E7%90%86%E7%BB%93%E6%9E%9C%E9%9B%86"><span class="toc-text">13.5 管理结果集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-5-1-%E5%8F%AF%E6%BB%9A%E5%8A%A8%E3%80%81%E5%8F%AF%E6%9B%B4%E6%96%B0%E7%9A%84%E7%BB%93%E6%9E%9C%E9%9B%86"><span class="toc-text">13.5.1 可滚动、可更新的结果集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-5-2-%E5%A4%84%E7%90%86-Blob-%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="toc-text">13.5.2 处理 Blob 类型数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-5-3-%E4%BD%BF%E7%94%A8-ResultSetMetaData-%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C%E9%9B%86"><span class="toc-text">13.5.3 使用 ResultSetMetaData 分析结果集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-6-Java-%E7%9A%84-RowSet"><span class="toc-text">13.6 Java 的 RowSet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-6-1-Java-7-%E6%96%B0%E5%A2%9E%E7%9A%84-RowSetFactory-%E4%B8%8E-RowSet"><span class="toc-text">13.6.1 Java 7 新增的 RowSetFactory 与 RowSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-6-2-%E7%A6%BB%E7%BA%BF%E7%9A%84-RowSet"><span class="toc-text">13.6.2 离线的 RowSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-6-3-%E7%A6%BB%E7%BA%BF-RowSet-%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%88%86%E9%A1%B5"><span class="toc-text">13.6.3 离线 RowSet 的查询分页</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-7-%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-text">13.7 事务处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-7-1-%E4%BA%8B%E5%8A%A1%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C-MySQL-%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81"><span class="toc-text">13.7.1 事务的概念和 MySQL 事务支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-7-2-JDBC-%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%94%AF%E6%8C%81"><span class="toc-text">13.7.2 JDBC 的事务支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-7-3-Java-8-%E5%A2%9E%E5%BC%BA%E7%9A%84%E6%89%B9%E9%87%8F%E6%9B%B4%E6%96%B0"><span class="toc-text">13.7.3 Java 8 增强的批量更新</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-8-%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E6%81%AF"><span class="toc-text">13.8 分析数据库信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-8-1-%E4%BD%BF%E7%94%A8-DatabaseMetaData-%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E6%81%AF"><span class="toc-text">13.8.1 使用 DatabaseMetaData 分析数据库信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-8-2-%E4%BD%BF%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%A1%A8%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BF%A1%E6%81%AF"><span class="toc-text">13.8.2 使用系统表分析数据库信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-8-3-%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E5%88%86%E6%9E%90%E6%96%B9%E5%BC%8F"><span class="toc-text">13.8.3 选择合适的分析方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-9-%E4%BD%BF%E7%94%A8%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%AE%A1%E7%90%86%E8%BF%9E%E6%8E%A5"><span class="toc-text">13.9 使用连接池管理连接</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-9-1-DBCP-%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-text">13.9.1 DBCP 数据源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-9-2-C3P0-%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-text">13.9.2 C3P0 数据源</span></a></li></ol></li></ol></div></div><div class="post-content"><p>第 13 章 MySQL 数据库与 JDBC 编程</p>
<a id="more"></a>

<h2 id="13-1-JDBC-基础"><a href="#13-1-JDBC-基础" class="headerlink" title="13.1 JDBC 基础"></a>13.1 JDBC 基础</h2><p>JDBC 为数据库开发提供了标准的 API，所以使用 JDBC 开发的数据库应用可以跨平台运行，而且可以跨数据库（如果全部使用标准的 SQL）。</p>
<h3 id="13-1-1-JDBC-简介"><a href="#13-1-1-JDBC-简介" class="headerlink" title="13.1.1 JDBC 简介"></a>13.1.1 JDBC 简介</h3><p>Java 各种跨平台特性都采用相似的结构，因为他们都需要让相同的程序在不同的平台上运行，所以都需要中间的转换程序（为了实现 Java 程序的跨平台性，Java 为不同的操作系统提供了不同的虚拟机）</p>
<p>同样，为了使 JDBC 程序可以跨平台，则需要不同的数据库厂商提供相应的驱动程序。</p>
<p><img src="../../images/java/c13/JDBC%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F.png"></p>
<h3 id="13-1-2-JDBC-驱动程序"><a href="#13-1-2-JDBC-驱动程序" class="headerlink" title="13.1.2 JDBC 驱动程序"></a>13.1.2 JDBC 驱动程序</h3><p>数据库驱动程序是 JDBC 程序和数据库之间的转换层，它负责将 JDBC 调用映射成特定的数据库调用。</p>
<p>JDBC 驱动通常有如下 4 种类型：</p>
<ul>
<li>JDBC-ODBC 桥：将 JDBC API 映射到 ODBC API。Java 8 已经删除。</li>
<li>JDBC API 映射成数据库特定的客户端 API。驱动包含特定数据库的本地代码</li>
<li>支持三层结构的 JDBC 访问方式，主要用于 Applet 阶段</li>
<li>纯 Java 的，直接与数据库实例交互。是智能的，它知道数据库使用的底层协议。</li>
</ul>
<h2 id="13-2-SQL-语法"><a href="#13-2-SQL-语法" class="headerlink" title="13.2 SQL 语法"></a>13.2 SQL 语法</h2><h3 id="13-2-1-安装数据库"><a href="#13-2-1-安装数据库" class="headerlink" title="13.2.1 安装数据库"></a>13.2.1 安装数据库</h3><ol>
<li>下载：  <a href="https://dev.mysql.com/downloads/windows/installer/8.0.html">https://dev.mysql.com/downloads/windows/installer/8.0.html</a> </li>
<li>安装</li>
</ol>
<h3 id="13-2-2-关系数据库基本概念和-MySQL-基本指令"><a href="#13-2-2-关系数据库基本概念和-MySQL-基本指令" class="headerlink" title="13.2.2 关系数据库基本概念和 MySQL 基本指令"></a>13.2.2 关系数据库基本概念和 MySQL 基本指令</h3><p>DBMS 是所有数据的知识库，它负责管理数据的存储、安全、一致性、并发、恢复和访问等操作。</p>
<p>DBMS 有一个数据字典(有时也被称为系统表) .用于存储它拥有的每个事务的相关信息，例如名字、结构、位置和类型，这种关于数据的数据也被称为元数据（metadata ）。</p>
<p>MySQL 数据库的一个实例（Server Instance）可以同时包含多个数据库，</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 连接到指定实例</span></span><br><span class="line">mysql -h localhost -u root -p <span class="comment">--default-character-set=utf8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看当前实例下包含多少个数据库</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="comment">-- 删除数据库</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="comment">-- 进入指定数据库</span></span><br><span class="line"><span class="keyword">use</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="comment">-- 显示所有数据表</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line"><span class="comment">-- 查看表信息</span></span><br><span class="line">desc tablename;</span><br></pre></td></tr></table></figure>

<p>MySQL 通常支持如下两种存储机制：</p>
<ul>
<li>MyISAM：早期默认的存储机制，对事务的支持不够好</li>
<li>InnoDB：事务安全的存储机制。系统默认启动 InnoDB 存储机制，如果不想用，可以使用 skip-innodb 选项</li>
</ul>
<p>建表时指定存储机制：</p>
<ul>
<li>ENGINE=MyISAM</li>
<li>ENGINE=InnoDB</li>
</ul>
<h3 id="13-2-3-SQL-语句基础"><a href="#13-2-3-SQL-语句基础" class="headerlink" title="13.2.3 SQL 语句基础"></a>13.2.3 SQL 语句基础</h3><p>SQL 语句分类：</p>
<ul>
<li>查询语句</li>
<li>DML（Data Manipulation Language）：insert、update、delete</li>
<li>DDL（Data Definition Language）：create、alter、drop、truncate</li>
<li>DCL（Data Control Language）：grant、revoke</li>
<li>事务控制语句：commit、rollback、savepoint</li>
</ul>
<p>标识符：</p>
<ul>
<li>字母开头</li>
<li><code># _ $</code> 三个特殊符号</li>
<li>不可使用数据库系统关键字、保留字</li>
<li>同一个模式（外模式）下对象不应该同名</li>
</ul>
<h3 id="13-2-4-DDL-语句"><a href="#13-2-4-DDL-语句" class="headerlink" title="13.2.4 DDL 语句"></a>13.2.4 DDL 语句</h3><h4 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span></span><br><span class="line">(</span><br><span class="line">    test_id <span class="built_in">int</span>,</span><br><span class="line">    test_price <span class="built_in">decimal</span>,</span><br><span class="line">    test_name <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">    <span class="comment">-- 大文本类型</span></span><br><span class="line">    test_desc <span class="built_in">text</span>,</span><br><span class="line">    <span class="comment">-- 图片</span></span><br><span class="line">    test_img <span class="built_in">blob</span>,</span><br><span class="line">    test_date datetime</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>MySQL 支持的数据类型：</p>
<table>
<thead>
<tr>
<th>列类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>tinyint/smallint/dediumint/int/bigint</td>
<td>1/2/3/4/8字节整数</td>
</tr>
<tr>
<td>float/double</td>
<td>单精度、双精度浮点类型</td>
</tr>
<tr>
<td>decimal</td>
<td>精确小数类型</td>
</tr>
<tr>
<td>date/time/datetime</td>
<td>日期/时间/日期时间类型</td>
</tr>
<tr>
<td>timestamp</td>
<td>时间戳</td>
</tr>
<tr>
<td>year</td>
<td>年</td>
</tr>
<tr>
<td>char</td>
<td>定长字符串类型</td>
</tr>
<tr>
<td>binary</td>
<td>定长二进制字符串类型</td>
</tr>
<tr>
<td>varbinary</td>
<td>变长</td>
</tr>
<tr>
<td>tinyblob/blob/mediumblob/longblob</td>
<td>1/2/3/4字节的二进制大对象，可用于存储图片、音乐等二进制数据，分别可存储：255B/64KB/16MB/4GB</td>
</tr>
<tr>
<td>tinytext/text/mediumtext/longtext</td>
<td>同时，文本对象</td>
</tr>
<tr>
<td>enum(‘value1’,’value2’,…)</td>
<td>枚举</td>
</tr>
<tr>
<td>set(‘value1’,’value2’,…)</td>
<td>集合</td>
</tr>
</tbody></table>
<p>子查询建表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> hehe</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test_table;</span><br></pre></td></tr></table></figure>

<h4 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h4><p>增加列、修改列、删除列、重命名列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 增加列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> hehe <span class="keyword">add</span>(</span><br><span class="line">	aaa <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">    bbb <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> hehe <span class="keyword">modify</span> aaa <span class="built_in">text</span>, <span class="keyword">modify</span> bbb <span class="built_in">int</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除列</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">drop</span> aaa;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 重命名（MySQL）</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> hehe <span class="keyword">rename</span> <span class="keyword">to</span> wawa;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> wawa <span class="keyword">change</span> bbb ddd <span class="built_in">int</span>;</span><br></pre></td></tr></table></figure>

<h4 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> wawa;</span><br></pre></td></tr></table></figure>

<h4 id="truncate-表"><a href="#truncate-表" class="headerlink" title="truncate 表"></a>truncate 表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> wawa;</span><br></pre></td></tr></table></figure>

<p>truncate 比 delete 性能更好。</p>
<p>对于 MySQL：如果使用非 InnoDB 存储机制，truncate 比 delete 速度要快；如果使用 InnoDB，在 MySQL 5.0.3 之前和 delete 完全一样，在 5.0.3 之后，truncate 效率更高，但如果该表被外键约束所参照，又变得和 delete 一样。</p>
<h3 id="13-2-5-数据库约束"><a href="#13-2-5-数据库约束" class="headerlink" title="13.2.5 数据库约束"></a>13.2.5 数据库约束</h3><ul>
<li>NOT NULL</li>
<li>UNIQUE：不可重复，但可以多个null，因为 null != null</li>
<li>PRIMARY KEY：不可重复并且不可为 null</li>
<li>FOREIGN KEY</li>
<li>CHECK(MySQL 不支持)</li>
</ul>
<p>MySQL 使用 information_schema 数据库里的 TABLE_CONSTRAINTS 表来保存约束信息。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表时指定非空约束</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> hehe(</span><br><span class="line">	hehe_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    hehe_name <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">default</span> <span class="string">&#x27;xyz&#x27;</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    hehe_gender <span class="built_in">varchar</span>(<span class="number">2</span>) <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- alter 增加/取消非空约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> hehe <span class="keyword">modify</span> hehe_gender <span class="built_in">varchar</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> hehe <span class="keyword">modify</span> hehe_name <span class="built_in">varchar</span>(<span class="number">2</span>) <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 唯一约束</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> unique_test(</span><br><span class="line">	test_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">-- 使用列级约束语法建立唯一约束</span></span><br><span class="line">    test_name <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span>,</span><br><span class="line">    test_gender <span class="built_in">varchar</span>(<span class="number">2</span>),</span><br><span class="line">    test_pass <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    <span class="comment">-- 使用表级约束语法建立唯一约束，并指定约束名称</span></span><br><span class="line">    <span class="keyword">constraint</span> test_uk <span class="keyword">unique</span>(test_gender),</span><br><span class="line">    <span class="comment">-- 组合列唯一约束</span></span><br><span class="line">    <span class="keyword">constraint</span> test1_uk <span class="keyword">unique</span>(test_name,test_pass)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- alter 增加/取消唯一约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> unique_test <span class="keyword">add</span> <span class="keyword">unique</span>(test_name,test_pass);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> unique_test <span class="keyword">modify</span> test_name <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> unique_test <span class="keyword">drop</span> <span class="keyword">index</span> test1_uk;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 主键约束</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> primary_test(</span><br><span class="line">	test_id <span class="built_in">int</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    test_name <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> primary_test2(</span><br><span class="line">	test_id <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    test_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    test_pass <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    <span class="comment">-- 虽然指定 test2_pk 名字，但无效</span></span><br><span class="line">    <span class="keyword">constraint</span> test2_pk primary <span class="keyword">key</span>(test_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> primary_test3(</span><br><span class="line">	test_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    test_pass <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    <span class="comment">-- 多列主键</span></span><br><span class="line">    primary <span class="keyword">key</span>(test_name, test_pass)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> primary_test3 <span class="keyword">add</span> primary <span class="keyword">key</span>(test_name, test_pass);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> primary_test3 <span class="keyword">modify</span> test_name <span class="built_in">varchar</span>(<span class="number">255</span>) primary <span class="keyword">key</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> primary_test3 <span class="keyword">drop</span> primary <span class="keyword">key</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 外键约束</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher_table(</span><br><span class="line">	teacher_id <span class="built_in">int</span> auto_increment,</span><br><span class="line">    teacher_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    primary <span class="keyword">key</span>(teacher_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student_table(</span><br><span class="line">	student_id <span class="built_in">int</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    student_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    <span class="comment">-- 列级语法不会生效，仅仅是为了兼容 sql 语法</span></span><br><span class="line">    java_teacher <span class="built_in">int</span> <span class="keyword">references</span> teacher_table(teacher_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher_table1(</span><br><span class="line">	teacher_id <span class="built_in">int</span> auto_increment,</span><br><span class="line">    teacher_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    primary <span class="keyword">key</span>(teacher_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student_table1(</span><br><span class="line">	student_id <span class="built_in">int</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    student_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    java_teacher <span class="built_in">int</span>,</span><br><span class="line">    <span class="keyword">foreign</span> <span class="keyword">key</span>(java_teacher) <span class="keyword">references</span> teacher_table1(teacher_id)</span><br><span class="line">    	<span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">cascade</span> <span class="comment">-- 也可 on delete set null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> teacher_table3(</span><br><span class="line">    teacher_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    teacher_pass <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    primary <span class="keyword">key</span>(teacher_name,teacher_pass)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student_table3(</span><br><span class="line">	student_id <span class="built_in">int</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    student_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    java_teacher_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    java_teacher_pass <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    <span class="keyword">constraint</span> student_teacher_fk <span class="keyword">foreign</span> <span class="keyword">key</span>(java_teacher_name,java_teacher_pass) </span><br><span class="line">    	<span class="keyword">references</span> teacher_table3(teacher_name,teacher_pass)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student_table3 <span class="keyword">drop</span> <span class="keyword">foreign</span> <span class="keyword">key</span> student_teacher_fk;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student_table3 <span class="keyword">add</span> <span class="keyword">foreign</span> <span class="keyword">key</span>(java_teacher_name, java_teacher_pass)</span><br><span class="line">	<span class="keyword">references</span> teacher_table3(teacher_name,teacher_pass);</span><br><span class="line">	</span><br><span class="line"><span class="comment">-- check 约束</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> check_test(</span><br><span class="line">	emp_id <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    emp_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    emp_salary <span class="built_in">decimal</span>,</span><br><span class="line">    <span class="keyword">check</span>(emp_salary&gt;<span class="number">0</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="13-2-6-索引"><a href="#13-2-6-索引" class="headerlink" title="13.2.6 索引"></a>13.2.6 索引</h3><p>创建索引的唯一作用就是加速对表的查询，索引通过使用快速路径访问方法来快速定位数据，从而减少了磁盘的 I/O。</p>
<p>MySQL 使用 information_schema 数据库里的 STATISTICS 表来保存索引。</p>
<p>创建索引的方式：</p>
<ul>
<li>自动：主键约束、唯一约束、外键约束</li>
<li>手动：create index</li>
</ul>
<p>删除索引的方式：</p>
<ul>
<li>自动：数据表被删除</li>
<li>手动：drop index</li>
</ul>
<p>坏处：</p>
<ul>
<li>数据表中记录被添加、删除、修改时需要维护索引</li>
<li>存储索引信息需要一定的磁盘空间</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> emp_last_name_idx <span class="keyword">on</span> employees(first_name,last_name);</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">index</span> emp_last_name_idx <span class="keyword">on</span> exployees;</span><br></pre></td></tr></table></figure>

<h3 id="13-2-7-视图"><a href="#13-2-7-视图" class="headerlink" title="13.2.7 视图"></a>13.2.7 视图</h3><p>一个或多个数据表的逻辑显示，本身不能存储数据。</p>
<ul>
<li>限制对数据的访问</li>
<li>使复杂的查询变简单</li>
<li>提供了数据的独立性</li>
<li>提供了对相同数据的不同显示</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> <span class="keyword">replace</span> <span class="keyword">view</span> view_test <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> teacher_name,teacher_pass <span class="keyword">from</span> teacher_table3</span><br><span class="line"><span class="comment">-- 指定不允许修改该视图的数据</span></span><br><span class="line"><span class="keyword">with</span> <span class="keyword">check</span> <span class="keyword">option</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> view_test;</span><br></pre></td></tr></table></figure>

<h3 id="13-2-8-MDL-语句"><a href="#13-2-8-MDL-语句" class="headerlink" title="13.2.8 MDL 语句"></a>13.2.8 MDL 语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher_table1(teacher_name)<span class="keyword">values</span>(<span class="string">&#x27;xyz&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher_table1 <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table1(student_name) </span><br><span class="line">	<span class="keyword">select</span> teacher_name <span class="keyword">from</span> teacher_table1;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> teacher_table1 <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">&#x27;yk&#x27;</span>),(<span class="literal">null</span>,<span class="string">&#x27;sf&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新</span></span><br><span class="line"><span class="keyword">update</span> teacher_table1 </span><br><span class="line">  <span class="keyword">set</span> teacher_name=<span class="string">&#x27;猪八戒&#x27;</span></span><br><span class="line">  <span class="keyword">where</span> teacher_id &gt; <span class="number">2</span>;</span><br><span class="line">  </span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> teacher_table1 <span class="keyword">where</span> teacher_id &gt; <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h3 id="13-2-9-单表查询"><a href="#13-2-9-单表查询" class="headerlink" title="13.2.9 单表查询"></a>13.2.9 单表查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询名字为两个字符的学生</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table <span class="keyword">where</span> student_name <span class="keyword">like</span> <span class="string">&#x27;__&#x27;</span>;</span><br><span class="line"><span class="comment">-- 查询以下划线开头的学生</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table <span class="keyword">where</span> student_name <span class="keyword">like</span> <span class="string">&#x27;\_%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 相反</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table <span class="keyword">where</span> <span class="keyword">not</span> student_name <span class="keyword">like</span> <span class="string">&#x27;\_%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="13-2-10-数据库函数"><a href="#13-2-10-数据库函数" class="headerlink" title="13.2.10 数据库函数"></a>13.2.10 数据库函数</h3><p>MySQL 单行函数特征：</p>
<ul>
<li>参数可以是变量、常量或数据列。可以多个参数，但只返回一个值。</li>
<li>对每行单独起作用，每行返回一个结果</li>
<li>可以改变参数的数据类型，支持嵌套使用。</li>
</ul>
<p>分类：</p>
<ul>
<li>数值型</li>
<li>字符型</li>
<li>日期时间型</li>
<li>转换函数</li>
<li>其他<ul>
<li>位函数</li>
<li>流程控制函数</li>
<li>加密解密函数</li>
<li>信息函数</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">char_length</span>(teacher_name) <span class="keyword">from</span> teacher_table3;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sin</span>(<span class="keyword">char_length</span>(teacher_name)) <span class="keyword">from</span> teacher_table3;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">date_add</span>(<span class="string">&#x27;1998-01-02&#x27;</span>, <span class="built_in">interval</span> <span class="number">2</span> <span class="keyword">month</span>);</span><br><span class="line"><span class="keyword">select</span> adddate(<span class="string">&#x27;1998-01-02&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">curdate</span>();</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">curtime</span>();</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">md5</span>(<span class="string">&quot;testing&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">ifnull</span>(student_name, <span class="string">&#x27;没有名字&#x27;</span>)<span class="keyword">from</span> student_table3;</span><br><span class="line"><span class="comment">-- 名字为张三则返回 null</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">nullif</span>(student_name, <span class="string">&#x27;张三&#x27;</span>)<span class="keyword">from</span> student_table3;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">if</span>(<span class="keyword">isnull</span>(student_name),<span class="string">&#x27;没有名字&#x27;</span>,<span class="string">&#x27;有名字&#x27;</span>) <span class="keyword">from</span> student_table3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> student_name, <span class="keyword">case</span> java_teacher_name</span><br><span class="line">  <span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;Java老师&#x27;</span></span><br><span class="line">  <span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;Ruby老师&#x27;</span></span><br><span class="line">  <span class="keyword">else</span> <span class="string">&#x27;其他老师&#x27;</span></span><br><span class="line">  <span class="keyword">end</span> teacher</span><br><span class="line">  <span class="keyword">from</span> student_table3;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">select</span> student_name, <span class="keyword">case</span></span><br><span class="line">  <span class="keyword">when</span> student_id&lt;=<span class="number">3</span> <span class="keyword">then</span> <span class="string">&#x27;初级班&#x27;</span></span><br><span class="line">  <span class="keyword">when</span> student_id&lt;=<span class="number">6</span> <span class="keyword">then</span> <span class="string">&#x27;中级班&#x27;</span></span><br><span class="line">  <span class="keyword">else</span> <span class="string">&#x27;高级班&#x27;</span></span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">class</span></span><br><span class="line">  <span class="keyword">from</span> student_table3;</span><br></pre></td></tr></table></figure>

<p>虽然 MySQL 提供了一些函数，但通常不推荐在 Java 程序中使用特定数据库的函数。</p>
<h3 id="3-2-11-分组和组函数"><a href="#3-2-11-分组和组函数" class="headerlink" title="3.2.11 分组和组函数"></a>3.2.11 分组和组函数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> student_table;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">distinct</span> java_teacher) <span class="keyword">from</span> student_table;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(student_id) <span class="keyword">from</span> student_table;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(<span class="number">20</span>) <span class="keyword">from</span> student_table;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(student_id) <span class="keyword">from</span> student_table;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">sum</span>(<span class="keyword">distinct</span> <span class="number">20</span>) <span class="keyword">from</span> student_table;</span><br><span class="line"><span class="comment">-- null 不会计算在内</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(student_name) <span class="keyword">from</span> student_table;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">avg</span>(<span class="keyword">ifnull</span>(java_teacher, <span class="number">0</span>)) <span class="keyword">from</span> student_table;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>having 对组进行过滤，只有满足该条件表达式的分组才会被选出来。</p>
<ul>
<li>不能在 where 子句中过滤组， where  子句仅用于过滤行。过滤组必须使用 having 子句。</li>
<li>不能在 where 子句中使用组函数， having 子句才可使用组函数。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from student_table group by java_teacher </span><br><span class="line">  having count(*)&gt;2;</span><br></pre></td></tr></table></figure>

<h3 id="13-2-2-多表连接查询"><a href="#13-2-2-多表连接查询" class="headerlink" title="13.2.2 多表连接查询"></a>13.2.2 多表连接查询</h3><h4 id="SQL-92-的连接查询"><a href="#SQL-92-的连接查询" class="headerlink" title="SQL 92 的连接查询"></a>SQL 92 的连接查询</h4><ul>
<li>等值连接</li>
<li>非等值连接</li>
<li>外连接(在外连接方加一个万能行，所以另一个表列出所有)</li>
<li>广义笛卡尔积</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.*, teacher_name</span><br><span class="line">  <span class="keyword">from</span> student_table s, teacher_table t</span><br><span class="line">  <span class="keyword">where</span> s.java_teacher = t.teacher_id;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp_table(</span><br><span class="line">  emp_id <span class="built_in">int</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    emp_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    manager_id <span class="built_in">int</span>,</span><br><span class="line">    <span class="keyword">foreign</span> <span class="keyword">key</span>(manager_id) <span class="keyword">references</span> emp_table(emp_id)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp_table <span class="keyword">values</span> (<span class="literal">null</span>, <span class="string">&#x27;唐僧&#x27;</span>,<span class="literal">null</span>),</span><br><span class="line">  (<span class="literal">null</span>, <span class="string">&#x27;孙悟空&#x27;</span>,<span class="number">1</span>),(<span class="literal">null</span>, <span class="string">&#x27;猪八戒&#x27;</span>,<span class="number">1</span>),(<span class="literal">null</span>,<span class="string">&#x27;沙僧&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">select</span> emp.emp_id, emp.emp_name 员工名, mgr.emp_name 经理名 </span><br><span class="line">  <span class="keyword">from</span> emp_table emp, emp_table mgr</span><br><span class="line">  <span class="keyword">where</span> emp.manager_id = mgr.emp_id;</span><br></pre></td></tr></table></figure>

<h4 id="SQL-99-的连接查询"><a href="#SQL-99-的连接查询" class="headerlink" title="SQL 99 的连接查询"></a>SQL 99 的连接查询</h4><ul>
<li><p>交叉连接（cross join）：广义笛卡尔积</p>
</li>
<li><p>自然连接（natural join）：以两个表中的同名列作为连接条件</p>
</li>
<li><p>using 字句连接：指定同名列作为连接条件</p>
</li>
<li><p>on 字句连接</p>
</li>
<li><p>左、右、外全连接（与SQL 92相反，连接方列出所有）</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 右外连接</span></span><br><span class="line"><span class="keyword">select</span> s.*, teacher_name <span class="keyword">from</span> student_table s</span><br><span class="line">  <span class="keyword">right</span> <span class="keyword">join</span> teacher_table t <span class="keyword">on</span> s.java_teacher &lt; t.teacher_id;</span><br><span class="line"><span class="comment">-- 左外连接  </span></span><br><span class="line"><span class="keyword">select</span> s.*, teacher_name <span class="keyword">from</span> student_table s</span><br><span class="line">  <span class="keyword">left</span> <span class="keyword">join</span> teacher_table t <span class="keyword">on</span> s.java_teacher &lt; t.teacher_id;</span><br><span class="line"><span class="comment">-- 全外连接(MySQL 不支持) </span></span><br><span class="line"><span class="keyword">select</span> s.*, teacher_name <span class="keyword">from</span> student_table s</span><br><span class="line">  <span class="keyword">full</span> <span class="keyword">join</span> teacher_table t <span class="keyword">on</span> s.java_teacher &lt; t.teacher_id; </span><br></pre></td></tr></table></figure>

<p><img src="../../images/java/c13/sql99%E5%A4%96%E8%BF%9E%E6%8E%A5.png"></p>
<p><img src="../../images/java/c13/sql99%E5%A4%96%E8%BF%9E%E6%8E%A52.png"></p>
<h3 id="13-2-13-子查询"><a href="#13-2-13-子查询" class="headerlink" title="13.2.13 子查询"></a>13.2.13 子查询</h3><ul>
<li>出现在 from 语句后当成数据表：行内视图</li>
<li>出现在 where 条件之后</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table <span class="keyword">where</span> java_teacher &gt; </span><br><span class="line">  <span class="comment">-- 返回单行、单列，当成标量使用</span></span><br><span class="line">  (<span class="keyword">select</span> teacher_id <span class="keyword">from</span> teacher_table </span><br><span class="line">   <span class="keyword">where</span> teacher_name=<span class="string">&#x27;alvin&#x27;</span>);</span><br><span class="line">   </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table <span class="keyword">where</span> student_id <span class="keyword">in</span> </span><br><span class="line">   <span class="comment">-- 返回多行</span></span><br><span class="line">  (<span class="keyword">select</span> teacher_id <span class="keyword">from</span> teacher_table);</span><br><span class="line">  </span><br><span class="line"><span class="comment">-- any 和 all 可以与 &gt; 、&gt;=、&lt;、&lt;=、。、= 等运算符结合使用</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table <span class="keyword">where</span> student_id &gt;</span><br><span class="line">  <span class="keyword">all</span>(<span class="keyword">select</span> teacher_id <span class="keyword">from</span> teacher_table);</span><br></pre></td></tr></table></figure>

<h3 id="13-2-14-集合运算"><a href="#13-2-14-集合运算" class="headerlink" title="13.2.14 集合运算"></a>13.2.14 集合运算</h3><h4 id="1-union-运算"><a href="#1-union-运算" class="headerlink" title="1. union 运算"></a>1. union 运算</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> teacher_table</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> student_id, student_name <span class="keyword">from</span> student_table;</span><br></pre></td></tr></table></figure>

<h4 id="2-minus-运算"><a href="#2-minus-运算" class="headerlink" title="2. minus 运算"></a>2. minus 运算</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id, student_name <span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">minus</span></span><br><span class="line"><span class="keyword">select</span> teacher_id, teacher_name <span class="keyword">from</span> teacher_table;</span><br></pre></td></tr></table></figure>

<p>不过 MySQL 不支持 minus 运算。可以通过子查询实现。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id, student_name <span class="keyword">from</span> student_table</span><br><span class="line">  <span class="keyword">where</span> (student_id, student_name)</span><br><span class="line">  <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> teacher_id,teacher_name <span class="keyword">from</span> teacher_table);</span><br></pre></td></tr></table></figure>

<h4 id="3-intersect-运算"><a href="#3-intersect-运算" class="headerlink" title="3. intersect 运算"></a>3. intersect 运算</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id, student_name <span class="keyword">from</span> student_table</span><br><span class="line"><span class="keyword">intersect</span></span><br><span class="line"><span class="keyword">select</span> teacher_id, teacher_name <span class="keyword">from</span> teacher_table;</span><br></pre></td></tr></table></figure>

<p>不过 MySQL 不支持。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> student_id, student_name <span class="keyword">from</span> student_table</span><br><span class="line">  <span class="keyword">join</span> teacher_table <span class="keyword">on</span> (student_id=teacher_id <span class="keyword">and</span> </span><br><span class="line">       student_name=teacher_name);</span><br></pre></td></tr></table></figure>

<h2 id="13-3-JDBC-的典型用法"><a href="#13-3-JDBC-的典型用法" class="headerlink" title="13.3 JDBC 的典型用法"></a>13.3 JDBC 的典型用法</h2><h3 id="13-3-1-JDBC-4-2-常用接口和类简介"><a href="#13-3-1-JDBC-4-2-常用接口和类简介" class="headerlink" title="13.3.1 JDBC 4.2 常用接口和类简介"></a>13.3.1 JDBC 4.2 常用接口和类简介</h3><ul>
<li><p>DriverManager：管理 JDBC 驱动的服务类。程序中主要功能是获取 Connection 对象。</p>
</li>
<li><p>Connection：代表一个物理连接会话。</p>
<ul>
<li>Statement createStatement() throws SQLException</li>
<li>PreparedStatement prepareStatement(String sql)</li>
<li>CallableStatement prepareCall(String sql)</li>
<li>Savepoint setSavepoint()</li>
<li>Savepoint setSavepoint(String name)</li>
<li>void setTransactionIsolation(int level)</li>
<li>void rollback()</li>
<li>void rollback(Savepoint savepoint)</li>
<li>void setAutoCommit(boolean atuoCommit)</li>
<li>void commit()</li>
<li>setSchema(String schema)</li>
<li>getSchema()</li>
<li>setNetworkTimeoit(Executor executor, int milliseconds)</li>
<li>getNetworkTimeout()</li>
</ul>
</li>
<li><p>Statement：用于执行 SQL 语句的工具接口</p>
<ul>
<li>ResultSet executeQuery(String sql)：query</li>
<li>int executeUpdate(String sql)：MDL、DDL</li>
<li>boolean execute(String sql)：任何语句</li>
<li>closeOnCompletion()</li>
<li>executeLargeUpdate()</li>
</ul>
</li>
</ul>
<ul>
<li>PreparedStatement：避免数据库每次都需要编译SQL 语句，因此性能更好</li>
</ul>
<ul>
<li><p>void setXxx(int parameterIndex, Xxx value)</p>
</li>
<li><p>ResultSet</p>
<ul>
<li>  void close()：释放</li>
<li>  boolean asolute(int row)：记录指针移动到 row 行</li>
<li>  void boforeFirst()</li>
<li>  boolean first()</li>
<li>  boolean previous()</li>
<li>  boolean next()</li>
<li>  boolean last()</li>
<li>  boid afterLast()</li>
</ul>
</li>
</ul>
<h3 id="13-3-2-JDBC-编程步骤"><a href="#13-3-2-JDBC-编程步骤" class="headerlink" title="13.3.2 JDBC 编程步骤"></a>13.3.2 JDBC 编程步骤</h3><ol>
<li>加载数据库驱动</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>通过 DriverManager 获取数据库连接</p>
</li>
<li><p>通过 Connection 对象创建 Statement 对象</p>
</li>
<li><p>使用 Statement 执行 SQL 语句</p>
</li>
<li><p>操作结果集</p>
</li>
<li><p>回收数据库资源</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnMySql</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="comment">// 1.加载驱动，使用反射知识</span></span><br><span class="line">		Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">		<span class="keyword">try</span>(</span><br><span class="line">			<span class="comment">// 2.使用 DriverManager 获取数据库连接</span></span><br><span class="line">			Connection conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/test?useSSL=false&amp;serverTimezone=Hongkong&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;Pass9876&quot;</span>);</span><br><span class="line">			<span class="comment">// 3.使用 Connection 来创建一个 Statement 对象</span></span><br><span class="line">			Statement stmt = conn.createStatement();</span><br><span class="line">			<span class="comment">// 4.执行 SQL 语句</span></span><br><span class="line">			ResultSet rs = stmt.executeQuery(<span class="string">&quot;select s.*, teacher_name &quot;</span> +</span><br><span class="line">					<span class="string">&quot;from student_table s, teacher_table t&quot;</span></span><br><span class="line">				+ <span class="string">&quot; where t.teacher_id = s.java_teacher&quot;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">while</span> (rs.next())</span><br><span class="line">			&#123;</span><br><span class="line">				System.out.println(rs.getInt(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span></span><br><span class="line">						+ rs.getString(<span class="number">2</span>) + <span class="string">&quot;\t&quot;</span></span><br><span class="line">						+ rs.getString(<span class="number">3</span>) + <span class="string">&quot;\t&quot;</span></span><br><span class="line">						+ rs.getString(<span class="number">4</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="13-4-执行-SQL-语句的方式"><a href="#13-4-执行-SQL-语句的方式" class="headerlink" title="13.4 执行 SQL 语句的方式"></a>13.4 执行 SQL 语句的方式</h2><h3 id="13-4-1-使用-Java-8-新增的-executeLargeUpdate-方法执行-DDL-和-DML-语句"><a href="#13-4-1-使用-Java-8-新增的-executeLargeUpdate-方法执行-DDL-和-DML-语句" class="headerlink" title="13.4.1 使用 Java 8 新增的 executeLargeUpdate 方法执行 DDL 和 DML 语句"></a>13.4.1 使用 Java 8 新增的 executeLargeUpdate 方法执行 DDL 和 DML 语句</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecuteDDL</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String driver;</span><br><span class="line">	<span class="keyword">private</span> String url;</span><br><span class="line">	<span class="keyword">private</span> String user;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">		props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">		driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">		url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">		user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createTable</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Class.forName(driver);</span><br><span class="line">		<span class="keyword">try</span>(</span><br><span class="line">			Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">			Statement stmt = conn.createStatement())</span><br><span class="line">		&#123;</span><br><span class="line">			stmt.executeUpdate(sql);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		ExecuteDDL ed = <span class="keyword">new</span> ExecuteDDL();</span><br><span class="line">		ed.initParam(<span class="string">&quot;./src/unit13_jdbc/mysql.ini&quot;</span>);</span><br><span class="line">		ed.createTable(<span class="string">&quot;create table jdbc_test&quot;</span></span><br><span class="line">				+ <span class="string">&quot;( jdbc_id int auto_increment primary key, &quot;</span></span><br><span class="line">				+ <span class="string">&quot;jdbc_name varchar(255), &quot;</span></span><br><span class="line">				+ <span class="string">&quot;jdbc_desc text);&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;建表成功&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecuteDML</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String driver;</span><br><span class="line">	<span class="keyword">private</span> String url;</span><br><span class="line">	<span class="keyword">private</span> String user;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">		props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">		driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">		url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">		user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertData</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Class.forName(driver);</span><br><span class="line">		<span class="keyword">try</span>(</span><br><span class="line">			Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">			Statement stmt = conn.createStatement())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> stmt.executeUpdate(sql);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		ExecuteDML ed = <span class="keyword">new</span> ExecuteDML();</span><br><span class="line">		ed.initParam(<span class="string">&quot;./src/unit13_jdbc/mysql.ini&quot;</span>);</span><br><span class="line">		<span class="keyword">int</span> result = ed.insertData(<span class="string">&quot;insert into jdbc_test (jdbc_name,jdbc_desc)&quot;</span></span><br><span class="line">				+ <span class="string">&quot;select student_id,student_name from student_table;&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;一共有&quot;</span> + result + <span class="string">&quot;条就受到影响&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-4-2-使用-execute-方法执行-SQL-语句"><a href="#13-4-2-使用-execute-方法执行-SQL-语句" class="headerlink" title="13.4.2 使用 execute 方法执行 SQL 语句"></a>13.4.2 使用 execute 方法执行 SQL 语句</h3><p>如果不清楚 SQL 语句的类型， 则只能使用 execute() 方法来执行该 SQL 语句了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecuteSQL</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String driver;</span><br><span class="line">	<span class="keyword">private</span> String url;</span><br><span class="line">	<span class="keyword">private</span> String user;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">		props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">		driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">		url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">		user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeSql</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Class.forName(driver);</span><br><span class="line">		<span class="keyword">try</span>(</span><br><span class="line">			Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">			Statement stmt = conn.createStatement())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">boolean</span> hasResultSet = stmt.execute(sql);</span><br><span class="line">			<span class="comment">// 如果执行后有 ResultSet 结果集</span></span><br><span class="line">			<span class="keyword">if</span> (hasResultSet)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">try</span>(</span><br><span class="line">					ResultSet rs = stmt.getResultSet())</span><br><span class="line">				&#123;</span><br><span class="line">					ResultSetMetaData rsmd = rs.getMetaData();</span><br><span class="line">					<span class="keyword">int</span> columnCount = rsmd.getColumnCount();</span><br><span class="line">					<span class="keyword">while</span> (rs.next())</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnCount; i++)</span><br><span class="line">						&#123;</span><br><span class="line">							System.out.print(rs.getString(i + <span class="number">1</span>) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">						&#125;</span><br><span class="line">						System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; </span><br><span class="line">			<span class="keyword">else</span> </span><br><span class="line">			&#123;</span><br><span class="line">				System.out.println(<span class="string">&quot;该 SQL 影响的记录条数有：&quot;</span> + stmt.getUpdateCount());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		ExecuteSQL es = <span class="keyword">new</span> ExecuteSQL();</span><br><span class="line">		es.initParam(<span class="string">&quot;./src/unit13_jdbc/mysql.ini&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;------执行删除表的 DDL 语句--------&quot;</span>);</span><br><span class="line">		es.executeSql(<span class="string">&quot;drop table if exists my_test&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;-------执行建表的 DDL 语句--------&quot;</span>);</span><br><span class="line">		es.executeSql(<span class="string">&quot;create table my_test&quot;</span></span><br><span class="line">				+ <span class="string">&quot;(test_id int auto_increment primary key, test_name varchar(255))&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;-------执行插入数据的 DML 语句--------&quot;</span>);</span><br><span class="line">		es.executeSql(<span class="string">&quot;insert into my_test(test_name)&quot;</span></span><br><span class="line">				+ <span class="string">&quot;select student_name from student_table&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;--------执行查询数据的查询语句--------&quot;</span>);</span><br><span class="line">		es.executeSql(<span class="string">&quot;select * from my_test&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-4-3-使用-PreparedStatement-执行-SQL-语句"><a href="#13-4-3-使用-PreparedStatement-执行-SQL-语句" class="headerlink" title="13.4.3 使用 PreparedStatement 执行 SQL 语句"></a>13.4.3 使用 PreparedStatement 执行 SQL 语句</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreparedStatementTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String driver;</span><br><span class="line">	<span class="keyword">private</span> String url;</span><br><span class="line">	<span class="keyword">private</span> String user;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">		props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">		driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">		url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">		user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">		Class.forName(driver);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUseStatement</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">try</span>(</span><br><span class="line">			Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">			Statement stmt = conn.createStatement())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				stmt.executeUpdate(<span class="string">&quot;insert into student_table(student_name,java_teacher) values(&#x27;姓名&quot;</span> + i + <span class="string">&quot;&#x27;,20)&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">&quot;使用 Statement 费时：&quot;</span> + (System.currentTimeMillis() - start));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUserPreparedStatement</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">try</span>(</span><br><span class="line">			Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">			PreparedStatement pstmt = conn.prepareStatement(<span class="string">&quot;insert into student_table(student_name,java_teacher) values(?,1)&quot;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				pstmt.setString(<span class="number">1</span>, <span class="string">&quot;姓名&quot;</span> + i);</span><br><span class="line">				pstmt.executeUpdate();</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">&quot;使用 PreparedStatement 费时：&quot;</span> + (System.currentTimeMillis() - start));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		PreparedStatementTest pt = <span class="keyword">new</span> PreparedStatementTest();</span><br><span class="line">		pt.initParam(<span class="string">&quot;./src/unit13_jdbc/mysql.ini&quot;</span>);</span><br><span class="line">		pt.insertUseStatement();</span><br><span class="line">		pt.insertUserPreparedStatement();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>PreparedStatement 效率更高。</li>
<li>PreparedStatement 无需拼接字符串</li>
<li>PreparedStatement 可以防止 SQL 注入</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFrame</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String PROP_FILE = <span class="string">&quot;./src/unit13_jdbc/mysql.ini&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line">    <span class="keyword">private</span> String pass;</span><br><span class="line">    <span class="comment">// 登录界面的 GUI 组件</span></span><br><span class="line">    <span class="keyword">private</span> JFrame jf = <span class="keyword">new</span> JFrame(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> JTextField userField = <span class="keyword">new</span> JTextField(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">private</span> JTextField passField = <span class="keyword">new</span> JTextField(<span class="number">20</span>);</span><br><span class="line">    <span class="keyword">private</span> JButton loginButton = <span class="keyword">new</span> JButton(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Properties connProp = <span class="keyword">new</span> Properties();</span><br><span class="line">        connProp.load(<span class="keyword">new</span> FileInputStream(PROP_FILE));</span><br><span class="line">        driver = connProp.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">        url = connProp.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        user = connProp.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        pass = connProp.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">        <span class="comment">// 加载驱动</span></span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        <span class="comment">// 为登录按钮添加事件监听器</span></span><br><span class="line">        loginButton.addActionListener(e -&gt; &#123;</span><br><span class="line">            <span class="comment">// 登录成功则显示&quot;登录成功&quot;</span></span><br><span class="line">            <span class="keyword">if</span>(validate(userField.getText(), passField.getText())) &#123;</span><br><span class="line">                JOptionPane.showMessageDialog(jf, <span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                JOptionPane.showMessageDialog(jf, <span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        jf.add(userField, BorderLayout.NORTH);</span><br><span class="line">        jf.add(passField);</span><br><span class="line">        jf.add(loginButton, BorderLayout.SOUTH);</span><br><span class="line">        jf.pack();</span><br><span class="line">        jf.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">validate</span><span class="params">(String userName, String userPass)</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;select * from jdbc_test &quot;</span></span><br><span class="line">                + <span class="string">&quot;where jdbc_name=&#x27;&quot;</span> + userName</span><br><span class="line">                + <span class="string">&quot;&#x27; and jdbc_desc=&#x27;&quot;</span> + userPass + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        System.out.println(sql);</span><br><span class="line">        <span class="keyword">try</span> (Connection conn = DriverManager.getConnection(url,user,pass);</span><br><span class="line">            <span class="keyword">final</span> Statement stmt = conn.createStatement();</span><br><span class="line">            ResultSet rs = stmt.executeQuery(sql)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> LoginFrame().init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 输入 &#x27;or true or&#x27; 时发生 sql 注入</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> jdbc_test <span class="keyword">where</span> jdbc_name=<span class="string">&#x27;&#x27;</span> <span class="keyword">or</span> <span class="literal">true</span> <span class="keyword">or</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> jdbc_desc=<span class="string">&#x27;alvin&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以防止 SQL 注入</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">safeValidate</span><span class="params">(String userName, String userPass)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">         PreparedStatement pstmt = conn.prepareStatement(</span><br><span class="line">             <span class="string">&quot;select * from jdbc_test where jdbc_name=? and jdbc_desc=?&quot;</span>)) &#123;</span><br><span class="line">        pstmt.setString(<span class="number">1</span>, userName);</span><br><span class="line">        pstmt.setString(<span class="number">2</span>, userPass);</span><br><span class="line">        <span class="keyword">try</span> (ResultSet rs = pstmt.executeQuery()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="13-4-4-使用-CallableStatement-调用存储过程"><a href="#13-4-4-使用-CallableStatement-调用存储过程" class="headerlink" title="13.4.4 使用 CallableStatement 调用存储过程"></a>13.4.4 使用 CallableStatement 调用存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> add_pro(a <span class="built_in">int</span>, b <span class="built_in">int</span>, <span class="keyword">out</span> <span class="keyword">sum</span> <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">sum</span> = a + b;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">//</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallableStatementTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String driver;</span><br><span class="line">	<span class="keyword">private</span> String url;</span><br><span class="line">	<span class="keyword">private</span> String user;</span><br><span class="line">	<span class="keyword">private</span> String pass;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">		props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">		driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">		url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">		user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">		Class.forName(driver);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callProcedure</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span>(</span><br><span class="line">			Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">			CallableStatement cstmt = conn.prepareCall(<span class="string">&quot;&#123;call add_pro(?,?,?)&#125;&quot;</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			cstmt.setInt(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">			cstmt.setInt(<span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">			cstmt.registerOutParameter(<span class="number">3</span>, Types.INTEGER);</span><br><span class="line">			cstmt.execute();</span><br><span class="line">			System.out.println(<span class="string">&quot;执行结果是：&quot;</span> + cstmt.getInt(<span class="number">3</span>));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		CallableStatementTest ed = <span class="keyword">new</span> CallableStatementTest();</span><br><span class="line">		ed.initParam(<span class="string">&quot;./src/unit13_jdbc/mysql.ini&quot;</span>);</span><br><span class="line">		ed.callProcedure();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="13-5-管理结果集"><a href="#13-5-管理结果集" class="headerlink" title="13.5 管理结果集"></a>13.5 管理结果集</h2><h3 id="13-5-1-可滚动、可更新的结果集"><a href="#13-5-1-可滚动、可更新的结果集" class="headerlink" title="13.5.1 可滚动、可更新的结果集"></a>13.5.1 可滚动、可更新的结果集</h3><p>Connection 创建 Statement 时：</p>
<ul>
<li>resultSetType<ul>
<li>ResultSet.TYPE_FORWARD_ONLY</li>
<li>ResultSet.TYPE_SCROLL_INSENSITIVE：可滚动，但底层数据的改变不会影响 ResultSet 的内容</li>
<li>ResultSet.TYPE_SCROLL_SENSITIVE：和上面相反</li>
</ul>
</li>
<li>resultSetConcurrency<ul>
<li>ResultSet.CONCUR_READ_ONLY：只读</li>
<li>ResultSet.CONCUR_UPDATABLE：可更新并发模式</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">         PreparedStatement pstmt = conn.prepareStatement(sql,</span><br><span class="line">                                                         ResultSet.TYPE_SCROLL_INSENSITIVE,</span><br><span class="line">                                                         ResultSet.CONCUR_UPDATABLE);</span><br><span class="line">         ResultSet rs = pstmt.executeQuery()) &#123;</span><br><span class="line">        rs.last();</span><br><span class="line">        <span class="keyword">int</span> rowCount = rs.getRow();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = rowCount; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">            rs.absolute(i);</span><br><span class="line">            System.out.println(rs.getString(<span class="number">1</span>)+ <span class="string">&quot;\t&quot;</span> +</span><br><span class="line">                               rs.getString(<span class="number">2</span>) + <span class="string">&quot;\t&quot;</span> +</span><br><span class="line">                               rs.getString(<span class="number">3</span>));</span><br><span class="line">            <span class="comment">// 修改记录指针所指记录，第 2 列的值</span></span><br><span class="line">            rs.updateString(<span class="number">2</span>, <span class="string">&quot;学生名&quot;</span> + i);</span><br><span class="line">            <span class="comment">// 提交修改</span></span><br><span class="line">            rs.updateRow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果要创建可更新的结果集， 则使用查询语句查询的数据通常只能来自于一个数据表，而且查询结果集中的数据列必须包含主键列， 否则将会引起更新失败。</p>
<h3 id="13-5-2-处理-Blob-类型数据"><a href="#13-5-2-处理-Blob-类型数据" class="headerlink" title="13.5.2 处理 Blob 类型数据"></a>13.5.2 处理 Blob 类型数据</h3><p>Bolb(Binary Long Object)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> img_table (</span><br><span class="line">	img_id <span class="built_in">int</span> auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    img_name <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    img_data mediumblob</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查找 img_table 填充 ListModel</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillListModel</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (ResultSet rs = queryAll.executeQuery()) &#123;</span><br><span class="line">        <span class="comment">// 先清除所有元素</span></span><br><span class="line">        imageModel.clear();</span><br><span class="line">        <span class="comment">// 把查询的全部记录添加到 ListMoel 中</span></span><br><span class="line">        <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">            imageModel.addElement(<span class="keyword">new</span> ImageHolder(rs.getInt(<span class="number">1</span>),</span><br><span class="line">                    rs.getString(<span class="number">2</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将指定图片放入数据库</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">upload</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 截取文件名</span></span><br><span class="line">    String imageName = fileName.substring(fileName.lastIndexOf(<span class="string">&quot;\\&quot;</span>) + <span class="number">1</span>,</span><br><span class="line">            fileName.lastIndexOf(<span class="string">&#x27;.&#x27;</span>));</span><br><span class="line">    File f = <span class="keyword">new</span> File(fileName);</span><br><span class="line">    <span class="keyword">try</span> (InputStream is = <span class="keyword">new</span> FileInputStream(f)) &#123;</span><br><span class="line">        <span class="comment">// 设置图片名参数</span></span><br><span class="line">        insert.setString(<span class="number">1</span>, imageName);</span><br><span class="line">        <span class="comment">// 设置二进制流参数</span></span><br><span class="line">        insert.setBinaryStream(<span class="number">2</span>, is, (<span class="keyword">int</span>)f.length());</span><br><span class="line">        <span class="keyword">int</span> affect = insert.executeUpdate();</span><br><span class="line">        <span class="keyword">if</span> (affect == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 重新更新 ListModel， 将会让 JList 显示最新的图片列表</span></span><br><span class="line">            fillListModel();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 根据图片 ID 来显示图片</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showImage</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="comment">// 设置参数</span></span><br><span class="line">    query.setInt(<span class="number">1</span>, id);</span><br><span class="line">    <span class="keyword">try</span> (ResultSet rs = query.executeQuery()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">            <span class="comment">// 取出 Blob 列</span></span><br><span class="line">            Blob imgBlob = rs.getBlob(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">// 取出 Blob 列里的数据</span></span><br><span class="line">            ImageIcon icon = <span class="keyword">new</span> ImageIcon(imgBlob.getBytes(<span class="number">1L</span>,</span><br><span class="line">                    (<span class="keyword">int</span>)imgBlob.length()));</span><br><span class="line">            imageLabel.setIcon(icon);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-5-3-使用-ResultSetMetaData-分析结果集"><a href="#13-5-3-使用-ResultSetMetaData-分析结果集" class="headerlink" title="13.5.3 使用 ResultSetMetaData 分析结果集"></a>13.5.3 使用 ResultSetMetaData 分析结果集</h3><p>ResultSetMetaData  ResultSet.getMetaData()</p>
<ul>
<li>int getColumnCount()</li>
<li>String getColumnName(int column)</li>
<li>int getColumnType(int column)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义监听器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExceListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent evt)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 删除原来的 JTable（JTable 适用 scrollPane 来包装）</span></span><br><span class="line">        <span class="keyword">if</span> (scrollPane != <span class="keyword">null</span>) &#123;</span><br><span class="line">            jf.remove(scrollPane);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> (ResultSet rs = stmt.executeQuery(sqlField.getText())) &#123;</span><br><span class="line">            <span class="comment">// 取出 ResultSet 的 MetaData</span></span><br><span class="line">            ResultSetMetaData rsmd = rs.getMetaData();</span><br><span class="line">            Vector&lt;String&gt; columnNames = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">            Vector&lt;Vector&lt;String&gt;&gt; data = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">            <span class="comment">// 把 ResultSet 的所有列名添加到 Vector 里</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; rsmd.getColumnCount(); i++) &#123;</span><br><span class="line">                columnNames.add(rsmd.getColumnName(i + <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 把 ResultSet 的所有记录添加到 Vector 里</span></span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                Vector&lt;String&gt; v = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rsmd.getColumnCount(); i++) &#123;</span><br><span class="line">                    v.add(rs.getString(i + <span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                data.add(v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 创建新的 JTable</span></span><br><span class="line">            JTable table = <span class="keyword">new</span> JTable(data, columnNames);</span><br><span class="line">            scrollPane = <span class="keyword">new</span> JScrollPane(table);</span><br><span class="line">            <span class="comment">// 添加新的 Table</span></span><br><span class="line">            jf.add(scrollPane);</span><br><span class="line">            <span class="comment">// 更新主窗口</span></span><br><span class="line">            jf.validate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="13-6-Java-的-RowSet"><a href="#13-6-Java-的-RowSet" class="headerlink" title="13.6 Java 的 RowSet"></a>13.6 Java 的 RowSet</h2><p>RowSet 接口继承了 ResultSet 接口。RowSet 接口下包含 JdbcRowSet、CachedRowSet、FilteredRowSet、JoinRowSet 和 WebRowSet 常用子接口。除了 JdbcRowSet，其余 4 个都是离线的 RowSet。</p>
<p>与 ResultSet 相比， RowSet 默认是可滚动、可更新、可序列化的结果集，而且作为JavaBean 使用，因此能方便地在网络上传输，用于同步两端的数据。</p>
<p><img src="../../images/java/c13/RowSet.png"></p>
<h3 id="13-6-1-Java-7-新增的-RowSetFactory-与-RowSet"><a href="#13-6-1-Java-7-新增的-RowSetFactory-与-RowSet" class="headerlink" title="13.6.1 Java 7 新增的 RowSetFactory 与 RowSet"></a>13.6.1 Java 7 新增的 RowSetFactory 与 RowSet</h3><p>RowSetProvider 创建 RowSetFactory。</p>
<ul>
<li>CacheRowSet createCachedRowSet()</li>
<li>FilteredRowSet createFilteredRowSet()</li>
<li>JdbcRowSet createJdbcRowSet()</li>
<li>JoinRowSet createJoinRowSet()</li>
<li>WebRowSet createWebRowSet()</li>
</ul>
<p>RowSet</p>
<ul>
<li>setUrl(String url)</li>
<li>setUsername(String name)</li>
<li>setPassword(String password)</li>
<li>setCommand(String sql)</li>
<li>execute()</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RowSetFactory factory = RowSetProvider.newFactory();</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        <span class="comment">// 获取 JdbcRowSet</span></span><br><span class="line">        JdbcRowSet jdbcRs = factory.createJdbcRowSet()</span><br><span class="line">    )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 设置必要的连接信息</span></span><br><span class="line">        jdbcRs.setUrl(url);</span><br><span class="line">        jdbcRs.setUsername(user);</span><br><span class="line">        jdbcRs.setPassword(pass);</span><br><span class="line">        <span class="comment">// 设置 SQL 查询语句</span></span><br><span class="line">        jdbcRs.setCommand(sql);</span><br><span class="line">        <span class="comment">// 执行查询</span></span><br><span class="line">        jdbcRs.execute();</span><br><span class="line">        jdbcRs.afterLast();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 向前滚动结果集</span></span><br><span class="line">        <span class="keyword">while</span> (jdbcRs.previous())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (jdbcRs.getInt(<span class="string">&quot;student_id&quot;</span>) == <span class="number">3</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 修改指定记录行（Java 12 失败）</span></span><br><span class="line">                jdbcRs.updateString(<span class="string">&quot;student_name&quot;</span>, <span class="string">&quot;孙悟空&quot;</span>);</span><br><span class="line">                jdbcRs.updateRow();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(jdbcRs.getString(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span> + jdbcRs.getString(<span class="number">2</span>) + <span class="string">&quot;\t&quot;</span> + jdbcRs.getString(<span class="number">3</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-6-2-离线的-RowSet"><a href="#13-6-2-离线的-RowSet" class="headerlink" title="13.6.2 离线的 RowSet"></a>13.6.2 离线的 RowSet</h3><p>离线 RowSet 对象则完全可以当成 Java Bean 来使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CachedRowSetTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String user;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String pass;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">		props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">		driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">		url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">		user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">		Class.forName(driver);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> CachedRowSet <span class="title">query</span><span class="params">(String sql)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">		Statement stmt = conn.createStatement();</span><br><span class="line">		ResultSet rs = stmt.executeQuery(sql);</span><br><span class="line">		RowSetFactory factory = RowSetProvider.newFactory();</span><br><span class="line">		CachedRowSet cachedRs = factory.createCachedRowSet();</span><br><span class="line">		<span class="comment">// 使用 ResultSet 填装 RowSet</span></span><br><span class="line">		cachedRs.populate(rs);</span><br><span class="line">		<span class="comment">// 关闭资源</span></span><br><span class="line">		rs.close();</span><br><span class="line">		stmt.close();</span><br><span class="line">		conn.close();</span><br><span class="line">		<span class="keyword">return</span> cachedRs;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		CachedRowSetTest ct = <span class="keyword">new</span> CachedRowSetTest();</span><br><span class="line">		ct.initParam(<span class="string">&quot;./src/unit13_jdbc/mysql.ini&quot;</span>);</span><br><span class="line">		CachedRowSet rs = ct.query(<span class="string">&quot;select * from student_table&quot;</span>);</span><br><span class="line">		rs.afterLast();</span><br><span class="line">		<span class="keyword">while</span> (rs.previous())</span><br><span class="line">		&#123;</span><br><span class="line">			System.out.println(rs.getString(<span class="number">1</span>) + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">2</span>) + <span class="string">&quot;\t&quot;</span> + rs.getString(<span class="number">3</span>));</span><br><span class="line">			<span class="keyword">if</span> (rs.getInt(<span class="string">&quot;student_id&quot;</span>) == <span class="number">2</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				rs.updateString(<span class="string">&quot;student_name&quot;</span>, <span class="string">&quot;孙悟空&quot;</span>);</span><br><span class="line">				rs.updateRow();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 重新获取数据库连接</span></span><br><span class="line">		Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">		conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">		<span class="comment">// 把对 RowSet 所做的修改同步到底层数据库</span></span><br><span class="line">		rs.acceptChanges(conn);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-6-3-离线-RowSet-的查询分页"><a href="#13-6-3-离线-RowSet-的查询分页" class="headerlink" title="13.6.3 离线 RowSet 的查询分页"></a>13.6.3 离线 RowSet 的查询分页</h3><p>由于 CachedRowSet 会将数据记录直接装载到内存中，因此如果 SQL 查询返回的记录过大，CachedRowSet 将会占用大量的内存，在某些极端的情况下，它甚至会直接导致内存溢出。</p>
<ul>
<li>populate(ResultSet rs, int startRow)</li>
<li>setPageSize(int pageSize)</li>
<li>previousPage()：在底层 ResultSet 可用的情况下，读取上一页记录</li>
<li>nextPage()</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> CachedRowSet <span class="title">query</span><span class="params">(String sql, <span class="keyword">int</span> pageSize, <span class="keyword">int</span> page)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, pass);</span><br><span class="line">        Statement stmt = conn.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);</span><br><span class="line">        ResultSet rs = stmt.executeQuery(sql))</span><br><span class="line">    &#123;</span><br><span class="line">        RowSetFactory factory = RowSetProvider.newFactory();</span><br><span class="line">        CachedRowSet cachedRs = factory.createCachedRowSet();</span><br><span class="line">        <span class="comment">// 设置煤业显示 pagesize 条记录</span></span><br><span class="line">        cachedRs.setPageSize(pageSize);</span><br><span class="line">        <span class="comment">// 从指定位置开始装</span></span><br><span class="line">        cachedRs.populate(rs, (page - <span class="number">1</span>) * pageSize + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//			cachedRs.populate(rs);</span></span><br><span class="line"></span><br><span class="line">        cachedRs.nextPage();</span><br><span class="line">        <span class="comment">// 也不行</span></span><br><span class="line">        <span class="comment">// cachedRs.previousPage();</span></span><br><span class="line">        <span class="keyword">return</span> cachedRs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="13-7-事务处理"><a href="#13-7-事务处理" class="headerlink" title="13.7 事务处理"></a>13.7 事务处理</h2><h3 id="13-7-1-事务的概念和-MySQL-事务支持"><a href="#13-7-1-事务的概念和-MySQL-事务支持" class="headerlink" title="13.7.1 事务的概念和 MySQL 事务支持"></a>13.7.1 事务的概念和 MySQL 事务支持</h3><p>事务是由一步或几步数据库操作序列组成的逻辑执行单元，这系列操作要么全部执行，要么全部放弃执行。</p>
<ul>
<li>原子性（Atomicity）：事务是应用中最小的执行单位</li>
<li>一致性（Consistency）：事务执行的结果， 必须使数据库从一个一致性状态， 变到另一个一致性状态。一致性通过原子性来保证。例如 A 向 B 转账。</li>
<li>隔离性（Isolation）：各个事务的执行互不干扰</li>
<li>持续性（Durability）：持久性，事务一旦提交，改变是永久性的。</li>
</ul>
<p>事务组成：</p>
<ul>
<li>一组 DML 语句</li>
<li>一条 DDL 语句</li>
<li>一条 DCL 语句</li>
</ul>
<p>DDL 和 DDL 语句最多只能一条，因为 DDL 和 DCL 语句都会导致事务立即提交。</p>
<p>事务提交：</p>
<ul>
<li>显示提交：commit</li>
<li>自动提交：执行 DDL 或 DCL 语句，或程序正常退出</li>
</ul>
<p>事务回滚：</p>
<ul>
<li>显示回滚：rollback</li>
<li>自动回滚：系统错误或者强行退出</li>
</ul>
<p>MySQL 默认关闭事务（即打开自动提交）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 关闭自动提交，即开启事务</span></span><br><span class="line"><span class="keyword">SET</span> AUTOCOMMIT = <span class="number">0</span></span><br><span class="line"><span class="comment">-- 临时开始事务</span></span><br><span class="line"><span class="keyword">begin</span>/<span class="keyword">start</span> transactin</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">&#x27;xx&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">&#x27;yy&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">&#x27;zz&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table s <span class="keyword">where</span> s.student_name <span class="keyword">in</span> (<span class="string">&#x27;xx&#x27;</span>,<span class="string">&#x27;yy&#x27;</span>,<span class="string">&#x27;zz&#x27;</span>);</span><br><span class="line"><span class="comment">-- 回滚</span></span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table s <span class="keyword">where</span> s.student_name <span class="keyword">in</span> (<span class="string">&#x27;xx&#x27;</span>,<span class="string">&#x27;yy&#x27;</span>,<span class="string">&#x27;zz&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">&#x27;xx&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">savepoint</span> a;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> student_table <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">&#x27;yy&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table s <span class="keyword">where</span> s.student_name <span class="keyword">in</span> (<span class="string">&#x27;xx&#x27;</span>,<span class="string">&#x27;yy&#x27;</span>);</span><br><span class="line"><span class="comment">-- rollback\commit 会结束事务，但 rollback to a 不会</span></span><br><span class="line"><span class="keyword">rollback</span> <span class="keyword">to</span> a;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student_table s <span class="keyword">where</span> s.student_name <span class="keyword">in</span> (xx<span class="string">&#x27;,&#x27;</span>yy<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">commit;</span></span><br></pre></td></tr></table></figure>

<h3 id="13-7-2-JDBC-的事务支持"><a href="#13-7-2-JDBC-的事务支持" class="headerlink" title="13.7.2 JDBC 的事务支持"></a>13.7.2 JDBC 的事务支持</h3><p>实际上，当Connection 遇到一个未处理的SQLException 异常时，系统将会非正常退出， 事务也会自动回滚。但如果程序捕获了该异常，则需要在异常处理块中显式地回滚事务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String user;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String pass;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">		props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">		driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">		url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">		user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">		Class.forName(driver);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertInTransaction</span><span class="params">(String[] sqls)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span>(</span><br><span class="line">			Connection conn = DriverManager.getConnection(url, user, pass))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 关闭自动提交，开启事务</span></span><br><span class="line">			conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">			<span class="keyword">try</span>(</span><br><span class="line">				Statement stmt = conn.createStatement())</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (String sql : sqls)</span><br><span class="line">				&#123;</span><br><span class="line">					stmt.executeUpdate(sql);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			conn.commit();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		TransactionTest tt = <span class="keyword">new</span> TransactionTest();</span><br><span class="line">		tt.initParam(<span class="string">&quot;./src/unit13_jdbc/mysql.ini&quot;</span>);</span><br><span class="line">		String[] sqls = <span class="keyword">new</span> String[]&#123;</span><br><span class="line">				<span class="string">&quot;insert into student_table(student_name,java_teacher) values(&#x27;aaa&#x27;,1)&quot;</span>,</span><br><span class="line">				<span class="string">&quot;insert into student_table(student_name,java_teacher) values(&#x27;bbb&#x27;,1)&quot;</span>,</span><br><span class="line">				<span class="comment">// 违反外键约束</span></span><br><span class="line">				<span class="string">&quot;insert into student_table(student_name,java_teacher) values(&#x27;ccc&#x27;,5)&quot;</span></span><br><span class="line">		&#125;;</span><br><span class="line">		tt.insertInTransaction(sqls);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Savepoint setSavepoint()</li>
<li>Savepoint setSavepoint(String name)</li>
<li>rollback(Savepoint savepoint)</li>
</ul>
<h3 id="13-7-3-Java-8-增强的批量更新"><a href="#13-7-3-Java-8-增强的批量更新" class="headerlink" title="13.7.3 Java 8 增强的批量更新"></a>13.7.3 Java 8 增强的批量更新</h3><p>验证底层数据库是否支持批量更新：DatabaseMetaData.supportsBatchUpdates()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertBatch</span><span class="params">(String[] sqls)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> (Connection conn = DriverManager.getConnection(url, user, pass)) &#123;</span><br><span class="line">        <span class="comment">// 保存当前的模式</span></span><br><span class="line">        <span class="keyword">boolean</span> autoCommit = conn.getAutoCommit();</span><br><span class="line">        <span class="comment">// 关闭自动提交,开启事务</span></span><br><span class="line">        conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">try</span> (Statement stmt = conn.createStatement()) &#123;</span><br><span class="line">            <span class="comment">// 循环插入 sql</span></span><br><span class="line">            <span class="keyword">for</span> (String sql : sqls) &#123;</span><br><span class="line">                stmt.addBatch(sql);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 同时提交所有的 SQL</span></span><br><span class="line">            stmt.executeLargeBatch();</span><br><span class="line">            conn.commit();</span><br><span class="line">            <span class="comment">// 恢复原来的提交模式</span></span><br><span class="line">            conn.setAutoCommit(autoCommit);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="13-8-分析数据库信息"><a href="#13-8-分析数据库信息" class="headerlink" title="13.8 分析数据库信息"></a>13.8 分析数据库信息</h2><h3 id="13-8-1-使用-DatabaseMetaData-分析数据库信息"><a href="#13-8-1-使用-DatabaseMetaData-分析数据库信息" class="headerlink" title="13.8.1 使用 DatabaseMetaData 分析数据库信息"></a>13.8.1 使用 DatabaseMetaData 分析数据库信息</h3><p>DatabaseMetaData 接口通常由驱动程序供应商提供实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseMetaDataTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String user;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> String pass;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initParam</span><span class="params">(String paramFile)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">		props.load(<span class="keyword">new</span> FileInputStream(paramFile));</span><br><span class="line">		driver = props.getProperty(<span class="string">&quot;driver&quot;</span>);</span><br><span class="line">		url = props.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">		user = props.getProperty(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">		pass = props.getProperty(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line">		Class.forName(driver);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">info</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">try</span>(</span><br><span class="line">			Connection conn = DriverManager.getConnection(url, user, pass))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 获取 DatabaseMetaData 对象</span></span><br><span class="line">			DatabaseMetaData dbmd = conn.getMetaData();</span><br><span class="line">			ResultSet rs = dbmd.getTableTypes();</span><br><span class="line">			System.out.println(<span class="string">&quot;---MySql支持的表类型信息---&quot;</span>);</span><br><span class="line">			printResultSet(rs);</span><br><span class="line">			rs = dbmd.getTables(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="string">&quot;%&quot;</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;TABLE&quot;</span>&#125;);</span><br><span class="line">			System.out.println(<span class="string">&quot;---当前数据库里的数据表信息---&quot;</span>);</span><br><span class="line">			printResultSet(rs);</span><br><span class="line">			rs = dbmd.getPrimaryKeys(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="string">&quot;student_table&quot;</span>);</span><br><span class="line">			System.out.println(<span class="string">&quot;---student_table 表的主键信息---&quot;</span>);</span><br><span class="line">			printResultSet(rs);</span><br><span class="line">			rs = dbmd.getProcedures(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="string">&quot;%add_pro%&quot;</span>);</span><br><span class="line">			System.out.println(<span class="string">&quot;---当前数据库里的存储过程信息---&quot;</span>);</span><br><span class="line">			printResultSet(rs);</span><br><span class="line">			rs = dbmd.getCrossReference(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="string">&quot;teacher_table&quot;</span>,</span><br><span class="line">					<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="string">&quot;student_table&quot;</span>);</span><br><span class="line">			System.out.println(<span class="string">&quot;---teacher_table 和 student_table之间的外键约束---&quot;</span>);</span><br><span class="line">			printResultSet(rs);</span><br><span class="line">			rs = dbmd.getColumns(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="string">&quot;student_table&quot;</span>, <span class="string">&quot;%&quot;</span>);</span><br><span class="line">			System.out.println(<span class="string">&quot;---student_table 表的全部数据列---&quot;</span>);</span><br><span class="line">			printResultSet(rs);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printResultSet</span><span class="params">(ResultSet rs)</span> <span class="keyword">throws</span> SQLException</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		ResultSetMetaData rsmd = rs.getMetaData();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rsmd.getColumnCount(); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			System.out.print(rsmd.getColumnName(i + <span class="number">1</span>) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">		<span class="comment">// 打印 ResultSet 里的全部数据</span></span><br><span class="line">		<span class="keyword">while</span> (rs.next())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; rsmd.getColumnCount(); i++)</span><br><span class="line">			&#123;</span><br><span class="line">				System.out.print(rs.getString(i + <span class="number">1</span>) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		rs.close();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		DatabaseMetaDataTest dt = <span class="keyword">new</span> DatabaseMetaDataTest();</span><br><span class="line">		dt.initParam(<span class="string">&quot;./src/unit13_jdbc/mysql.ini&quot;</span>);</span><br><span class="line">		dt.info();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-8-2-使用系统表分析数据库信息"><a href="#13-8-2-使用系统表分析数据库信息" class="headerlink" title="13.8.2 使用系统表分析数据库信息"></a>13.8.2 使用系统表分析数据库信息</h3><p>information_schema</p>
<ul>
<li>tables</li>
<li>schemata：数据库</li>
<li>views</li>
<li>columns</li>
<li>triggers</li>
<li>routines：存储过程和函数</li>
<li>key_column_usage：约束的键信息</li>
<li>table_constraints：约束信息</li>
<li>statistics：索引</li>
</ul>
<h3 id="13-8-3-选择合适的分析方式"><a href="#13-8-3-选择合适的分析方式" class="headerlink" title="13.8.3 选择合适的分析方式"></a>13.8.3 选择合适的分析方式</h3><p>DatabaseMetaData：更好的跨数据库特性，应用程序可以做到数据库无关；但可能无法准确获得数据库的更多细节。</p>
<p>系统表：信息更准确，但是与底层数据库耦合严重。</p>
<h2 id="13-9-使用连接池管理连接"><a href="#13-9-使用连接池管理连接" class="headerlink" title="13.9 使用连接池管理连接"></a>13.9 使用连接池管理连接</h2><p>当应用程序启动时，系统主动建立足够的数据库连接，并将这些连接组成一个连接池。每次应用程序请求数据库连接时，无须重新打开连接，而是从连接池中取出己有的连接使用，使用完后不再关闭数据库连接，而是直接将连接归还给连接池。通过使用连接池，将大大提高程序的运行效率。</p>
<p>数据库连接池常用参数：</p>
<ul>
<li>初始连接数</li>
<li>最大连接属</li>
<li>最小连接数</li>
<li>每次增加的容量</li>
</ul>
<p>JDBC 数据库连接池使用 javax.sql.DataSource 来表示。DataSource 只是一个接口。通常由商用服务器(如WebLogic 、WebSphere) 等提供实现，也有一些开源组织提供实现(如 DBCP 和 C3PO 等)。</p>
<h3 id="13-9-1-DBCP-数据源"><a href="#13-9-1-DBCP-数据源" class="headerlink" title="13.9.1 DBCP 数据源"></a>13.9.1 DBCP 数据源</h3><ul>
<li>commons-dbcp.jar：连接池实现</li>
<li>commons-pool.jar：连接池实现的依赖库</li>
</ul>
<p>下载地址：<a href="http://commons.apache.org/">http://commons.apache.org/</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建数据源对象</span></span><br><span class="line">BasicDataSource ds = <span class="keyword">new</span> BasicDataSource();</span><br><span class="line"><span class="comment">// 设直连接池所需的驱动</span></span><br><span class="line">ds.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"><span class="comment">// 设置连接数据库的URL</span></span><br><span class="line">ds.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/javaee&quot;</span>);</span><br><span class="line"><span class="comment">// 设置连接数据库的用户名</span></span><br><span class="line">ds.setUsername(<span class="string">&quot;root&quot;</span> );</span><br><span class="line"><span class="comment">// 设置连接数据库的密码</span></span><br><span class="line">ds.setPassword(<span class="string">&quot;pass&quot;</span>);</span><br><span class="line"><span class="comment">// 设置连接池的初始连接数</span></span><br><span class="line">dS.setlnitialSize(<span class="number">5</span>);</span><br><span class="line"><span class="comment">// 设置连接池最多可有多少个活动连接数</span></span><br><span class="line">ds.setMaxActive(<span class="number">20</span>);</span><br><span class="line"><span class="comment">// 设置连接池中最少有2</span></span><br><span class="line">ds.setMinIdle(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>数据源是产生数据库连接的工厂，整个应用只需要一个数据源即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过数据源获取数据库连接</span></span><br><span class="line">Connection conn = ds.getConnection();</span><br><span class="line"><span class="comment">// 释放数据库连接，但是并没有关闭数据库的物理连接，仅仅把数据库连接释放，归还给连接池</span></span><br><span class="line">conn.close;</span><br></pre></td></tr></table></figure>

<h3 id="13-9-2-C3P0-数据源"><a href="#13-9-2-C3P0-数据源" class="headerlink" title="13.9.2 C3P0 数据源"></a>13.9.2 C3P0 数据源</h3><ul>
<li>c3p0-0.9.1.2.jar</li>
</ul>
<p>下载地址：<a href="http://sourceforge.netlprojects/c3p0/">http://sourceforge.netlprojects/c3p0/</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建连接池实例</span></span><br><span class="line">ComboPooledDataSource ds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line"><span class="comment">// 设置连接池连接数据库所需的驱动</span></span><br><span class="line">ds.setDriverClass(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"><span class="comment">// 设置连接数据库的URL</span></span><br><span class="line">ds.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/javaee&quot;</span>);</span><br><span class="line"><span class="comment">// 设置连接数据库的用户名</span></span><br><span class="line">ds.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"><span class="comment">// 设置连接数据库的密码</span></span><br><span class="line">ds.setPassword(<span class="string">&quot;32147&quot;</span>);</span><br><span class="line"><span class="comment">// 设置连接池的最大连接数</span></span><br><span class="line">dS.setMaxPoolSize(<span class="number">40</span>);</span><br><span class="line"><span class="comment">// 设置连接池的最小连接数</span></span><br><span class="line">ds.setMinPoolSize(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// 设置连接池的初始连接数</span></span><br><span class="line">ds. setInitialPoolSize(<span class="number">10</span>) ;</span><br><span class="line"><span class="comment">// 设置连接池的缓存Statement的最大数</span></span><br><span class="line">ds.setMaxStatements(<span class="number">180</span>);</span><br></pre></td></tr></table></figure>

<p>​                                                                                                                                                                   </p>
</div><div class="tags"><a href="/tags/%E7%96%AF%E7%8B%82-Java-%E8%AE%B2%E4%B9%89/"><i class="fa fa-tag"></i>疯狂 Java 讲义</a></div><div class="post-nav"><a class="pre" href="/2020-01-14-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89/%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89C14.html">第 14 章 注解</a><a class="next" href="/2020-01-10-%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89/%E7%96%AF%E7%8B%82Java%E8%AE%B2%E4%B9%89C10.html">第 10 章 异常处理</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IO/">IO</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LVS/">LVS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS/">OS</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Srping-Boot/">Srping Boot</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ZooKeeper/">ZooKeeper</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">kafka</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%A0%E8%A7%A3%E5%AF%86%E6%8A%80%E6%9C%AF/">加解密技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%89%E4%BB%96/">吉他</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BF%83%E6%83%85/">心情</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A0%E5%85%B3%E6%8A%80%E6%9C%AF/">无关技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%96%AF%E7%8B%82-Java-%E8%AE%B2%E4%B9%89/">疯狂 Java 讲义</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">算法</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/%E5%BF%83%E6%83%85/" style="font-size: 15px;">心情</a> <a href="/tags/PGP/" style="font-size: 15px;">PGP</a> <a href="/tags/SFTP/" style="font-size: 15px;">SFTP</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Samba/" style="font-size: 15px;">Samba</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/IO/" style="font-size: 15px;">IO</a> <a href="/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/tags/Srping-Boot/" style="font-size: 15px;">Srping Boot</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/%E5%90%89%E4%BB%96/" style="font-size: 15px;">吉他</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 15px;">多线程</a> <a href="/tags/OS/" style="font-size: 15px;">OS</a> <a href="/tags/%E6%97%A0%E5%85%B3%E6%8A%80%E6%9C%AF/" style="font-size: 15px;">无关技术</a> <a href="/tags/%E7%96%AF%E7%8B%82-Java-%E8%AE%B2%E4%B9%89/" style="font-size: 15px;">疯狂 Java 讲义</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15px;">算法</a> <a href="/tags/ZooKeeper/" style="font-size: 15px;">ZooKeeper</a> <a href="/tags/Observer/" style="font-size: 15px;">Observer</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">设计模式</a> <a href="/tags/Singleton/" style="font-size: 15px;">Singleton</a> <a href="/tags/Proxy/" style="font-size: 15px;">Proxy</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/MQTT/" style="font-size: 15px;">MQTT</a> <a href="/tags/LVS/" style="font-size: 15px;">LVS</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">网络</a> <a href="/tags/Eureka/" style="font-size: 15px;">Eureka</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">前端</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.jamespan.me/" title="小鶸の道场" target="_blank">小鶸の道场</a><ul></ul><a href="https://www.haomwei.com/" title="屠城" target="_blank">屠城</a><ul></ul><a href="http://www.ruanyifeng.com/home.html" title="阮一峰" target="_blank">阮一峰</a><ul></ul><a href="https://www.cnblogs.com/jingmoxukong/" title="静默虚空" target="_blank">静默虚空</a><ul></ul><a href="https://blog.hushhw.cn/" title="hushhw" target="_blank">hushhw</a><ul></ul><a href="https://hasaik.com/" title="hasaik" target="_blank">hasaik</a><ul></ul><a href="https://www.imalan.cn/" title="三无计划" target="_blank">三无计划</a><ul></ul><a href="https://i-meto.com/" title="meto" target="_blank">meto</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">悟空.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>